<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur de Projet - C-Secur360 V6.4 - Version Compl√®te</title>
    <!-- Favicon sera g√©n√©r√© par JavaScript -->
    <link rel="icon" id="favicon" type="image/x-icon">
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Planificateur C-Secur360 V6.7">
    <!-- <link rel="manifest" href="./manifest.json"> -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Drive API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <!-- G√©n√©ration du favicon dynamique -->
    <script>
        // Cr√©er un favicon avec les initiales CS
        function createFavicon() {
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const ctx = canvas.getContext('2d');
            
            // Fond bleu C-Secur360
            ctx.fillStyle = '#2563eb';
            ctx.fillRect(0, 0, 32, 32);
            
            // Texte CS en blanc
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('CS', 16, 20);
            
            // Convertir en favicon
            const favicon = document.getElementById('favicon');
            favicon.href = canvas.toDataURL('image/x-icon');
        }
        
        // G√©n√©rer le favicon d√®s que possible
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createFavicon);
        } else {
            createFavicon();
        }
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Equipment badges in calendar */
        .equipment-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            border: 1px solid white;
        }

        .recurrence-indicator {
            position: absolute;
            bottom: 2px;
            left: 2px;
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            border: 1px solid white;
            font-size: 6px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .resource-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 2px 8px;
            margin: 2px;
            font-size: 11px;
        }

        .available-resource {
            border-color: #10b981;
            background-color: #d1fae5;
            color: #047857;
        }

        .busy-resource {
            border-color: #ef4444;
            background-color: #fee2e2;
            color: #dc2626;
        }

        .selected-resource {
            border-color: #3b82f6;
            background-color: #dbeafe;
            color: #1d4ed8;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        /* Bureau colors */
        .mdl-sherbrooke { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .mdl-terrebonne { background: linear-gradient(135deg, #10b981, #047857); }
        .mdl-quebec { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .dual-electrotech { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .cfm { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .surplec { background: linear-gradient(135deg, #06b6d4, #0891b2); }

        /* Styles pour travaux de nuit */
        .night-work {
            border-style: dashed !important;
            position: relative;
        }

        .night-work::before {
            content: 'üåô';
            position: absolute;
            top: -2px;
            left: -2px;
            font-size: 8px;
            z-index: 10;
        }

        /* Styles pour travaux 24h/24h */
        .work-24h {
            border-style: double !important;
            border-width: 3px !important;
            position: relative;
        }

        .work-24h::before {
            content: '‚è∞';
            position: absolute;
            top: -2px;
            left: -2px;
            font-size: 8px;
            z-index: 10;
        }

        /* Styles pour fins de semaine incluses */
        .includes-weekends {
            box-shadow: 0 0 0 1px #f59e0b inset;
        }

        /* Responsive optimizations */
        @media (max-width: 768px) {
            .resource-badge {
                padding: 1px 6px;
                font-size: 10px;
            }

            .mobile-calendar-row {
                min-height: 60px;
            }

            .mobile-job-card {
                min-height: 50px;
                font-size: 11px;
            }

            .mobile-gantt-person {
                width: 140px;
                font-size: 11px;
            }

            .mobile-gantt-day {
                width: 40px;
                font-size: 9px;
            }
        }

        @media (max-width: 480px) {
            .mobile-gantt-person {
                width: 120px;
                font-size: 10px;
            }

            .mobile-gantt-day {
                width: 32px;
                font-size: 8px;
            }
        }

        /* Touch-friendly interactions */
        @media (pointer: coarse) {
            button {
                min-height: 44px;
                min-width: 44px;
            }
        }

        /* Drag and drop styles */
        .drop-zone {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            background: #f9fafb;
        }

        .drop-zone.drag-over {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .drop-zone.has-files {
            border-color: #10b981;
            background: #f0fdf4;
        }

        /* Photo carousel styles */
        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.3s ease;
        }

        .carousel-slide {
            min-width: 100%;
            position: relative;
        }

        .carousel-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
        }

        .carousel-nav:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .carousel-nav.prev {
            left: 10px;
        }

        .carousel-nav.next {
            right: 10px;
        }

        .carousel-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
        }

        .carousel-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .carousel-indicator.active {
            background: white;
        }

        /* Profile photo styles */
        .profile-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e5e7eb;
        }

        .profile-photo-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #e5e7eb;
        }

        /* Equipment status styles */
        .equipment-card.broken {
            border-left: 4px solid #ef4444;
            background: linear-gradient(90deg, #fef2f2, white);
        }

        .equipment-card.repair {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(90deg, #fffbeb, white);
        }

        .equipment-card.available {
            border-left: 4px solid #10b981;
            background: linear-gradient(90deg, #f0fdf4, white);
        }

        .equipment-broken {
            background: #ef4444 !important;
        }

        .equipment-repair {
            background: #f59e0b !important;
        }

        /* File preview styles */
        .file-preview {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin: 4px 0;
        }

        .file-preview.document {
            border-left: 3px solid #3b82f6;
        }

        .file-preview.image {
            border-left: 3px solid #10b981;
        }

        /* Animation pour les notifications */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification {
            animation: slideInRight 0.3s ease-out;
        }

        /* === STYLES MODE NUIT === */
        .theme-nuit {
            background-color: #1f2937;
            color: #f9fafb;
        }

        .theme-nuit .bg-white {
            background-color: #374151 !important;
            color: #f9fafb;
        }

        .theme-nuit .bg-gray-50 {
            background-color: #4b5563 !important;
        }

        .theme-nuit .bg-blue-50 {
            background-color: #1e40af !important;
        }

        .theme-nuit .border-gray-200 {
            border-color: #6b7280 !important;
        }

        .theme-nuit .text-gray-800 {
            color: #f3f4f6 !important;
        }

        .theme-nuit .text-gray-600 {
            color: #d1d5db !important;
        }

        .theme-nuit .text-gray-500 {
            color: #e5e7eb !important;
        }

        .theme-nuit .text-gray-700 {
            color: #f3f4f6 !important;
        }

        .theme-nuit .text-gray-900 {
            color: #f9fafb !important;
        }

        .theme-nuit input, .theme-nuit select, .theme-nuit textarea {
            background-color: #4b5563 !important;
            color: #f9fafb !important;
            border-color: #6b7280 !important;
        }

        .theme-nuit .modal-content {
            background-color: #374151 !important;
            color: #f9fafb !important;
        }

        .theme-nuit .calendar-grid {
            background-color: #374151 !important;
        }

        .theme-nuit .calendar-header {
            background-color: #4b5563 !important;
            color: #f9fafb !important;
        }

        .theme-nuit .border {
            border-color: #6b7280 !important;
        }

        .theme-nuit .border-r {
            border-right-color: #6b7280 !important;
        }

        .theme-nuit .border-b {
            border-bottom-color: #6b7280 !important;
        }

        .theme-nuit .border-t {
            border-top-color: #6b7280 !important;
        }

        .theme-nuit .bg-gray-100 {
            background-color: #4b5563 !important;
            color: #f9fafb !important;
        }

        .theme-nuit .hover\\:bg-blue-50:hover {
            background-color: #1e3a8a !important;
        }

        .theme-nuit .hover\\:bg-gray-50:hover {
            background-color: #6b7280 !important;
        }

        .theme-nuit td {
            border-color: #6b7280 !important;
        }

        .theme-nuit th {
            border-color: #6b7280 !important;
            color: #f9fafb !important;
        }

        .theme-nuit .text-black {
            color: #f9fafb !important;
        }

        .theme-nuit .text-gray-400 {
            color: #d1d5db !important;
        }

        .theme-nuit .bg-yellow-100 {
            background-color: #92400e !important;
            color: #fef3c7 !important;
        }

        .theme-nuit .bg-green-100 {
            background-color: #065f46 !important;
            color: #d1fae5 !important;
        }

        .theme-nuit .bg-red-100 {
            background-color: #991b1b !important;
            color: #fecaca !important;
        }

        .theme-nuit .bg-blue-100 {
            background-color: #1e3a8a !important;
            color: #dbeafe !important;
        }

        .theme-nuit small {
            color: #d1d5db !important;
        }

        /* === STYLES CONG√âS === */
        .conges-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            background: #f59e0b;
            border-radius: 50%;
            border: 1px solid white;
        }

        .demande-conges {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
        }

        .conges-approuve {
            background: linear-gradient(45deg, #d1fae5, #a7f3d0);
            border-left: 4px solid #10b981;
        }

        .conges-refuse {
            background: linear-gradient(45deg, #fecaca, #fca5a5);
            border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // üîç AUTO-DIAGNOSTIC V6.4 - D√©tection des probl√®mes
        console.log('%cüöÄ D√âMARRAGE V6.4 - Auto-diagnostic activ√©', 'background: #4CAF50; color: white; padding: 5px; border-radius: 3px;');
        
        // Test des d√©pendances essentielles
        try {
            if (typeof React === 'undefined') {
                throw new Error('‚ùå React non charg√©');
            }
            console.log('‚úÖ React charg√©:', React.version);
            
            if (typeof ReactDOM === 'undefined') {
                throw new Error('‚ùå ReactDOM non charg√©');
            }
            console.log('‚úÖ ReactDOM charg√©');
            
            if (typeof Babel === 'undefined') {
                console.warn('‚ö†Ô∏è Babel non d√©tect√© (peut √™tre normal)');
            }
            
        } catch (error) {
            console.error('%cüí• ERREUR CRITIQUE AU D√âMARRAGE:', 'background: #f44336; color: white; padding: 5px;', error.message);
            document.body.innerHTML = `
                <div style="padding: 20px; background: #fee; border: 2px solid #f00; margin: 20px; border-radius: 10px; font-family: Arial;">
                    <h1 style="color: #d00;">üö® ERREUR DE CHARGEMENT V6.4</h1>
                    <p><strong>Probl√®me d√©tect√©:</strong> ${error.message}</p>
                    <p><strong>Solution:</strong> V√©rifiez que React et ReactDOM sont bien charg√©s</p>
                    <button onclick="location.reload()" style="padding: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">üîÑ Recharger la page</button>
                </div>
            `;
            throw error;
        }

        const { useState, useEffect, useMemo, useCallback } = React;
        console.log('‚úÖ Hooks React extraits avec succ√®s');
        
        // ============== IC√îNES SVG ==============
        
        const Icon = ({ name, size = 20, className = '' }) => {
            const icons = {
                calendar: 'M3 4h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm1 4v12h16V8H4zm2-6v2h2V2h8v2h2V2a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2z',
                users: 'M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2h15zM8.5 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm8.5 3.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zm2.5 8.5a3 3 0 0 0-3-3v2a1 1 0 0 1 1 1h2z',
                plus: 'M12 5v6m0 0v6m0-6h6m-6 0H6',
                edit: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z',
                trash: 'M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m-6 5v6m4-6v6',
                x: 'M18 6L6 18M6 6l12 12',
                save: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8',
                chevronLeft: 'M15 18l-6-6 6-6',
                chevronRight: 'M9 18l6-6-6-6',
                download: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3',
                upload: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12',
                search: 'M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z',
                barChart: 'M3 3v18h18M9 9l4 4 2-2 4 4',
                user: 'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8z',
                tool: 'M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z',
                building: 'M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18ZM6 12h4m4 0h4M6 16h4m4 0h4M6 8h4m4 0h4',
                settings: 'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z',
                userPlus: 'M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M12.5 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM20 8v6M23 11h-6',
                check: 'M20 6L9 17l-5-5',
                clock: 'M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM12 6v6l4 2',
                copy: 'M20 9H11a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-9a2 2 0 0 0-2-2zM5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1',
                eye: 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z',
                filter: 'M22 3H2l8 9.46V19l4 2v-8.54L22 3z',
                camera: 'M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2v11zM12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z',
                image: 'M14.828 10.414l-5.657 5.657a1 1 0 0 1-1.414-1.414l5.657-5.657a1 1 0 0 1 1.414 1.414zM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z',
                file: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM14 2v6h6M16 13H8M16 17H8M10 9H8',
                paperclip: 'M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83L15.78 4.4',
                alertTriangle: 'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01',
                wrench: 'M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41L13.7 2.7a2.41 2.41 0 0 0-3.41 0L2.7 10.3z'
            };

            const path = icons[name] || icons.plus;
            
            return React.createElement('svg', {
                width: size,
                height: size,
                viewBox: '0 0 24 24',
                fill: 'none',
                stroke: 'currentColor',
                strokeWidth: 2,
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
                className: className
            }, 
                React.createElement('path', { d: path })
            );
        };

        // ============== COMPOSANTS UTILITAIRES M√âDIAS ==============

        // Composant Carrousel Photo
        const PhotoCarousel = ({ photos, className = '' }) => {
            const [currentIndex, setCurrentIndex] = useState(0);

            if (!photos || photos.length === 0) {
                return React.createElement('div', {
                    className: `${className} flex items-center justify-center bg-gray-100 text-gray-500`
                }, "Aucune photo");
            }

            const nextPhoto = () => {
                setCurrentIndex((prev) => (prev + 1) % photos.length);
            };

            const prevPhoto = () => {
                setCurrentIndex((prev) => (prev - 1 + photos.length) % photos.length);
            };

            return React.createElement('div', {
                className: `carousel-container ${className}`
            },
                React.createElement('div', {
                    className: "carousel-track",
                    style: { transform: `translateX(-${currentIndex * 100}%)` }
                },
                    photos.map((photo, index) =>
                        React.createElement('div', {
                            key: index,
                            className: "carousel-slide"
                        },
                            React.createElement('img', {
                                src: photo.url || photo,
                                alt: photo.name || `Photo ${index + 1}`,
                                className: "carousel-image"
                            })
                        )
                    )
                ),
                photos.length > 1 && [
                    React.createElement('button', {
                        key: 'prev',
                        className: "carousel-nav prev",
                        onClick: prevPhoto
                    },
                        React.createElement(Icon, { name: 'chevronLeft', size: 16 })
                    ),
                    React.createElement('button', {
                        key: 'next',
                        className: "carousel-nav next",
                        onClick: nextPhoto
                    },
                        React.createElement(Icon, { name: 'chevronRight', size: 16 })
                    ),
                    React.createElement('div', {
                        key: 'indicators',
                        className: "carousel-indicators"
                    },
                        photos.map((_, index) =>
                            React.createElement('div', {
                                key: index,
                                className: `carousel-indicator ${index === currentIndex ? 'active' : ''}`,
                                onClick: () => setCurrentIndex(index)
                            })
                        )
                    )
                ]
            );
        };

        // Composant Zone de Drop
        const DropZone = ({ onFilesAdded, acceptedTypes = [], children, className = '' }) => {
            const [isDragOver, setIsDragOver] = useState(false);

            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragOver(false);
                
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    onFilesAdded(files);
                }
            };

            const handleFileInput = (e) => {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    onFilesAdded(files);
                }
            };

            return React.createElement('div', {
                className: `drop-zone ${isDragOver ? 'drag-over' : ''} ${className}`,
                onDragOver: handleDragOver,
                onDragLeave: handleDragLeave,
                onDrop: handleDrop
            },
                children,
                React.createElement('input', {
                    type: 'file',
                    multiple: true,
                    accept: acceptedTypes.join(','),
                    onChange: handleFileInput,
                    className: 'hidden',
                    id: 'file-input'
                }),
                React.createElement('label', {
                    htmlFor: 'file-input',
                    className: 'cursor-pointer text-blue-500 hover:text-blue-600'
                }, "ou cliquez pour s√©lectionner")
            );
        };

        // Composant Aper√ßu de Fichier
        const FilePreview = ({ file, onRemove }) => {
            const isImage = file.type?.startsWith('image/');
            const fileUrl = URL.createObjectURL(file);

            return React.createElement('div', {
                className: `file-preview ${isImage ? 'image' : 'document'}`
            },
                isImage 
                    ? React.createElement('img', {
                        src: fileUrl,
                        alt: file.name,
                        className: 'w-12 h-12 object-cover rounded'
                      })
                    : React.createElement(Icon, { 
                        name: 'file', 
                        size: 24, 
                        className: 'text-blue-500' 
                      }),
                React.createElement('div', { className: 'flex-1' },
                    React.createElement('div', { className: 'font-medium text-sm' }, file.name),
                    React.createElement('div', { className: 'text-xs text-gray-500' }, 
                        `${(file.size / 1024).toFixed(1)} KB`
                    )
                ),
                React.createElement('button', {
                    onClick: () => onRemove(file),
                    className: 'text-red-500 hover:text-red-700'
                },
                    React.createElement(Icon, { name: 'x', size: 16 })
                )
            );
        };

        // ============== HOOK D√âTECTION D'√âCRAN ==============
        
        const useScreenSize = () => {
            const [screenSize, setScreenSize] = useState({
                width: window.innerWidth,
                height: window.innerHeight,
                isMobile: window.innerWidth < 768,
                isTablet: window.innerWidth >= 768 && window.innerWidth < 1024,
                isDesktop: window.innerWidth >= 1024
            });

            useEffect(() => {
                const handleResize = () => {
                    const width = window.innerWidth;
                    const height = window.innerHeight;
                    setScreenSize({
                        width,
                        height,
                        isMobile: width < 768,
                        isTablet: width >= 768 && width < 1024,
                        isDesktop: width >= 1024
                    });
                };

                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            return screenSize;
        };

        // ============== HOOK NOTIFICATIONS ==============
        
        const useNotifications = () => {
            const [notifications, setNotifications] = useState([]);

            const addNotification = useCallback((message, type = 'success') => {
                const id = Date.now();
                const notification = { id, message, type };
                setNotifications(prev => [...prev, notification]);
                
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 3000);
            }, []);

            return { notifications, addNotification };
        };

        // ============== HOOK DONN√âES ==============
        
        const useAppData = () => {
            const [jobs, setJobs] = useState([]);
            const [personnel, setPersonnel] = useState([
                { 
                    id: 1, 
                    nom: "√âric Dufort", 
                    poste: "1.1 -TECH", 
                    succursale: "MDL - Sherbrooke", 
                    disponible: true, 
                    email: "eric@mdl.com", 
                    telephone: "450-123-4567", 
                    type: "interne",
                    motDePasse: "tech123",
                    permissions: { peutModifier: true, estCoordonnateur: false }, 
                    visibleChantier: true 
                },
                { 
                    id: 2, 
                    nom: "Carl L√©vesque", 
                    poste: "1.2 - ING.", 
                    succursale: "MDL - Terrebonne", 
                    disponible: true, 
                    email: "carl@mdl.com", 
                    telephone: "450-123-4568", 
                    type: "interne",
                    motDePasse: "ing123",
                    permissions: { peutModifier: true, estCoordonnateur: false }, 
                    visibleChantier: true 
                },
                { 
                    id: 3, 
                    nom: "Miguel Morin", 
                    poste: "1.3 - CPI", 
                    succursale: "MDL - Qu√©bec", 
                    disponible: true, 
                    email: "miguel@mdl.com", 
                    telephone: "418-123-4567", 
                    type: "interne",
                    motDePasse: "cpi123",
                    permissions: { peutModifier: true, estCoordonnateur: false }, 
                    visibleChantier: true 
                },
                { 
                    id: 4, 
                    nom: "Chad Rodrigue", 
                    poste: "1.4 - COORD.", 
                    succursale: "DUAL - √âlectrotech", 
                    disponible: true, 
                    email: "chad@dual.com", 
                    telephone: "819-123-4567", 
                    type: "interne",
                    motDePasse: "coord123",
                    permissions: { peutModifier: true, estCoordonnateur: true }, 
                    visibleChantier: false 
                },
                { 
                    id: 5, 
                    nom: "Alexandre Gari√©py-Gauvin", 
                    poste: "1.5 - D.T.", 
                    succursale: "CFM", 
                    disponible: true, 
                    email: "alex@cfm.com", 
                    telephone: "450-123-4569", 
                    type: "interne",
                    motDePasse: "dt123",
                    permissions: { peutModifier: false, estCoordonnateur: false }, 
                    visibleChantier: true 
                },
                { 
                    id: 6, 
                    nom: "Test Admin", 
                    poste: "ADMIN", 
                    succursale: "Test", 
                    disponible: true, 
                    email: "test@test.com", 
                    telephone: "000-000-0000", 
                    type: "interne",
                    motDePasse: "admin123",
                    permissions: { peutModifier: true, estCoordonnateur: true }, 
                    visibleChantier: false 
                }
            ]);

            const [equipements, setEquipements] = useState([
                { id: 1, nom: "DOBLE M4000", type: "Analyseur de r√©ponse", succursale: "MDL - Sherbrooke", disponible: true, numeroSerie: "DM4000-001", derniereMaintenance: "2025-08-15" },
                { id: 2, nom: "DOBLE SFRA", type: "Analyseur de r√©ponse", succursale: "MDL - Terrebonne", disponible: true, numeroSerie: "SFRA-002", derniereMaintenance: "2025-08-10" },
                { id: 3, nom: "TTR", type: "Testeur de rapport", succursale: "MDL - Qu√©bec", disponible: true, numeroSerie: "TTR-003", derniereMaintenance: "2025-07-20" },
                { id: 4, nom: "WINDING", type: "Testeur d'enroulement", succursale: "DUAL - √âlectrotech", disponible: true, numeroSerie: "WIN-004", derniereMaintenance: "2025-08-01" }
            ]);

            const [sousTraitants, setSousTraitants] = useState([]);

            // Types d'√©quipements personnalisables
            const [typesEquipements, setTypesEquipements] = useState([
                "Analyseur de r√©ponse",
                "Testeur de rapport", 
                "Testeur d'enroulement",
                "Analyseur de gaz dissous",
                "M√©gohmm√®tre",
                "Testeur d'isolation",
                "Analyseur de qualit√© d'huile"
            ]);

            // Ajouter un nouveau type d'√©quipement
            const addTypeEquipement = useCallback((newType) => {
                if (newType && !typesEquipements.includes(newType)) {
                    setTypesEquipements(prev => [...prev, newType]);
                }
            }, [typesEquipements]);

            // Ajouter un nouveau sous-traitant
            const addSousTraitant = useCallback((newSousTraitant) => {
                if (newSousTraitant && newSousTraitant.trim()) {
                    const nouveauSousTraitant = {
                        id: Date.now(),
                        nom: newSousTraitant.trim(),
                        specialite: "√Ä sp√©cifier",
                        telephone: "",
                        email: "",
                        disponible: true,
                        tarif: "√Ä n√©gocier"
                    };
                    setSousTraitants(prev => [...prev, nouveauSousTraitant]);
                    return nouveauSousTraitant.id;
                }
                return null;
            }, []);

            // Nouvelles variables d'√©tat
            const [demandesConges, setDemandesConges] = useState([]);
            const [modeTheme, setModeTheme] = useState('jour'); // 'jour' ou 'nuit'

            // Sauvegarde automatique
            useEffect(() => {
                const timer = setTimeout(() => {
                    localStorage.setItem('planificateur-data-v4', JSON.stringify({ 
                        jobs, personnel, equipements, sousTraitants, typesEquipements, demandesConges, modeTheme
                    }));
                }, 1000);
                return () => clearTimeout(timer);
            }, [jobs, personnel, equipements, sousTraitants, typesEquipements, demandesConges, modeTheme]);

            // Chargement des donn√©es
            useEffect(() => {
                const saved = localStorage.getItem('planificateur-data-v4');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (data.jobs) setJobs(data.jobs);
                        if (data.personnel) {
                            console.log('üîç DONN√âES PERSONNEL DEPUIS LOCALSTORAGE:', data.personnel[0]); // Premier utilisateur
                            // V√©rifier si les mots de passe sont pr√©sents, sinon garder les donn√©es par d√©faut
                            if (data.personnel[0] && !data.personnel[0].motDePasse) {
                                console.log('‚ö†Ô∏è DONN√âES LOCALSTORAGE SANS MOT DE PASSE - IGNOR√âES');
                                // Ne pas √©craser les donn√©es par d√©faut qui ont les mots de passe
                            } else {
                                setPersonnel(data.personnel);
                            }
                        }
                        if (data.equipements) setEquipements(data.equipements);
                        if (data.sousTraitants) {
                            // Filtrer les sous-traitants fictifs
                            const cleanSousTraitants = data.sousTraitants.filter(st => 
                                st.nom !== "TechElec Solutions" && 
                                st.nom !== "√âlectro Services Plus"
                            );
                            setSousTraitants(cleanSousTraitants);
                        }
                        if (data.typesEquipements) setTypesEquipements(data.typesEquipements);
                        if (data.demandesConges) setDemandesConges(data.demandesConges);
                        if (data.modeTheme) setModeTheme(data.modeTheme);
                    } catch (error) {
                        console.error('Erreur lors du chargement des donn√©es:', error);
                    }
                }
            }, []);

            return {
                jobs, setJobs,
                personnel, setPersonnel,
                equipements, setEquipements,
                sousTraitants, setSousTraitants, addSousTraitant,
                typesEquipements, addTypeEquipement,
                demandesConges, setDemandesConges,
                modeTheme, setModeTheme
            };
        };

        // ============== SERVICE GOOGLE DRIVE ==============

        const useGoogleDrive = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isInitialized, setIsInitialized] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [error, setError] = useState(null);

            // Configuration Google Drive - avec fallbacks s√©curis√©s
            const GOOGLE_CLIENT_ID = (typeof process !== 'undefined' && process.env?.GOOGLE_CLIENT_ID) || 'demo-mode';
            const GOOGLE_API_KEY = (typeof process !== 'undefined' && process.env?.GOOGLE_API_KEY) || 'demo-mode';
            const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
            const SCOPES = 'https://www.googleapis.com/auth/drive.file';
            const DATA_FILE_NAME = 'c-secur360-planificateur-data.json';
            
            // V√©rifier si Google Drive est disponible
            const isGoogleDriveAvailable = GOOGLE_CLIENT_ID !== 'demo-mode' && GOOGLE_API_KEY !== 'demo-mode';

            // Initialisation Google API avec gestion d'erreur robuste
            const initializeGoogleAPI = async () => {
                // Si Google Drive n'est pas configur√©, ne pas essayer d'initialiser
                if (!isGoogleDriveAvailable) {
                    console.log('‚ÑπÔ∏è Google Drive en mode d√©mo - credentials non configur√©s');
                    setError('Configuration Google Drive requise');
                    setIsInitialized(true); // Marquer comme initialis√© pour √©viter les boucles
                    return;
                }
                
                // V√©rifier que les APIs Google sont charg√©es
                if (typeof gapi === 'undefined' || typeof google === 'undefined') {
                    console.warn('‚ö†Ô∏è APIs Google non disponibles');
                    setError('APIs Google non disponibles');
                    setIsInitialized(true);
                    return;
                }

                try {
                    console.log('üöÄ Initialisation Google Drive API...');
                    
                    // Initialiser gapi avec timeout
                    const gapiLoaded = await Promise.race([
                        new Promise((resolve) => {
                            gapi.load('client', resolve);
                        }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout gapi.load')), 5000)
                        )
                    ]);

                    await Promise.race([
                        gapi.client.init({
                            apiKey: GOOGLE_API_KEY,
                            discoveryDocs: [DISCOVERY_DOC],
                        }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout gapi.client.init')), 5000)
                        )
                    ]);

                    // Initialiser Google Identity Services
                    const tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: SCOPES,
                        callback: (tokenResponse) => {
                            if (tokenResponse.access_token) {
                                setIsAuthenticated(true);
                                setError(null);
                                console.log('‚úÖ Authentification Google Drive r√©ussie');
                            }
                        },
                    });

                    window.googleTokenClient = tokenClient;
                    setIsInitialized(true);
                    console.log('‚úÖ Google Drive API initialis√©e');
                    
                    // V√©rifier si l'utilisateur est d√©j√† connect√©
                    if (gapi.client.getToken()) {
                        setIsAuthenticated(true);
                    }

                } catch (error) {
                    console.error('‚ùå Erreur initialisation Google Drive:', error);
                    setError('Google Drive indisponible');
                    setIsInitialized(true); // Marquer comme initialis√© m√™me en cas d'erreur
                }
            };

            // Connexion Google Drive
            const signIn = () => {
                if (!isGoogleDriveAvailable) {
                    setError('Configuration Google Drive requise');
                    return;
                }
                
                if (!isInitialized) {
                    setError('Google Drive pas encore initialis√©');
                    return;
                }
                
                try {
                    console.log('üîê Demande de connexion Google Drive...');
                    if (window.googleTokenClient) {
                        window.googleTokenClient.requestAccessToken();
                    } else {
                        throw new Error('Token client non disponible');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur connexion Google Drive:', error);
                    setError('Erreur de connexion');
                }
            };

            // D√©connexion Google Drive
            const signOut = () => {
                try {
                    const token = gapi.client.getToken();
                    if (token !== null) {
                        google.accounts.oauth2.revoke(token.access_token, () => {
                            console.log('üö™ D√©connexion Google Drive');
                        });
                        gapi.client.setToken(null);
                    }
                    setIsAuthenticated(false);
                    setLastSync(null);
                } catch (error) {
                    console.error('‚ùå Erreur d√©connexion Google Drive:', error);
                }
            };

            // Rechercher le fichier de donn√©es
            const findDataFile = async () => {
                try {
                    const response = await gapi.client.drive.files.list({
                        q: `name='${DATA_FILE_NAME}' and trashed=false`,
                        spaces: 'drive',
                        fields: 'files(id, name, modifiedTime)',
                    });

                    const files = response.result.files;
                    return files && files.length > 0 ? files[0] : null;
                } catch (error) {
                    console.error('‚ùå Erreur recherche fichier:', error);
                    throw error;
                }
            };

            // Sauvegarder les donn√©es sur Google Drive
            const saveToGoogleDrive = async (data) => {
                if (!isAuthenticated) {
                    throw new Error('Non connect√© √† Google Drive');
                }

                setIsSyncing(true);
                setError(null);

                try {
                    console.log('üíæ Sauvegarde vers Google Drive...');

                    const dataToSave = {
                        ...data,
                        lastModified: new Date().toISOString(),
                        version: '1.0'
                    };

                    const existingFile = await findDataFile();

                    const metadata = {
                        name: DATA_FILE_NAME,
                        parents: ['appDataFolder']
                    };

                    const multipart = 
                        '--314159265358979323846\n' +
                        'Content-Type: application/json\n\n' +
                        JSON.stringify(metadata) + '\n' +
                        '--314159265358979323846\n' +
                        'Content-Type: application/json\n\n' +
                        JSON.stringify(dataToSave) + '\n' +
                        '--314159265358979323846--';

                    const request = existingFile
                        ? gapi.client.request({
                            path: `https://www.googleapis.com/upload/drive/v3/files/${existingFile.id}`,
                            method: 'PATCH',
                            params: { uploadType: 'multipart' },
                            headers: { 'Content-Type': 'multipart/related; boundary="314159265358979323846"' },
                            body: multipart
                        })
                        : gapi.client.request({
                            path: 'https://www.googleapis.com/upload/drive/v3/files',
                            method: 'POST',
                            params: { uploadType: 'multipart' },
                            headers: { 'Content-Type': 'multipart/related; boundary="314159265358979323846"' },
                            body: multipart
                        });

                    await request;
                    setLastSync(new Date());
                    console.log('‚úÖ Sauvegarde Google Drive r√©ussie');

                } catch (error) {
                    console.error('‚ùå Erreur sauvegarde Google Drive:', error);
                    setError('Erreur de sauvegarde');
                    throw error;
                } finally {
                    setIsSyncing(false);
                }
            };

            // Charger les donn√©es depuis Google Drive
            const loadFromGoogleDrive = async () => {
                if (!isAuthenticated) {
                    return null;
                }

                setIsSyncing(true);
                setError(null);

                try {
                    console.log('üì• Chargement depuis Google Drive...');
                    
                    const file = await findDataFile();
                    if (!file) {
                        console.log('‚ÑπÔ∏è Aucun fichier de donn√©es trouv√©');
                        return null;
                    }

                    const response = await gapi.client.drive.files.get({
                        fileId: file.id,
                        alt: 'media'
                    });

                    const data = JSON.parse(response.body);
                    setLastSync(new Date(file.modifiedTime));
                    console.log('‚úÖ Chargement Google Drive r√©ussi');
                    
                    return data;

                } catch (error) {
                    console.error('‚ùå Erreur chargement Google Drive:', error);
                    setError('Erreur de chargement');
                    return null;
                } finally {
                    setIsSyncing(false);
                }
            };

            // Initialisation au montage du composant
            React.useEffect(() => {
                // Approche d√©fensive pour l'initialisation Google Drive
                const safeInitialize = async () => {
                    try {
                        // V√©rification approfondie de la disponibilit√© des APIs
                        if (typeof gapi === 'undefined' || typeof google === 'undefined') {
                            console.warn('‚ö†Ô∏è APIs Google non disponibles - fonctionnement en mode local');
                            setError('APIs Google non charg√©es');
                            setIsInitialized(true);
                            return;
                        }

                        // V√©rifier que les objects gapi et google sont compl√®tement charg√©s
                        if (!gapi.load || !google.accounts) {
                            console.warn('‚ö†Ô∏è APIs Google incompl√®tement charg√©es');
                            setError('APIs Google non pr√™tes');
                            setIsInitialized(true);
                            return;
                        }

                        // Si tout est OK, initialiser
                        await initializeGoogleAPI();
                    } catch (error) {
                        console.error('‚ùå Erreur lors de l\'initialisation s√©curis√©e:', error);
                        setError('Erreur d\'initialisation Google Drive');
                        setIsInitialized(true);
                    }
                };

                // D√©lai pour s'assurer que les scripts Google sont compl√®tement charg√©s
                const initTimer = setTimeout(safeInitialize, 100);
                
                return () => clearTimeout(initTimer);
            }, []);

            return {
                isAuthenticated,
                isInitialized,
                isSyncing,
                lastSync,
                error,
                signIn,
                signOut,
                saveToGoogleDrive,
                loadFromGoogleDrive
            };
        };

        // ============== HOOK DONN√âES AVEC GOOGLE DRIVE ==============

        const useAppDataWithSync = () => {
            const appData = useAppData();
            const googleDrive = useGoogleDrive();
            const [syncTimeout, setSyncTimeout] = useState(null);

            // Sauvegarde automatique apr√®s 2 secondes d'inactivit√©
            const scheduleAutoSave = React.useCallback(() => {
                if (syncTimeout) {
                    clearTimeout(syncTimeout);
                }

                const timeout = setTimeout(async () => {
                    if (googleDrive.isAuthenticated) {
                        try {
                            const dataToSave = {
                                jobs: appData.jobs,
                                personnel: appData.personnel,
                                equipements: appData.equipements,
                                sousTraitants: appData.sousTraitants,
                                typesEquipements: appData.typesEquipements,
                                demandesConges: appData.demandesConges,
                                modeTheme: appData.modeTheme
                            };
                            
                            await googleDrive.saveToGoogleDrive(dataToSave);
                            console.log('üíæ Sauvegarde automatique effectu√©e');
                        } catch (error) {
                            console.error('‚ùå Erreur sauvegarde automatique:', error);
                        }
                    }
                }, 2000);

                setSyncTimeout(timeout);
            }, [appData, googleDrive, syncTimeout]);

            // D√©clencher la sauvegarde lors des modifications
            React.useEffect(() => {
                scheduleAutoSave();
            }, [appData.jobs, appData.personnel, appData.equipements, appData.sousTraitants, scheduleAutoSave]);

            // Chargement automatique au d√©marrage si connect√©
            React.useEffect(() => {
                const loadInitialData = async () => {
                    if (googleDrive.isAuthenticated && !googleDrive.isSyncing) {
                        try {
                            const cloudData = await googleDrive.loadFromGoogleDrive();
                            if (cloudData) {
                                // Comparer avec localStorage et prendre le plus r√©cent
                                const localData = localStorage.getItem('planificateurData');
                                const localTimestamp = localData ? JSON.parse(localData).lastModified : null;
                                const cloudTimestamp = cloudData.lastModified;

                                if (!localTimestamp || new Date(cloudTimestamp) > new Date(localTimestamp)) {
                                    console.log('üì• Application des donn√©es cloud');
                                    if (cloudData.jobs) appData.setJobs(cloudData.jobs);
                                    if (cloudData.personnel) appData.setPersonnel(cloudData.personnel);
                                    if (cloudData.equipements) appData.setEquipements(cloudData.equipements);
                                    if (cloudData.sousTraitants) appData.setSousTraitants(cloudData.sousTraitants);
                                    if (cloudData.typesEquipements) appData.setTypesEquipements(cloudData.typesEquipements);
                                    if (cloudData.demandesConges) appData.setDemandesConges(cloudData.demandesConges);
                                    if (cloudData.modeTheme) appData.setModeTheme(cloudData.modeTheme);
                                } else {
                                    console.log('üíæ Donn√©es locales plus r√©centes');
                                }
                            }
                        } catch (error) {
                            console.error('‚ùå Erreur chargement initial:', error);
                        }
                    }
                };

                if (googleDrive.isInitialized) {
                    loadInitialData();
                }
            }, [googleDrive.isAuthenticated, googleDrive.isInitialized]);

            // Nettoyage
            React.useEffect(() => {
                return () => {
                    if (syncTimeout) {
                        clearTimeout(syncTimeout);
                    }
                };
            }, [syncTimeout]);

            return {
                ...appData,
                googleDrive,
                forceSync: async () => {
                    if (googleDrive.isAuthenticated) {
                        const dataToSave = {
                            jobs: appData.jobs,
                            personnel: appData.personnel,
                            equipements: appData.equipements,
                            sousTraitants: appData.sousTraitants,
                            typesEquipements: appData.typesEquipements,
                            demandesConges: appData.demandesConges,
                            modeTheme: appData.modeTheme
                        };
                        await googleDrive.saveToGoogleDrive(dataToSave);
                    }
                }
            };
        };

        // ============== COMPOSANTS UTILITAIRES ==============
        
        // ============== MODAL LOGIN UTILISATEUR ==============
        
        const UserLoginModal = ({ isOpen, personnel, loginForm, setLoginForm, onLogin, onClose }) => {
            if (!isOpen) return null;
            
            // Debug: v√©rifier les donn√©es personnel re√ßues
            React.useEffect(() => {
                if (personnel && personnel.length > 0) {
                    console.log('üîç PERSONNEL RE√áU PAR LE MODAL:', {
                        premier: personnel[0],
                        ericDufort: personnel.find(p => p.nom === "√âric Dufort")
                    });
                }
            }, [personnel]);
            
            const [etapeLogin, setEtapeLogin] = React.useState('nom'); // 'nom' ou 'password'
            const [utilisateurIdentifie, setUtilisateurIdentifie] = React.useState(null);
            const [showPassword, setShowPassword] = React.useState(false);
            const [motDePasseLocal, setMotDePasseLocal] = React.useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (etapeLogin === 'nom') {
                    // Premi√®re √©tape : identifier l'utilisateur par le nom
                    const normalizeString = (str) => {
                        return str.toLowerCase()
                            .normalize("NFD")
                            .replace(/[\u0300-\u036f]/g, "") 
                            .replace(/[^a-z0-9\s]/g, "") 
                            .trim();
                    };
                    
                    const user = personnel.find(p => {
                        const nomBD = normalizeString(p.nom);
                        const nomSaisi = normalizeString(loginForm.nom);
                        return nomBD === nomSaisi;
                    });
                    
                    if (user) {
                        // Passer √† l'√©tape 2 : mot de passe
                        setUtilisateurIdentifie(user);
                        setEtapeLogin('password');
                        console.log('‚úÖ Utilisateur identifi√©:', user.nom, '- Passage √† l\'authentification');
                    } else {
                        alert('Nom non trouv√©. V√©rifiez l\'orthographe.');
                    }
                } else {
                    // Deuxi√®me √©tape : v√©rifier le mot de passe
                    console.log('üì§ Envoi des donn√©es d\'authentification:', {
                        utilisateur: utilisateurIdentifie?.nom,
                        motDePasse: motDePasseLocal,
                        longueurMotDePasse: motDePasseLocal?.length
                    });
                    onLogin(utilisateurIdentifie, motDePasseLocal);
                }
            };
            
            return React.createElement('div', { 
                className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" 
            },
                React.createElement('div', { 
                    className: "bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden" 
                },
                    // En-t√™te avec logo
                    React.createElement('div', { className: "bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-center" },
                        React.createElement('img', {
                            src: "C-Secur360-logo.png.png",
                            alt: "C-Secur360",
                            className: "h-16 mx-auto mb-4"
                        }),
                        React.createElement('h2', { className: "text-xl font-bold text-white" }, 
                            etapeLogin === 'nom' ? "üë§ Identification" : "üîê Authentification"
                        ),
                        React.createElement('p', { className: "text-blue-100 text-sm" }, 
                            etapeLogin === 'nom' ? "√âtape 1/2 - Saisissez votre nom" : `√âtape 2/2 - Bonjour ${utilisateurIdentifie?.nom}`
                        )
                    ),
                    
                    // Formulaire de connexion
                    React.createElement('form', { onSubmit: handleSubmit, className: "p-6 space-y-4" },
                        // √âtape 1 : Nom (liste d√©roulante)
                        etapeLogin === 'nom' && React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "üë§ S√©lectionnez votre nom"),
                            React.createElement('select', {
                                value: loginForm.nom,
                                onChange: (e) => setLoginForm(prev => ({ ...prev, nom: e.target.value })),
                                className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                                required: true,
                                autoFocus: true
                            },
                                React.createElement('option', { value: "" }, "-- Choisissez votre nom --"),
                                ...personnel.map(person => 
                                    React.createElement('option', { key: person.id, value: person.nom }, person.nom)
                                )
                            ),
                            React.createElement('div', { className: "text-xs text-gray-500 mt-1" },
                                "üìã S√©lectionnez votre nom dans la liste"
                            )
                        ),
                        
                        // √âtape 2 : Mot de passe
                        etapeLogin === 'password' && React.createElement('div', null,
                            React.createElement('div', { className: "bg-green-50 p-3 rounded-lg mb-4" },
                                React.createElement('div', { className: "flex items-center gap-2" },
                                    React.createElement('span', { className: "text-green-600" }, "‚úÖ"),
                                    React.createElement('span', { className: "font-medium text-green-800" }, utilisateurIdentifie?.nom),
                                    React.createElement('span', { className: "text-green-600 text-sm" }, `(${utilisateurIdentifie?.poste})`)
                                )
                            ),
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "üîê Votre mot de passe"),
                            React.createElement('div', { className: "relative" },
                                React.createElement('input', {
                                    type: showPassword ? "text" : "password",
                                    value: motDePasseLocal,
                                    onChange: (e) => setMotDePasseLocal(e.target.value),
                                    className: "w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                                    placeholder: "Entrez votre mot de passe",
                                    required: true,
                                    autoFocus: true
                                }),
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => setShowPassword(!showPassword),
                                    className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none",
                                    title: showPassword ? "Masquer le mot de passe" : "Afficher le mot de passe"
                                }, showPassword ? "üëÅÔ∏è‚Äçüó®Ô∏è" : "üëÅÔ∏è")
                            ),
                            React.createElement('button', {
                                type: "button",
                                onClick: () => {
                                    setEtapeLogin('nom');
                                    setUtilisateurIdentifie(null);
                                    setMotDePasseLocal('');
                                    setLoginForm({ nom: '', motDePasse: '' });
                                },
                                className: "mt-2 text-sm text-gray-500 hover:text-gray-700"
                            }, "‚Üê Changer de nom")
                        ),
                        
                        React.createElement('div', { className: "pt-4" },
                            React.createElement('button', {
                                type: "submit",
                                className: "w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                            }, etapeLogin === 'nom' ? "Continuer ‚Üí" : "Se connecter")
                        )
                    ),
                    
                )
            );
        };
        
        const Modal = ({ isOpen, onClose, title, children, size = "lg" }) => {
            if (!isOpen) return null;

            const sizeClasses = {
                sm: "max-w-md",
                lg: "max-w-2xl",
                xl: "max-w-4xl",
                full: "max-w-full mx-4"
            };

            return React.createElement('div', {
                className: "fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",
                onClick: onClose
            },
                React.createElement('div', {
                    className: `bg-white rounded-lg shadow-xl ${sizeClasses[size]} w-full max-h-[90vh] overflow-hidden`,
                    onClick: (e) => e.stopPropagation()
                },
                    React.createElement('div', { className: "flex items-center justify-between p-4 border-b" },
                        React.createElement('h2', { className: "text-xl font-semibold" }, title),
                        React.createElement('button', {
                            onClick: onClose,
                            className: "p-2 hover:bg-gray-100 rounded-lg"
                        }, React.createElement(Icon, { name: 'x', size: 20 }))
                    ),
                    React.createElement('div', { className: "overflow-y-auto max-h-[calc(90vh-80px)]" }, children)
                )
            );
        };

        const NotificationContainer = ({ notifications }) => {
            return React.createElement('div', { 
                className: "fixed top-4 right-4 z-50 space-y-2" 
            },
                ...notifications.map(notification => 
                    React.createElement('div', {
                        key: notification.id,
                        className: `notification px-4 py-3 rounded-lg shadow-lg max-w-sm ${
                            notification.type === 'success' ? 'bg-green-500 text-white' :
                            notification.type === 'error' ? 'bg-red-500 text-white' :
                            'bg-blue-500 text-white'
                        }`
                    },
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement(Icon, { 
                                name: notification.type === 'success' ? 'check' : 
                                     notification.type === 'error' ? 'x' : 'info', 
                                size: 16 
                            }),
                            React.createElement('span', { className: "text-sm" }, notification.message)
                        )
                    )
                )
            );
        };

        // ============== UTILITAIRES ==============
        
        const getBureauFromSuccursale = (succursale) => {
            if (!succursale) return '';
            const lower = succursale.toLowerCase();
            if (lower.includes('sherbrooke')) return 'mdl-sherbrooke';
            if (lower.includes('terrebonne')) return 'mdl-terrebonne';
            if (lower.includes('qu√©bec')) return 'mdl-quebec';
            if (lower.includes('dual') || lower.includes('√©lectrotech')) return 'dual-electrotech';
            if (lower.includes('cfm')) return 'cfm';
            if (lower.includes('surplec')) return 'surplec';
            return '';
        };

        const getBureauColor = (succursale) => {
            const bureau = getBureauFromSuccursale(succursale);
            switch (bureau) {
                case 'mdl-sherbrooke': return 'text-white ' + bureau;
                case 'mdl-terrebonne': return 'text-white ' + bureau;
                case 'mdl-quebec': return 'text-white ' + bureau;
                case 'dual-electrotech': return 'text-white ' + bureau;
                case 'cfm': return 'text-white ' + bureau;
                case 'surplec': return 'text-white ' + bureau;
                default: return 'bg-gray-500 text-white';
            }
        };

        const getBureauOptions = () => [
            { value: 'tous', label: 'Tous les bureaux' },
            { value: 'MDL - Sherbrooke', label: 'MDL - Sherbrooke' },
            { value: 'MDL - Terrebonne', label: 'MDL - Terrebonne' },
            { value: 'MDL - Qu√©bec', label: 'MDL - Qu√©bec' },
            { value: 'DUAL - √âlectrotech', label: 'DUAL - √âlectrotech' },
            { value: 'CFM', label: 'CFM' },
            { value: 'Surplec', label: 'Surplec' }
        ];

        // ============== MODAL √âQUIPEMENT AM√âLIOR√â ==============
        
        const EquipementModal = ({ isOpen, onClose, onSave, equipement = null, typesEquipements, addTypeEquipement }) => {
            const [form, setForm] = useState({
                nom: '',
                type: '',
                succursale: '',
                numeroSerie: '',
                derniereMaintenance: '',
                disponible: true,
                photos: [],
                statut: 'disponible', // disponible, en_reparation, hors_service
                bris: null // { date, description, photos, statut }
            });

            const [newType, setNewType] = useState('');
            const [showNewTypeInput, setShowNewTypeInput] = useState(false);
            const [showBrisModal, setShowBrisModal] = useState(false);
            const [brisForm, setBrisForm] = useState({
                description: '',
                photos: [],
                statut: 'en_reparation'
            });

            useEffect(() => {
                if (isOpen) {
                    if (equipement) {
                        setForm({ ...equipement });
                    } else {
                        setForm({
                            nom: '',
                            type: '',
                            succursale: '',
                            numeroSerie: '',
                            derniereMaintenance: '',
                            disponible: true,
                            photos: [],
                            statut: 'disponible',
                            bris: null
                        });
                    }
                    setNewType('');
                    setShowNewTypeInput(false);
                }
            }, [isOpen, equipement]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!form.nom || !form.type) {
                    alert('Veuillez remplir les champs obligatoires');
                    return;
                }

                const equipData = {
                    ...form,
                    id: equipement ? equipement.id : Date.now()
                };

                onSave(equipData);
                onClose();
            };

            const handleAddNewType = () => {
                if (newType.trim()) {
                    addTypeEquipement(newType.trim());
                    setForm({...form, type: newType.trim()});
                    setNewType('');
                    setShowNewTypeInput(false);
                }
            };

            // Fonctions de gestion des photos
            const handlePhotosAdded = (files) => {
                const newPhotos = files.map(file => ({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    url: URL.createObjectURL(file),
                    file: file
                }));
                setForm(prev => ({
                    ...prev,
                    photos: [...prev.photos, ...newPhotos]
                }));
            };

            const removePhoto = (photoToRemove) => {
                setForm(prev => ({
                    ...prev,
                    photos: prev.photos.filter(p => p.id !== photoToRemove.id)
                }));
            };

            // Fonctions de gestion des bris
            const handleBrisSubmit = () => {
                const nouveauBris = {
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    description: brisForm.description,
                    photos: brisForm.photos,
                    statut: brisForm.statut
                };

                setForm(prev => ({
                    ...prev,
                    bris: nouveauBris,
                    statut: brisForm.statut,
                    disponible: false
                }));

                setShowBrisModal(false);
                setBrisForm({ description: '', photos: [], statut: 'en_reparation' });
            };

            const resoudreBris = () => {
                setForm(prev => ({
                    ...prev,
                    bris: null,
                    statut: 'disponible',
                    disponible: true
                }));
            };

            return React.createElement(Modal, {
                isOpen,
                onClose,
                title: equipement ? 'Modifier l\'√âquipement' : 'Ajouter un √âquipement',
                size: 'lg'
            },
                React.createElement('form', { onSubmit: handleSubmit, className: "p-6 space-y-4" },
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Nom de l'√©quipement *"),
                            React.createElement('input', {
                                type: "text",
                                value: form.nom,
                                onChange: (e) => setForm({...form, nom: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                required: true,
                                placeholder: "Ex: DOBLE M4000"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Type *"),
                            !showNewTypeInput ? 
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement('select', {
                                    value: form.type,
                                    onChange: (e) => {
                                        if (e.target.value === '__nouveau__') {
                                            setShowNewTypeInput(true);
                                        } else {
                                            setForm({...form, type: e.target.value});
                                        }
                                    },
                                    className: "flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                },
                                    React.createElement('option', { value: "" }, "S√©lectionner un type"),
                                    ...((typesEquipements && Array.isArray(typesEquipements)) ? typesEquipements : []).map(type => 
                                        React.createElement('option', { key: type, value: type }, type)
                                    ),
                                    React.createElement('option', { value: "__nouveau__" }, "‚ûï Nouveau type...")
                                )
                            ) :
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement('input', {
                                    type: "text",
                                    value: newType,
                                    onChange: (e) => setNewType(e.target.value),
                                    placeholder: "Nom du nouveau type",
                                    className: "flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                }),
                                React.createElement('button', {
                                    type: "button",
                                    onClick: handleAddNewType,
                                    className: "px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                                }, "‚úì"),
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => setShowNewTypeInput(false),
                                    className: "px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
                                }, "‚úó")
                            )
                        )
                    ),

                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Succursale"),
                        React.createElement('select', {
                            value: form.succursale,
                            onChange: (e) => setForm({...form, succursale: e.target.value}),
                            className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        },
                            React.createElement('option', { value: "" }, "S√©lectionner une succursale"),
                            ...getBureauOptions().slice(1).map(bureau => 
                                React.createElement('option', { key: bureau.value, value: bureau.value }, bureau.label)
                            )
                        )
                    ),

                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Num√©ro de s√©rie"),
                            React.createElement('input', {
                                type: "text",
                                value: form.numeroSerie,
                                onChange: (e) => setForm({...form, numeroSerie: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                placeholder: "Ex: DM4000-001"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Derni√®re maintenance"),
                            React.createElement('input', {
                                type: "date",
                                value: form.derniereMaintenance,
                                onChange: (e) => setForm({...form, derniereMaintenance: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                            })
                        )
                    ),

                    React.createElement('div', null,
                        React.createElement('label', { className: "flex items-center gap-2" },
                            React.createElement('input', {
                                type: "checkbox",
                                checked: form.disponible,
                                onChange: (e) => setForm({...form, disponible: e.target.checked}),
                                className: "rounded"
                            }),
                            React.createElement('span', { className: "text-sm" }, "Disponible")
                        )
                    ),

                    // Photos de l'√©quipement
                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Photos de l'√©quipement"),
                        React.createElement(DropZone, {
                            onFilesAdded: handlePhotosAdded,
                            acceptedTypes: ['image/*'],
                            className: form.photos.length > 0 ? 'has-files' : ''
                        },
                            React.createElement('div', { className: "text-center" },
                                React.createElement(Icon, { name: 'camera', size: 32, className: 'mx-auto text-gray-400 mb-2' }),
                                React.createElement('p', { className: 'text-sm text-gray-600' }, "Glissez vos photos ici"),
                                React.createElement('p', { className: 'text-xs text-gray-500' }, "JPG, PNG, GIF")
                            )
                        ),
                        form.photos.length > 0 && React.createElement('div', { className: "mt-4" },
                            React.createElement(PhotoCarousel, {
                                photos: form.photos,
                                className: "h-48"
                            })
                        )
                    ),

                    // Gestion des bris
                    React.createElement('div', { className: "border-t pt-4" },
                        React.createElement('div', { className: "flex items-center justify-between mb-4" },
                            React.createElement('h4', { className: "text-lg font-medium" }, "Gestion des bris"),
                            form.bris 
                                ? React.createElement('button', {
                                    type: 'button',
                                    onClick: resoudreBris,
                                    className: "px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                                  }, "Marquer comme r√©par√©")
                                : React.createElement('button', {
                                    type: 'button',
                                    onClick: () => setShowBrisModal(true),
                                    className: "px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                                  }, "Signaler un bris")
                        ),

                        form.bris && React.createElement('div', {
                            className: `p-4 rounded-lg border ${
                                form.bris.statut === 'hors_service' ? 'bg-red-50 border-red-200' : 'bg-yellow-50 border-yellow-200'
                            }`
                        },
                            React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                React.createElement(Icon, { 
                                    name: 'alertTriangle', 
                                    size: 20, 
                                    className: form.bris.statut === 'hors_service' ? 'text-red-500' : 'text-yellow-500'
                                }),
                                React.createElement('span', { className: "font-medium" },
                                    form.bris.statut === 'hors_service' ? 'Hors service' : 'En r√©paration'
                                ),
                                React.createElement('span', { className: "text-sm text-gray-500" }, 
                                    `- ${form.bris.date}`
                                )
                            ),
                            React.createElement('p', { className: "text-sm mb-2" }, form.bris.description),
                            form.bris.photos && form.bris.photos.length > 0 && 
                                React.createElement(PhotoCarousel, {
                                    photos: form.bris.photos,
                                    className: "h-32"
                                })
                        )
                    ),

                    React.createElement('div', { className: "flex justify-end gap-3 pt-4 border-t" },
                        React.createElement('button', {
                            type: "button",
                            onClick: onClose,
                            className: "px-6 py-2 border rounded-lg hover:bg-gray-50"
                        }, "Annuler"),
                        React.createElement('button', {
                            type: "submit",
                            className: "flex items-center gap-2 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                        },
                            React.createElement(Icon, { name: 'save', size: 16 }),
                            equipement ? "Modifier" : "Ajouter"
                        )
                    )
                ),

                // Modal de bris
                showBrisModal && React.createElement(Modal, {
                    isOpen: showBrisModal,
                    onClose: () => setShowBrisModal(false),
                    title: "Signaler un bris",
                    size: 'md'
                },
                    React.createElement('div', { className: "p-6 space-y-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Statut"),
                            React.createElement('select', {
                                value: brisForm.statut,
                                onChange: (e) => setBrisForm({...brisForm, statut: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                            },
                                React.createElement('option', { value: "en_reparation" }, "En r√©paration"),
                                React.createElement('option', { value: "hors_service" }, "Hors service")
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Description du bris"),
                            React.createElement('textarea', {
                                value: brisForm.description,
                                onChange: (e) => setBrisForm({...brisForm, description: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                rows: 3,
                                required: true
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Photos du bris"),
                            React.createElement(DropZone, {
                                onFilesAdded: (files) => {
                                    const newPhotos = files.map(file => ({
                                        id: Date.now() + Math.random(),
                                        name: file.name,
                                        url: URL.createObjectURL(file),
                                        file: file
                                    }));
                                    setBrisForm(prev => ({
                                        ...prev,
                                        photos: [...prev.photos, ...newPhotos]
                                    }));
                                },
                                acceptedTypes: ['image/*']
                            },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement(Icon, { name: 'camera', size: 24, className: 'mx-auto text-gray-400 mb-2' }),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, "Photos du probl√®me")
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex justify-end gap-3 pt-4" },
                            React.createElement('button', {
                                type: "button",
                                onClick: () => setShowBrisModal(false),
                                className: "px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
                            }, "Annuler"),
                            React.createElement('button', {
                                type: "button",
                                onClick: handleBrisSubmit,
                                className: "px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",
                                disabled: !brisForm.description
                            }, "Signaler le bris")
                        )
                    )
                )
            );
        };

        // ============== MODAL CONG√âS ==============
        
        const CongesModal = ({ isOpen, onClose, onSave, personnel = null, allPersonnel = [], demandeExistante = null }) => {
            const [form, setForm] = useState({
                personnelId: personnel?.id || '',
                type: 'vacances', // 'vacances', 'maladie', 'personnel', 'formation'
                dateDebut: '',
                dateFin: '',
                motif: '',
                statut: 'en_attente', // 'en_attente', 'approuve', 'refuse'
                commentaire: ''
            });

            useEffect(() => {
                if (demandeExistante) {
                    setForm(demandeExistante);
                } else if (personnel) {
                    setForm(prev => ({
                        ...prev,
                        personnelId: personnel.id
                    }));
                }
            }, [demandeExistante, personnel]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!form.personnelId || !form.dateDebut || !form.dateFin || !form.motif) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const selectedPersonnel = personnel || allPersonnel.find(p => p.id === form.personnelId);
                const congesData = {
                    ...form,
                    id: demandeExistante?.id || Date.now(),
                    dateCreation: demandeExistante?.dateCreation || new Date().toISOString(),
                    personnelNom: selectedPersonnel?.nom || 'Inconnu'
                };

                onSave(congesData);
                onClose();
            };

            if (!isOpen) return null;

            return React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" },
                React.createElement('div', { className: "bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto" },
                    React.createElement('h3', { className: "text-lg font-semibold mb-4" }, 
                        demandeExistante ? 'Modifier la demande' : 'Nouvelle demande de cong√©'
                    ),
                    React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
                        // Personnel - s√©lection ou lecture seule
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Personnel *"),
                            personnel ? 
                                React.createElement('input', {
                                    type: "text",
                                    value: personnel.nom,
                                    readOnly: true,
                                    className: "w-full p-2 border rounded-lg bg-gray-100"
                                }) :
                                React.createElement('select', {
                                    value: form.personnelId,
                                    onChange: (e) => setForm({...form, personnelId: e.target.value}),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                },
                                    React.createElement('option', { value: "" }, "S√©lectionner un personnel"),
                                    allPersonnel.map(p => 
                                        React.createElement('option', { key: p.id, value: p.id }, p.nom)
                                    )
                                )
                        ),

                        // Type de cong√©
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Type de cong√© *"),
                            React.createElement('select', {
                                value: form.type,
                                onChange: (e) => setForm({...form, type: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                required: true
                            },
                                React.createElement('option', { value: "vacances" }, "Vacances"),
                                React.createElement('option', { value: "maladie" }, "Cong√© maladie"),
                                React.createElement('option', { value: "personnel" }, "Cong√© personnel"),
                                React.createElement('option', { value: "formation" }, "Formation"),
                                React.createElement('option', { value: "parental" }, "Cong√© parental")
                            )
                        ),

                        // Dates
                        React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Date d√©but *"),
                                React.createElement('input', {
                                    type: "date",
                                    value: form.dateDebut,
                                    onChange: (e) => setForm({...form, dateDebut: e.target.value}),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Date fin *"),
                                React.createElement('input', {
                                    type: "date",
                                    value: form.dateFin,
                                    onChange: (e) => setForm({...form, dateFin: e.target.value}),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                })
                            )
                        ),

                        // Motif
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Motif *"),
                            React.createElement('textarea', {
                                value: form.motif,
                                onChange: (e) => setForm({...form, motif: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                rows: 3,
                                required: true,
                                placeholder: "D√©crivez le motif de votre demande..."
                            })
                        ),

                        // Statut (si modification par admin)
                        demandeExistante && React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Statut"),
                            React.createElement('select', {
                                value: form.statut,
                                onChange: (e) => setForm({...form, statut: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                            },
                                React.createElement('option', { value: "en_attente" }, "En attente"),
                                React.createElement('option', { value: "approuve" }, "Approuv√©"),
                                React.createElement('option', { value: "refuse" }, "Refus√©")
                            )
                        ),

                        // Commentaire
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Commentaire"),
                            React.createElement('textarea', {
                                value: form.commentaire,
                                onChange: (e) => setForm({...form, commentaire: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                rows: 2,
                                placeholder: "Commentaire optionnel..."
                            })
                        ),

                        // Boutons
                        React.createElement('div', { className: "flex gap-4 pt-4" },
                            React.createElement('button', {
                                type: "button",
                                onClick: onClose,
                                className: "flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
                            }, "Annuler"),
                            React.createElement('button', {
                                type: "submit",
                                className: "flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                            }, demandeExistante ? 'Modifier' : 'Cr√©er')
                        )
                    )
                )
            );
        };

        // ============== MODAL PERSONNEL ==============
        
        const PersonnelModal = ({ isOpen, onClose, onSave, personnel = null }) => {
            const [showPassword, setShowPassword] = useState(false);
            const [form, setForm] = useState({
                nom: '',
                poste: '1.1 -TECH',
                succursale: '',
                email: '',
                telephone: '',
                disponible: true,
                type: 'interne',
                photo: null,
                motDePasse: '',
                permissions: {
                    peutModifier: true,
                    estCoordonnateur: false
                },
                visibleChantier: true
            });

            useEffect(() => {
                if (isOpen) {
                    if (personnel) {
                        setForm({ 
                            ...personnel,
                            motDePasse: personnel.motDePasse || '',
                            permissions: personnel.permissions || { peutModifier: true, estCoordonnateur: false },
                            visibleChantier: personnel.visibleChantier !== undefined ? personnel.visibleChantier : true
                        });
                    } else {
                        setForm({
                            nom: '',
                            poste: '1.1 -TECH',
                            succursale: '',
                            email: '',
                            telephone: '',
                            disponible: true,
                            type: 'interne',
                            photo: null,
                            motDePasse: '',
                            permissions: {
                                peutModifier: true,
                                estCoordonnateur: false
                            },
                            visibleChantier: true
                        });
                    }
                }
            }, [isOpen, personnel]);

            // Fonctions de gestion de la photo
            const handlePhotoAdded = (files) => {
                if (files.length > 0) {
                    const file = files[0];
                    const photoData = {
                        id: Date.now(),
                        name: file.name,
                        url: URL.createObjectURL(file),
                        file: file
                    };
                    setForm(prev => ({ ...prev, photo: photoData }));
                }
            };

            const removePhoto = () => {
                setForm(prev => ({ ...prev, photo: null }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!form.nom || !form.poste) {
                    alert('Veuillez remplir les champs obligatoires');
                    return;
                }

                const personData = {
                    ...form,
                    id: personnel ? personnel.id : Date.now()
                };

                onSave(personData);
                onClose();
            };

            return React.createElement(Modal, {
                isOpen,
                onClose,
                title: personnel ? 'Modifier le Personnel' : 'Ajouter du Personnel',
                size: 'lg'
            },
                React.createElement('form', { onSubmit: handleSubmit, className: "p-6 space-y-4" },
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                        // Photo de profil
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Photo de profil"),
                            form.photo 
                                ? React.createElement('div', { className: "relative" },
                                    React.createElement('img', {
                                        src: form.photo.url,
                                        alt: "Photo de profil",
                                        className: "w-24 h-24 object-cover rounded-full mx-auto border-2 border-gray-200"
                                    }),
                                    React.createElement('button', {
                                        type: 'button',
                                        onClick: removePhoto,
                                        className: "absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"
                                    },
                                        React.createElement(Icon, { name: 'x', size: 12 })
                                    )
                                  )
                                : React.createElement(DropZone, {
                                    onFilesAdded: handlePhotoAdded,
                                    acceptedTypes: ['image/*'],
                                    className: "h-24 flex items-center justify-center"
                                  },
                                    React.createElement(Icon, { name: 'camera', size: 24, className: 'text-gray-400' })
                                  )
                        ),

                        // Informations de base
                        React.createElement('div', { className: "md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Nom complet *"),
                            React.createElement('input', {
                                type: "text",
                                value: form.nom,
                                onChange: (e) => setForm({...form, nom: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                required: true,
                                placeholder: "Ex: Jean Tremblay"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Poste *"),
                            React.createElement('select', {
                                value: form.poste,
                                onChange: (e) => setForm({...form, poste: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                required: true
                            },
                                React.createElement('option', { value: "1.1 -TECH" }, "1.1 - TECH"),
                                React.createElement('option', { value: "1.2 - ING." }, "1.2 - ING."),
                                React.createElement('option', { value: "1.3 - CPI" }, "1.3 - CPI"),
                                React.createElement('option', { value: "1.4 - COORD." }, "1.4 - COORD."),
                                React.createElement('option', { value: "1.5 - D.T." }, "1.5 - D.T."),
                                React.createElement('option', { value: "2.1 - ADMIN" }, "2.1 - ADMIN")
                            )
                        )
                    ),

                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Succursale"),
                        React.createElement('select', {
                            value: form.succursale,
                            onChange: (e) => setForm({...form, succursale: e.target.value}),
                            className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        },
                            React.createElement('option', { value: "" }, "S√©lectionner une succursale"),
                            ...getBureauOptions().slice(1).map(bureau => 
                                React.createElement('option', { key: bureau.value, value: bureau.value }, bureau.label)
                            )
                        )
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Email"),
                            React.createElement('input', {
                                type: "email",
                                value: form.email,
                                onChange: (e) => setForm({...form, email: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                placeholder: "jean@entreprise.com"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "T√©l√©phone"),
                            React.createElement('input', {
                                type: "tel",
                                value: form.telephone,
                                onChange: (e) => setForm({...form, telephone: e.target.value}),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                placeholder: "450-123-4567"
                            })
                        )
                    ),

                    React.createElement('div', { className: "flex items-center gap-4" },
                        React.createElement('label', { className: "flex items-center gap-2" },
                            React.createElement('input', {
                                type: "checkbox",
                                checked: form.disponible,
                                onChange: (e) => setForm({...form, disponible: e.target.checked}),
                                className: "rounded"
                            }),
                            React.createElement('span', { className: "text-sm" }, "Disponible")
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Type"),
                            React.createElement('select', {
                                value: form.type,
                                onChange: (e) => setForm({...form, type: e.target.value}),
                                className: "p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                            },
                                React.createElement('option', { value: "interne" }, "Interne"),
                                React.createElement('option', { value: "contractuel" }, "Contractuel"),
                                React.createElement('option', { value: "stagiaire" }, "Stagiaire")
                            )
                        )
                    ),

                    // Authentification
                    React.createElement('div', { className: "p-4 bg-blue-50 rounded-lg space-y-3" },
                        React.createElement('h4', { className: "font-medium text-blue-800 mb-2" }, "üîê Acc√®s et authentification"),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-1 text-blue-700" }, "Mot de passe"),
                            React.createElement('div', { className: "relative" },
                                React.createElement('input', {
                                    type: showPassword ? "text" : "password",
                                    value: form.motDePasse,
                                    onChange: (e) => setForm({...form, motDePasse: e.target.value}),
                                    className: "w-full p-2 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    placeholder: "Entrez le mot de passe",
                                    required: true
                                }),
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => setShowPassword(!showPassword),
                                    className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none",
                                    title: showPassword ? "Masquer le mot de passe" : "Afficher le mot de passe"
                                }, showPassword ? "üëÅÔ∏è‚Äçüó®Ô∏è" : "üëÅÔ∏è")
                            )
                        )
                    ),

                    // Permissions et r√¥les
                    React.createElement('div', { className: "p-4 bg-gray-50 rounded-lg space-y-3" },
                        React.createElement('h4', { className: "font-medium text-gray-800 mb-2" }, "üë• Permissions et r√¥le"),
                        React.createElement('div', { className: "flex flex-col gap-3" },
                            React.createElement('label', { className: "flex items-center gap-2" },
                                React.createElement('input', {
                                    type: "checkbox",
                                    checked: form.permissions.peutModifier,
                                    onChange: (e) => setForm({
                                        ...form, 
                                        permissions: {...form.permissions, peutModifier: e.target.checked}
                                    }),
                                    className: "rounded"
                                }),
                                React.createElement('span', { className: "text-sm" }, "Peut modifier les √©v√©nements"),
                                React.createElement('span', { className: "text-xs text-gray-500" }, "(sinon consultation seulement)")
                            ),
                            React.createElement('label', { className: "flex items-center gap-2" },
                                React.createElement('input', {
                                    type: "checkbox",
                                    checked: form.permissions.estCoordonnateur,
                                    onChange: (e) => setForm({
                                        ...form, 
                                        permissions: {...form.permissions, estCoordonnateur: e.target.checked}
                                    }),
                                    className: "rounded"
                                }),
                                React.createElement('span', { className: "text-sm" }, "Coordonnateur"),
                                React.createElement('span', { className: "text-xs text-gray-500" }, "(acc√®s √©tendu)")
                            ),
                            React.createElement('label', { className: "flex items-center gap-2" },
                                React.createElement('input', {
                                    type: "checkbox",
                                    checked: form.visibleChantier,
                                    onChange: (e) => setForm({...form, visibleChantier: e.target.checked}),
                                    className: "rounded"
                                }),
                                React.createElement('span', { className: "text-sm" }, "Visible dans le personnel de chantier"),
                                React.createElement('span', { className: "text-xs text-gray-500" }, "(d√©cocher pour r√¥les administratifs)")
                            )
                        )
                    ),

                    React.createElement('div', { className: "flex justify-end gap-3 pt-4 border-t" },
                        React.createElement('button', {
                            type: "button",
                            onClick: onClose,
                            className: "px-6 py-2 border rounded-lg hover:bg-gray-50"
                        }, "Annuler"),
                        React.createElement('button', {
                            type: "submit",
                            className: "flex items-center gap-2 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                        },
                            React.createElement(Icon, { name: 'save', size: 16 }),
                            personnel ? "Modifier" : "Ajouter"
                        )
                    )
                )
            );
        };

        // ============== COMPOSANT NAVIGATEUR DE DATE ==============
        
        const DateNavigator = ({ currentDate, onDateChange, onClose }) => {
            const [selectedYear, setSelectedYear] = useState(currentDate.getFullYear());
            const [selectedMonth, setSelectedMonth] = useState(currentDate.getMonth());

            const months = [
                'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
                'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
            ];

            const currentYear = new Date().getFullYear();
            const years = Array.from({ length: 10 }, (_, i) => currentYear - 2 + i);

            const handleGoToDate = () => {
                const newDate = new Date(selectedYear, selectedMonth, 1);
                onDateChange(newDate);
                onClose();
            };

            return React.createElement('div', { className: "bg-white border rounded-lg shadow-lg p-4 w-72" },
                React.createElement('div', { className: "flex items-center justify-between mb-4" },
                    React.createElement('h3', { className: "font-semibold" }, "Aller √† une date"),
                    React.createElement('button', {
                        onClick: onClose,
                        className: "p-1 hover:bg-gray-100 rounded"
                    }, React.createElement(Icon, { name: 'x', size: 16 }))
                ),

                React.createElement('div', { className: "space-y-4" },
                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Ann√©e"),
                        React.createElement('select', {
                            value: selectedYear,
                            onChange: (e) => setSelectedYear(parseInt(e.target.value)),
                            className: "w-full p-2 border rounded-lg"
                        },
                            ...years.map(year => 
                                React.createElement('option', { key: year, value: year }, year)
                            )
                        )
                    ),

                    React.createElement('div', null,
                        React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Mois"),
                        React.createElement('div', { className: "grid grid-cols-3 gap-2" },
                            ...months.map((month, index) => 
                                React.createElement('button', {
                                    key: index,
                                    onClick: () => setSelectedMonth(index),
                                    className: `p-2 text-sm border rounded-lg transition-colors ${
                                        selectedMonth === index ? 
                                        'bg-blue-500 text-white border-blue-500' : 
                                        'hover:bg-gray-50'
                                    }`
                                }, month.substr(0, 3))
                            )
                        )
                    ),

                    React.createElement('div', { className: "flex gap-2 pt-2" },
                        React.createElement('button', {
                            onClick: onClose,
                            className: "flex-1 px-3 py-2 border rounded-lg hover:bg-gray-50"
                        }, "Annuler"),
                        React.createElement('button', {
                            onClick: handleGoToDate,
                            className: "flex-1 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                        }, "Aller")
                    )
                )
            );
        };

        // ============== S√âLECTEUR DE RESSOURCES AVEC √âQUIPEMENTS ==============
        
        const ResourceSelector = ({ 
            selectedPersonnel = [], 
            selectedEquipements = [], 
            selectedSousTraitants = [],
            onPersonnelChange, 
            onEquipementsChange, 
            onSousTraitantsChange,
            personnel, 
            equipements, 
            sousTraitants,
            dateDebut,
            dateFin,
            jobs,
            currentJobId = null
        }) => {
            const [filtrePersonnelBureau, setFiltrePersonnelBureau] = useState('tous');
            const [filtreEquipementBureau, setFiltreEquipementBureau] = useState('tous');
            const [newSousTraitant, setNewSousTraitant] = useState('');
            
            // V√©rifier la disponibilit√© des ressources pour la p√©riode
            const isResourceAvailable = useCallback((resourceId, type) => {
                if (!dateDebut || !dateFin) return true;
                
                return !jobs.some(job => {
                    if (job.id === currentJobId) return false; // Ignorer le job actuel
                    
                    const jobStart = new Date(job.dateDebut);
                    const jobEnd = new Date(job.dateFin || job.dateDebut);
                    const periodStart = new Date(dateDebut);
                    const periodEnd = new Date(dateFin);
                    
                    const isOverlapping = jobStart <= periodEnd && jobEnd >= periodStart;
                    
                    if (!isOverlapping) return false;
                    
                    if (type === 'personnel') return job.personnel?.includes(resourceId);
                    if (type === 'equipement') return job.equipements?.includes(resourceId);
                    if (type === 'sousTraitant') return job.sousTraitants?.includes(resourceId);
                    
                    return false;
                });
            }, [dateDebut, dateFin, jobs, currentJobId]);

            const togglePersonnel = (id) => {
                const updated = selectedPersonnel.includes(id) 
                    ? selectedPersonnel.filter(p => p !== id)
                    : [...selectedPersonnel, id];
                onPersonnelChange(updated);
            };

            const toggleEquipement = (id) => {
                const updated = selectedEquipements.includes(id) 
                    ? selectedEquipements.filter(e => e !== id)
                    : [...selectedEquipements, id];
                onEquipementsChange(updated);
            };

            const toggleSousTraitant = (id) => {
                const updated = selectedSousTraitants.includes(id) 
                    ? selectedSousTraitants.filter(s => s !== id)
                    : [...selectedSousTraitants, id];
                onSousTraitantsChange(updated);
            };

            const handleAddSousTraitant = () => {
                if (newSousTraitant.trim()) {
                    // Pour l'instant, nous ne pouvons pas ajouter de nouveaux sous-traitants depuis ce composant
                    // Cette fonction sera impl√©ment√©e plus tard avec les props n√©cessaires
                    console.warn('Ajout de sous-traitants non impl√©ment√© dans ResourceSelector');
                    setNewSousTraitant('');
                }
            };

            return React.createElement('div', { className: "space-y-6" },
                // Personnel
                React.createElement('div', null,
                    React.createElement('div', { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3" },
                        React.createElement('h3', { className: "text-lg font-semibold flex items-center gap-2" },
                            React.createElement(Icon, { name: 'user', size: 20 }),
                            `Personnel (${selectedPersonnel.length} s√©lectionn√©${selectedPersonnel.length !== 1 ? 's' : ''})`
                        ),
                        React.createElement('select', {
                            value: filtrePersonnelBureau,
                            onChange: (e) => setFiltrePersonnelBureau(e.target.value),
                            className: "px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500"
                        },
                            React.createElement('option', { value: "tous" }, "Tous les bureaux"),
                            React.createElement('option', { value: "MDL - Sherbrooke" }, "MDL - Sherbrooke"),
                            React.createElement('option', { value: "MDL - Terrebonne" }, "MDL - Terrebonne"),
                            React.createElement('option', { value: "MDL - Qu√©bec" }, "MDL - Qu√©bec"),
                            React.createElement('option', { value: "DUAL - √âlectrotech" }, "DUAL - √âlectrotech"),
                            React.createElement('option', { value: "CFM" }, "CFM"),
                            React.createElement('option', { value: "Surplec" }, "Surplec")
                        )
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-48 overflow-y-auto" },
                        ...personnel.filter(person => {
                            const notCoordonnateur = !person.isCoordonnateur;
                            const matchesBureau = filtrePersonnelBureau === 'tous' || person.succursale === filtrePersonnelBureau;
                            return notCoordonnateur && matchesBureau;
                        }).map(person => {
                            const available = isResourceAvailable(person.id, 'personnel');
                            const selected = selectedPersonnel.includes(person.id);
                            
                            return React.createElement('div', {
                                key: person.id,
                                className: `p-3 border rounded-lg cursor-pointer transition-all ${
                                    selected ? 'selected-resource' : 
                                    available ? 'available-resource hover:shadow-md' : 
                                    'busy-resource opacity-60'
                                }`,
                                onClick: available ? () => togglePersonnel(person.id) : undefined
                            },
                                React.createElement('div', { className: "flex items-center justify-between" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "font-medium text-sm" }, person.nom),
                                        React.createElement('div', { className: "text-xs text-gray-600" }, person.poste),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, person.succursale)
                                    ),
                                    React.createElement('div', {
                                        className: `w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                            selected ? 'bg-blue-500 border-blue-500' : 
                                            available ? 'border-green-400' : 'border-red-400'
                                        }`
                                    }, selected && React.createElement(Icon, { name: 'check', size: 12, className: "text-white" }))
                                ),
                                !available && React.createElement('div', { 
                                    className: "text-xs text-red-600 mt-1 font-medium" 
                                }, "‚ö†Ô∏è Non disponible pour cette p√©riode")
                            );
                        })
                    )
                ),

                // √âquipements avec vue d'ensemble
                React.createElement('div', null,
                    React.createElement('div', { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3" },
                        React.createElement('h3', { className: "text-lg font-semibold flex items-center gap-2" },
                            React.createElement(Icon, { name: 'tool', size: 20 }),
                            `√âquipements (${selectedEquipements.length} s√©lectionn√©${selectedEquipements.length !== 1 ? 's' : ''})`
                        ),
                        React.createElement('select', {
                            value: filtreEquipementBureau,
                            onChange: (e) => setFiltreEquipementBureau(e.target.value),
                            className: "px-3 py-1 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500"
                        },
                            React.createElement('option', { value: "tous" }, "Tous les bureaux"),
                            React.createElement('option', { value: "MDL - Sherbrooke" }, "MDL - Sherbrooke"),
                            React.createElement('option', { value: "MDL - Terrebonne" }, "MDL - Terrebonne"),
                            React.createElement('option', { value: "MDL - Qu√©bec" }, "MDL - Qu√©bec"),
                            React.createElement('option', { value: "DUAL - √âlectrotech" }, "DUAL - √âlectrotech"),
                            React.createElement('option', { value: "CFM" }, "CFM"),
                            React.createElement('option', { value: "Surplec" }, "Surplec")
                        )
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-48 overflow-y-auto" },
                        ...equipements.filter(equipement => {
                            const matchesBureau = filtreEquipementBureau === 'tous' || equipement.succursale === filtreEquipementBureau;
                            return matchesBureau;
                        }).map(equipement => {
                            const available = isResourceAvailable(equipement.id, 'equipement');
                            const selected = selectedEquipements.includes(equipement.id);
                            
                            return React.createElement('div', {
                                key: equipement.id,
                                className: `p-3 border rounded-lg cursor-pointer transition-all ${
                                    selected ? 'selected-resource' : 
                                    available ? 'available-resource hover:shadow-md' : 
                                    'busy-resource opacity-60'
                                }`,
                                onClick: available ? () => toggleEquipement(equipement.id) : undefined
                            },
                                React.createElement('div', { className: "flex items-center justify-between" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "font-medium text-sm" }, equipement.nom),
                                        React.createElement('div', { className: "text-xs text-gray-600" }, equipement.type),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, equipement.succursale)
                                    ),
                                    React.createElement('div', {
                                        className: `w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                            selected ? 'bg-blue-500 border-blue-500' : 
                                            available ? 'border-green-400' : 'border-red-400'
                                        }`
                                    }, selected && React.createElement(Icon, { name: 'check', size: 12, className: "text-white" }))
                                ),
                                !available && React.createElement('div', { 
                                    className: "text-xs text-red-600 mt-1 font-medium" 
                                }, "‚ö†Ô∏è Non disponible pour cette p√©riode")
                            );
                        })
                    )
                ),

                // Sous-traitants
                React.createElement('div', null,
                    React.createElement('h3', { className: "text-lg font-semibold mb-3 flex items-center gap-2" },
                        React.createElement(Icon, { name: 'building', size: 20 }),
                        `Sous-traitants (${selectedSousTraitants.length} s√©lectionn√©${selectedSousTraitants.length !== 1 ? 's' : ''})`
                    ),
                    
                    // Champ d'ajout de sous-traitant
                    React.createElement('div', { className: "mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200" },
                        React.createElement('div', { className: "flex gap-2" },
                            React.createElement('input', {
                                type: "text",
                                value: newSousTraitant,
                                onChange: (e) => setNewSousTraitant(e.target.value),
                                placeholder: "Nom du sous-traitant √† ajouter...",
                                className: "flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                onKeyPress: (e) => {
                                    if (e.key === 'Enter') {
                                        e.preventDefault();
                                        handleAddSousTraitant();
                                    }
                                }
                            }),
                            React.createElement('button', {
                                type: "button",
                                onClick: handleAddSousTraitant,
                                disabled: !newSousTraitant.trim(),
                                className: "px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                            },
                                React.createElement(Icon, { name: 'plus', size: 16 }),
                                React.createElement('span', { className: "hidden sm:inline" }, "Ajouter")
                            )
                        ),
                        React.createElement('p', { className: "text-xs text-blue-600 mt-2" },
                            "üí° Ajoutez des sous-traitants pour ce projet en tapant leur nom ci-dessus"
                        )
                    ),

                    // Liste des sous-traitants existants
                    sousTraitants.length > 0 && React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-48 overflow-y-auto" },
                        ...sousTraitants.map(sousTraitant => {
                            const available = isResourceAvailable(sousTraitant.id, 'sousTraitant');
                            const selected = selectedSousTraitants.includes(sousTraitant.id);
                            
                            return React.createElement('div', {
                                key: sousTraitant.id,
                                className: `p-3 border rounded-lg cursor-pointer transition-all ${
                                    selected ? 'selected-resource' : 
                                    available ? 'available-resource hover:shadow-md' : 
                                    'busy-resource opacity-60'
                                }`,
                                onClick: available ? () => toggleSousTraitant(sousTraitant.id) : undefined
                            },
                                React.createElement('div', { className: "flex items-center justify-between" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "font-medium text-sm" }, sousTraitant.nom),
                                        React.createElement('div', { className: "text-xs text-gray-600" }, sousTraitant.specialite),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, sousTraitant.tarif)
                                    ),
                                    React.createElement('div', {
                                        className: `w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                            selected ? 'bg-blue-500 border-blue-500' : 
                                            available ? 'border-green-400' : 'border-red-400'
                                        }`
                                    }, selected && React.createElement(Icon, { name: 'check', size: 12, className: "text-white" }))
                                ),
                                !available && React.createElement('div', { 
                                    className: "text-xs text-red-600 mt-1 font-medium" 
                                }, "‚ö†Ô∏è Non disponible pour cette p√©riode")
                            );
                        })
                    )
                ),

                // R√©sum√© de s√©lection avec √©quipements
                (selectedPersonnel.length > 0 || selectedEquipements.length > 0 || selectedSousTraitants.length > 0) &&
                React.createElement('div', { className: "bg-blue-50 border border-blue-200 rounded-lg p-4" },
                    React.createElement('h4', { className: "font-semibold text-blue-900 mb-2" }, "Ressources s√©lectionn√©es :"),
                    React.createElement('div', { className: "flex flex-wrap gap-2" },
                        ...selectedPersonnel.map(id => {
                            const person = personnel.find(p => p.id === id);
                            return person && React.createElement('span', {
                                key: `p-${id}`,
                                className: "resource-badge selected-resource text-xs"
                            },
                                React.createElement(Icon, { name: 'user', size: 10 }),
                                person.nom
                            );
                        }),
                        ...selectedEquipements.map(id => {
                            const equipement = equipements.find(e => e.id === id);
                            return equipement && React.createElement('span', {
                                key: `e-${id}`,
                                className: "resource-badge selected-resource text-xs"
                            },
                                React.createElement(Icon, { name: 'tool', size: 10 }),
                                equipement.nom
                            );
                        }),
                        ...selectedSousTraitants.map(id => {
                            const sousTraitant = sousTraitants.find(s => s.id === id);
                            return sousTraitant && React.createElement('span', {
                                key: `s-${id}`,
                                className: "resource-badge selected-resource text-xs"
                            },
                                React.createElement(Icon, { name: 'building', size: 10 }),
                                sousTraitant.nom
                            );
                        })
                    )
                )
            );
        };

        // ============== MODAL JOB AM√âLIOR√â ==============
        
        const JobModal = ({ 
            isOpen, 
            onClose, 
            job, 
            onSave, 
            onDelete,
            personnel,
            equipements,
            sousTraitants,
            addSousTraitant,
            jobs,
            selectedCell,
            addNotification,
            peutModifier = true,
            estCoordonnateur = false
        }) => {
            const [expandedSections, setExpandedSections] = useState({
                etapes: false,
                preparation: false
            });

            const [formData, setFormData] = useState({
                numeroJob: '',
                nom: '',
                description: '',
                dateDebut: '',
                heureDebut: '08:00',
                dateFin: '',
                heureFin: '17:00',
                personnel: [],
                equipements: [],
                sousTraitants: [],
                lieu: '',
                priorite: 'normale',
                statut: 'planifie',
                bureau: '',
                client: '',
                budget: '',
                notes: '',
                documents: [],
                photos: [],
                dureePreviewHours: '', // Dur√©e pr√©vue en heures
                includeWeekendsInDuration: false, // Inclure fins de semaine dans calcul dur√©e
                etapes: [], // [{text: '', completed: false, duration: 1, isParallel: false, dependencies: [], priority: 'normal', baseline: {startDate: '', endDate: '', duration: 1}}]
                preparation: [], // Liste de pr√©paration [{text: '', statut: 'a_reserver|en_commande|fait'}]
                typeHoraire: 'jour', // 'jour', 'nuit' ou '24h'
                horairesIndividuels: {}, // {personnelId: 'jour'|'nuit'}
                recurrence: {
                    active: false,
                    type: 'hebdomadaire', // 'hebdomadaire', 'mensuel', 'annuel'
                    intervalle: 1, // Tous les X semaines/mois/ann√©es
                    finRecurrence: 'date', // 'date' ou 'occurrences'
                    dateFinRecurrence: '',
                    nombreOccurrences: 10
                },
                equipes: [], // [{id: '', nom: '', membres: [], horaire: 'jour|nuit', heureDebut: '', heureFin: '', actif: true}]
                assignationsEquipes: {}, // {etapeIndex: equipeId}
                modeHoraireEquipes: 'global', // 'global' ou 'individuel'
                // Fonctionnalit√©s Gantt avanc√©es
                ganttBaseline: {}, // Sauvegarde du planning initial
                criticalPath: [], // Chemin critique automatiquement calcul√©
                showCriticalPath: false, // Affichage du chemin critique
                ganttViewMode: 'days', // 'hours', 'days', 'weeks', 'months'
                // Syst√®me d'√©quipes illimit√©es ultra-intelligent
                equipesNumerotees: {}, // {id: {membres: [personnelIds], nom: '√âquipe X', actif: true, horaire: 'jour|nuit', auto: true}}
                ganttMode: 'individuel', // 'individuel' ou 'equipe'
                prochainNumeroEquipe: 1, // Compteur auto-incr√©ment√©
                equipeAutoGeneration: true // G√©n√©ration automatique selon horaire
            });

            const [modificationMode, setModificationMode] = useState('groupe');
            const [ressourceIndividuelle, setRessourceIndividuelle] = useState(null);
            const [typeRessourceIndividuelle, setTypeRessourceIndividuelle] = useState('personnel');
            const [modificationsIndividuelles, setModificationsIndividuelles] = useState({});
            const [newSousTraitant, setNewSousTraitant] = useState('');
            
            // √âtats pour les fonctionnalit√©s Gantt avanc√©es
            const [activeTab, setActiveTab] = useState('form'); // 'form' ou 'gantt'
            const [ganttFullscreen, setGanttFullscreen] = useState(false);
            const [ganttData, setGanttData] = useState({
                tasks: [],
                assignments: [],
                mode: 'global' // 'global' ou 'individuel'
            });

            // Fonctions de gestion des fichiers
            const handleFilesAdded = (files, type) => {
                const newFiles = files.map(file => ({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    url: URL.createObjectURL(file),
                    file: file
                }));

                if (type === 'documents') {
                    setFormData(prev => ({
                        ...prev,
                        documents: [...prev.documents, ...newFiles]
                    }));
                } else if (type === 'photos') {
                    setFormData(prev => ({
                        ...prev,
                        photos: [...prev.photos, ...newFiles]
                    }));
                }
            };

            const removeFile = (fileToRemove, type) => {
                if (type === 'documents') {
                    setFormData(prev => ({
                        ...prev,
                        documents: prev.documents.filter(f => f.id !== fileToRemove.id)
                    }));
                } else if (type === 'photos') {
                    setFormData(prev => ({
                        ...prev,
                        photos: prev.photos.filter(f => f.id !== fileToRemove.id)
                    }));
                }
            };

            // G√©n√©rer un num√©ro de job automatique
            const generateJobNumber = useCallback(() => {
                const year = new Date().getFullYear();
                const month = String(new Date().getMonth() + 1).padStart(2, '0');
                const existingNumbers = jobs
                    .filter(j => j.numeroJob?.startsWith(`G${year.toString().slice(-2)}-${month}`))
                    .map(j => parseInt(j.numeroJob.split('-')[1]) || 0);
                const nextNumber = Math.max(0, ...existingNumbers) + 1;
                return `G${year.toString().slice(-2)}-${month}${String(nextNumber).padStart(2, '0')}`;
            }, [jobs]);

            // Fonction pour ajouter un sous-traitant
            const handleAddSousTraitant = () => {
                if (newSousTraitant.trim()) {
                    const newId = addSousTraitant(newSousTraitant);
                    if (newId) {
                        setFormData(prev => ({
                            ...prev,
                            sousTraitants: [...(prev.sousTraitants || []), newId]
                        }));
                        setNewSousTraitant('');
                        addNotification(`Sous-traitant "${newSousTraitant}" ajout√© avec succ√®s`, 'success');
                    }
                }
            };

            // ============== FONCTIONS GANTT AVANC√âES ==============
            
            // Calcul de la charge de travail par √©quipe
            const calculateTeamWorkload = (equipes, etapes, assignationsEquipes) => {
                const workload = {};
                
                equipes.forEach(equipe => {
                    workload[equipe.id] = {
                        team: equipe,
                        tasks: [],
                        totalHours: 0,
                        estimatedEndTime: null
                    };
                });
                
                // Calculer les t√¢ches assign√©es √† chaque √©quipe
                Object.entries(assignationsEquipes || {}).forEach(([etapeIndex, equipeId]) => {
                    const etape = etapes[parseInt(etapeIndex)];
                    if (etape && workload[equipeId]) {
                        workload[equipeId].tasks.push({
                            index: parseInt(etapeIndex),
                            etape: etape,
                            duration: etape.duration || 0.25
                        });
                        workload[equipeId].totalHours += (etape.duration || 0.25);
                    }
                });
                
                return workload;
            };
            
            const generateGanttTasks = () => {
                if (!formData.etapes.length || !formData.dateDebut) {
                    return [];
                }
                const startDate = new Date(formData.dateDebut + 'T' + (formData.heureDebut || '08:00'));
                
                // Calculer les heures par jour selon le type d'horaire
                let dailyHours;
                if (formData.typeHoraire === '24h') {
                    dailyHours = 24;
                } else {
                    const [debutH, debutM] = (formData.heureDebut || '08:00').split(':').map(Number);
                    const [finH, finM] = (formData.heureFin || '17:00').split(':').map(Number);
                    const debutMinutes = debutH * 60 + debutM;
                    const finMinutes = finH * 60 + finM;
                    dailyHours = Math.max(1, (finMinutes - debutMinutes) / 60);
                }
                
                // V6.5 ULTRA: Filtrer les √©tapes actives
                const etapesActives = formData.etapes.filter(e => e.text.trim());
                if (etapesActives.length === 0) return [];
                
                // V6.5 ULTRA: Algorithme de planification avec d√©pendances (surpasse MS Project)
                const tasks = [];
                const taskCompletionTimes = {}; // Stockage des temps de fin de chaque t√¢che
                
                // Fonction pour calculer la date de d√©but d'une t√¢che bas√©e sur ses d√©pendances
                const calculateStartDate = (etape, etapeIndex) => {
                    let startTime = new Date(startDate);
                    
                    if (etape.dependencies && etape.dependencies.length > 0) {
                        let latestEndTime = new Date(startDate);
                        
                        etape.dependencies.forEach(depIndex => {
                            const depTask = tasks.find(t => t.originalIndex === depIndex);
                            if (depTask) {
                                let depEndTime = new Date(depTask.endDate);
                                const dependencyType = etape.dependencyType || 'FS';
                                const leadLag = (etape.leadLag || 0) * 60 * 60 * 1000; // Convert hours to ms
                                
                                switch (dependencyType) {
                                    case 'FS': // Finish-to-Start (d√©faut MS Project)
                                        depEndTime = new Date(depTask.endDate);
                                        break;
                                    case 'SS': // Start-to-Start
                                        depEndTime = new Date(depTask.startDate);
                                        break;
                                    case 'FF': // Finish-to-Finish
                                        depEndTime = new Date(depTask.endDate);
                                        const taskDuration = (etape.duration || 0.25) * 60 * 60 * 1000;
                                        depEndTime = new Date(depEndTime.getTime() - taskDuration);
                                        break;
                                    case 'SF': // Start-to-Finish
                                        depEndTime = new Date(depTask.startDate);
                                        const currentTaskDuration = (etape.duration || 0.25) * 60 * 60 * 1000;
                                        depEndTime = new Date(depEndTime.getTime() - currentTaskDuration);
                                        break;
                                }
                                
                                // Appliquer le lead/lag
                                depEndTime.setTime(depEndTime.getTime() + leadLag);
                                
                                if (depEndTime > latestEndTime) {
                                    latestEndTime = depEndTime;
                                }
                            }
                        });
                        
                        startTime = latestEndTime;
                    }
                    
                    return startTime;
                };
                
                // Trier les √©tapes par ordre de d√©pendance (topological sort)
                const sortedEtapes = [];
                const visited = new Set();
                const visiting = new Set();
                
                const visit = (etapeIndex) => {
                    if (visiting.has(etapeIndex)) {
                        console.warn(`D√©pendance circulaire d√©tect√©e √† l'√©tape ${etapeIndex + 1}`);
                        return;
                    }
                    
                    if (visited.has(etapeIndex)) return;
                    
                    visiting.add(etapeIndex);
                    const etape = etapesActives[etapeIndex];
                    
                    if (etape && etape.dependencies) {
                        etape.dependencies.forEach(depIndex => {
                            if (depIndex < etapesActives.length) {
                                visit(depIndex);
                            }
                        });
                    }
                    
                    visiting.delete(etapeIndex);
                    visited.add(etapeIndex);
                    sortedEtapes.push({ etape, originalIndex: etapeIndex });
                };
                
                // Visiter toutes les √©tapes
                for (let i = 0; i < etapesActives.length; i++) {
                    visit(i);
                }
                
                // Traiter les √©tapes dans l'ordre de d√©pendance
                sortedEtapes.forEach(({ etape, originalIndex }) => {
                    const taskDuration = etape.duration || 0.25;
                    const taskStartTime = calculateStartDate(etape, originalIndex);
                    const taskEndTime = new Date(taskStartTime);
                    taskEndTime.setTime(taskStartTime.getTime() + (taskDuration * 60 * 60 * 1000));
                    
                    tasks.push({
                        id: etape.id || `task-${originalIndex}`,
                        name: etape.text,
                        startDate: taskStartTime.toISOString(),
                        endDate: taskEndTime.toISOString(),
                        duration: taskDuration,
                        completed: etape.completed || false,
                        order: originalIndex,
                        priority: etape.priority || 'normal',
                        isParallel: etape.isParallel || false,
                        dependencies: etape.dependencies || [],
                        dependencyType: etape.dependencyType || 'FS',
                        leadLag: etape.leadLag || 0,
                        originalIndex: originalIndex // Pour les r√©f√©rences
                    });
                    
                    taskCompletionTimes[originalIndex] = taskEndTime;
                });
                
                // V6.5 ULTRA: Calcul du chemin critique avec les nouvelles d√©pendances
                const criticalPath = calculateCriticalPath(tasks);
                
                return tasks;
            };

            const generateGanttAssignments = (tasks) => {
                if (ganttData.mode === 'global') {
                    // Mode global : toutes les ressources sur toutes les t√¢ches
                    const assignments = [];
                    tasks.forEach(task => {
                        const taskIndex = task.order || task.id;
                        const assignedTeamId = (formData.assignationsEquipes || {})[taskIndex];
                        
                        // V6.4 Ultra-Pro: Gestion √©quipes num√©rot√©es
                        if (assignedTeamId && assignedTeamId.startsWith('equipe-') && formData.equipesNumerotees) {
                            const equipeNum = assignedTeamId.replace('equipe-', '');
                            const assignedEquipe = formData.equipesNumerotees[equipeNum];
                            if (assignedEquipe && assignedEquipe.actif) {
                                // Mode √âquipe: Assigner tous les membres de l'√©quipe num√©rot√©e
                                (assignedEquipe.membres || []).forEach(membreId => {
                                    const person = personnel.find(p => p.id === membreId);
                                    if (person) {
                                        assignments.push({
                                            taskId: task.id,
                                            resourceId: membreId,
                                            resourceName: person.nom,
                                            resourceType: 'personnel',
                                            workType: formData.typeHoraire,
                                            teamId: `equipe-${equipeNum}`,
                                            teamName: `√âquipe ${equipeNum}`,
                                            teamColor: assignedEquipe.couleur,
                                            isNumericTeam: true
                                        });
                                    }
                                });
                            }
                        } else if (assignedTeamId && formData.equipes) {
                            // Mode classique avec √©quipes personnalis√©es
                            const assignedTeam = (formData.equipes || []).find(eq => eq.id === assignedTeamId && eq.actif);
                            if (assignedTeam) {
                                // Assigner tous les membres de l'√©quipe √† cette t√¢che
                                assignedTeam.membres.forEach(membreId => {
                                    const person = personnel.find(p => p.id === membreId);
                                    if (person) {
                                        assignments.push({
                                            taskId: task.id,
                                            resourceId: membreId,
                                            resourceName: person.nom,
                                            resourceType: 'personnel',
                                            workType: formData.typeHoraire,
                                            teamId: assignedTeamId,
                                            teamName: assignedTeam.nom
                                        });
                                    }
                                });
                            }
                        } else if (formData.ganttMode === 'individuel') {
                            // Mode standard : assigner tout le personnel s√©lectionn√©
                            formData.personnel.forEach(personId => {
                                const person = personnel.find(p => p.id === personId);
                                if (person) {
                                    assignments.push({
                                        taskId: task.id,
                                        resourceId: personId,
                                        resourceName: person.nom,
                                        resourceType: 'personnel',
                                        workType: formData.typeHoraire
                                    });
                                }
                            });
                        }
                        
                        // Assigner les √©quipements (inchang√©)
                        formData.equipements.forEach(equipId => {
                            const equip = equipements.find(e => e.id === equipId);
                            if (equip) {
                                assignments.push({
                                    taskId: task.id,
                                    resourceId: equipId,
                                    resourceName: equip.nom,
                                    resourceType: 'equipement',
                                    workType: formData.typeHoraire
                                });
                            }
                        });
                    });
                    return assignments;
                } else {
                    // Mode individuel : assignations sp√©cifiques par t√¢che
                    return [];
                }
            };

            // V6.7: ALGORITHME PROFESSIONNEL CPM (Critical Path Method)
            const calculateCriticalPath = (tasks) => {
                if (!tasks || tasks.length === 0) return [];
                
                try {
                    // Initialisation avec calculs Forward Pass (ES/EF)
                    const taskMap = new Map();
                    tasks.forEach(task => {
                        taskMap.set(task.id, {
                            ...task,
                            ES: 0, // Earliest Start
                            EF: 0, // Earliest Finish
                            LS: 0, // Latest Start  
                            LF: 0, // Latest Finish
                            slack: 0,
                            predecessors: task.dependencies || [],
                            successors: []
                        });
                    });
                    
                    // Construire les liens successeurs
                    tasks.forEach(task => {
                        (task.dependencies || []).forEach(depId => {
                            if (taskMap.has(depId)) {
                                taskMap.get(depId).successors.push(task.id);
                            }
                        });
                    });
                    
                    // FORWARD PASS - Calcul ES et EF
                    const visited = new Set();
                    const calculateEarlyTimes = (taskId) => {
                        if (visited.has(taskId)) return;
                        visited.add(taskId);
                        
                        const task = taskMap.get(taskId);
                        if (!task) return;
                        
                        // Calculer ES (max EF des pr√©d√©cesseurs)
                        if (task.predecessors.length === 0) {
                            task.ES = 0;
                        } else {
                            task.ES = Math.max(...task.predecessors.map(predId => {
                                const pred = taskMap.get(predId);
                                if (pred) {
                                    calculateEarlyTimes(predId);
                                    return pred.EF;
                                }
                                return 0;
                            }));
                        }
                        
                        // EF = ES + dur√©e (en jours)
                        task.EF = task.ES + Math.ceil((task.duration || 8) / 8);
                    };
                    
                    tasks.forEach(task => calculateEarlyTimes(task.id));
                    
                    // BACKWARD PASS - Calcul LS et LF
                    const finalTasks = Array.from(taskMap.values()).filter(task => task.successors.length === 0);
                    const projectEF = Math.max(...finalTasks.map(task => task.EF));
                    
                    const visitedBackward = new Set();
                    const calculateLateTimes = (taskId) => {
                        if (visitedBackward.has(taskId)) return;
                        visitedBackward.add(taskId);
                        
                        const task = taskMap.get(taskId);
                        if (!task) return;
                        
                        // Calculer LF (min LS des successeurs)
                        if (task.successors.length === 0) {
                            task.LF = projectEF;
                        } else {
                            task.LF = Math.min(...task.successors.map(succId => {
                                const succ = taskMap.get(succId);
                                if (succ) {
                                    calculateLateTimes(succId);
                                    return succ.LS;
                                }
                                return projectEF;
                            }));
                        }
                        
                        // LS = LF - dur√©e
                        task.LS = task.LF - Math.ceil((task.duration || 8) / 8);
                        task.slack = task.LS - task.ES;
                    };
                    
                    finalTasks.forEach(task => calculateLateTimes(task.id));
                    
                    // Identifier le chemin critique (slack = 0)
                    const criticalTaskIds = Array.from(taskMap.values())
                        .filter(task => Math.abs(task.slack) < 0.1)
                        .map(task => task.id);
                    
                    console.log('üéØ Chemin critique CPM:', criticalTaskIds);
                    return criticalTaskIds;
                    
                } catch (error) {
                    console.error('‚ùå Erreur calcul CPM:', error);
                    // Fallback sur l'ancien algorithme
                    return tasks.length > 0 ? [tasks[tasks.length - 1].id] : [];
                }
            };

            // Fonctions pour √©quipes illimit√©es ultra-intelligentes
            const creerNouvelleEquipe = (horaire = null) => {
                const nouveauNumero = formData.prochainNumeroEquipe || 1;
                const horaireDetecte = horaire || detecterHorairePrincipal();
                const equipesExistantes = {...(formData.equipesNumerotees || {})};
                
                console.log(`üîß Cr√©ation √©quipe ${nouveauNumero}, horaire: ${horaireDetecte}`);
                console.log(`üìä √âquipes existantes avant:`, equipesExistantes);
                
                const nouvelleEquipe = {
                    membres: [],
                    nom: `√âquipe ${nouveauNumero}`,
                    actif: true,
                    couleur: getEquipeColor(nouveauNumero),
                    horaire: horaireDetecte,
                    auto: horaire === null
                };
                
                equipesExistantes[nouveauNumero] = nouvelleEquipe;
                console.log(`üìä √âquipes apr√®s ajout:`, equipesExistantes);
                
                // Mise √† jour en une seule fois avec les deux valeurs
                setFormData(prev => ({
                    ...prev,
                    equipesNumerotees: equipesExistantes,
                    prochainNumeroEquipe: nouveauNumero + 1
                }));
                
                console.log(`‚úÖ √âquipe ${nouveauNumero} cr√©√©e, prochain num√©ro: ${nouveauNumero + 1}`);
                return nouvelleEquipe;
            };


            const detecterHorairePrincipal = () => {
                if (formData.typeHoraire === '24h') {
                    return 'jour'; // Par d√©faut jour en 24h
                }
                return formData.typeHoraire; // 'jour' ou 'nuit'
            };

            const getEquipeColor = (numero) => {
                const couleurs = [
                    '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', 
                    '#06B6D4', '#84CC16', '#F97316', '#EC4899', '#6366F1',
                    '#14B8A6', '#A855F7', '#F43F5E', '#8B5A2B', '#059669',
                    '#7C3AED', '#DC2626', '#0891B2', '#CA8A04', '#BE123C'
                ];
                return couleurs[(numero - 1) % couleurs.length];
            };

            const supprimerEquipe = (numeroEquipe) => {
                console.log(`üóëÔ∏è Suppression √©quipe ${numeroEquipe}`);
                const equipesExistantes = {...formData.equipesNumerotees};
                delete equipesExistantes[numeroEquipe];
                
                // Nettoyer les assignations
                const assignationsNettoyees = {...formData.assignationsEquipes};
                Object.keys(assignationsNettoyees).forEach(etapeIndex => {
                    if (assignationsNettoyees[etapeIndex] === `equipe-${numeroEquipe}`) {
                        delete assignationsNettoyees[etapeIndex];
                    }
                });
                
                // Mise √† jour en une seule fois
                setFormData(prev => ({
                    ...prev,
                    equipesNumerotees: equipesExistantes,
                    assignationsEquipes: assignationsNettoyees
                }));
                
                console.log(`‚úÖ √âquipe ${numeroEquipe} supprim√©e`);
            };

            const modifierEquipe = (numeroEquipe, modifications) => {
                const equipesExistantes = {...formData.equipesNumerotees};
                if (equipesExistantes[numeroEquipe]) {
                    equipesExistantes[numeroEquipe] = {
                        ...equipesExistantes[numeroEquipe],
                        ...modifications
                    };
                    updateField('equipesNumerotees', equipesExistantes);
                }
            };

            const assignerPersonnelEquipe = (personnelId, equipeNum) => {
                console.log('üéØ Assignation personnel:', { personnelId, equipeNum });
                
                if (!personnelId) {
                    console.error('‚ùå PersonnelId manquant');
                    return;
                }
                
                const equipesNumerotees = {...(formData.equipesNumerotees || {})};
                
                // S'assurer que toutes les √©quipes ont un tableau membres
                Object.keys(equipesNumerotees).forEach(num => {
                    if (!equipesNumerotees[num].membres) {
                        equipesNumerotees[num].membres = [];
                    }
                });
                
                // Retirer de toutes les autres √©quipes
                Object.keys(equipesNumerotees).forEach(num => {
                    const avant = equipesNumerotees[num].membres.length;
                    equipesNumerotees[num].membres = equipesNumerotees[num].membres.filter(id => id !== personnelId);
                    if (avant !== equipesNumerotees[num].membres.length) {
                        console.log(`üì§ Retir√© de √©quipe ${num}`);
                    }
                });
                
                // Ajouter √† la nouvelle √©quipe si sp√©cifi√©e
                if (equipeNum && equipesNumerotees[equipeNum]) {
                    if (!equipesNumerotees[equipeNum].membres.includes(personnelId)) {
                        equipesNumerotees[equipeNum].membres.push(personnelId);
                        console.log(`üì• Ajout√© √† √©quipe ${equipeNum}`);
                    }
                } else if (equipeNum) {
                    console.warn(`‚ö†Ô∏è √âquipe ${equipeNum} n'existe pas`);
                }
                
                console.log('üìä √âquipes apr√®s assignation:', equipesNumerotees);
                setFormData(prev => ({
                    ...prev,
                    equipesNumerotees: equipesNumerotees
                }));
            };

            const getPersonnelEquipe = (personnelId) => {
                if (!formData.equipesNumerotees) return null;
                for (const [num, equipe] of Object.entries(formData.equipesNumerotees)) {
                    if (equipe.membres && equipe.membres.includes(personnelId)) {
                        return parseInt(num);
                    }
                }
                return null;
            };

            // V6.2: Fonction de sauvegarde baseline
            const saveBaseline = () => {
                const tasks = generateGanttTasks();
                const baseline = {
                    tasks: tasks.map(task => ({
                        id: task.id,
                        startDate: task.startDate,
                        endDate: task.endDate,
                        duration: task.duration
                    })),
                    savedDate: new Date().toISOString(),
                    totalDuration: tasks.reduce((sum, task) => sum + task.duration, 0)
                };
                
                updateField('ganttBaseline', baseline);
                return baseline;
            };

            const updateGanttData = () => {
                const tasks = generateGanttTasks();
                const assignments = generateGanttAssignments(tasks);
                
                // V6.2: Calcul automatique du chemin critique
                const criticalPath = formData.showCriticalPath ? calculateCriticalPath(tasks) : [];
                
                setGanttData(prev => ({
                    ...prev,
                    tasks,
                    assignments,
                    criticalPath
                }));
            };

            // Fonction pour recalculer les dates apr√®s r√©organisation
            const redistributeTaskDates = (tasks, formData) => {
                if (!tasks.length || !formData.dateDebut || !formData.dureePreviewHours) return tasks;
                
                const baseDate = new Date(`${formData.dateDebut}T${formData.heureDebut || '08:00'}`);
                let currentDate = new Date(baseDate);
                
                const getWorkingHoursPerDay = () => {
                    if (formData.typeHoraire === '24h') return 24;
                    const [startHour, startMin] = (formData.heureDebut || '08:00').split(':').map(Number);
                    const [endHour, endMin] = (formData.heureFin || '17:00').split(':').map(Number);
                    return (endHour + endMin/60) - (startHour + startMin/60);
                };
                
                const hoursPerDay = getWorkingHoursPerDay();
                const totalDuration = parseFloat(formData.dureePreviewHours);
                const stepDuration = totalDuration / tasks.length;
                
                return tasks.map((task, index) => {
                    const stepStartDate = new Date(currentDate);
                    const stepEndDate = new Date(currentDate);
                    stepEndDate.setHours(stepEndDate.getHours() + stepDuration);
                    
                    currentDate = new Date(stepEndDate);
                    
                    return {
                        ...task,
                        startDate: stepStartDate.toISOString(),
                        endDate: stepEndDate.toISOString(),
                        duration: stepDuration,
                        order: index
                    };
                });
            };

            // V6.4 Ultra-Pro: Synchronisation bidirectionnelle automatique
            useEffect(() => {
                if (activeTab === 'gantt') {
                    updateGanttData();
                }
            }, [formData.etapes, formData.dureePreviewHours, formData.dateDebut, formData.heureDebut, formData.heureFin, formData.typeHoraire, formData.includeWeekendsInDuration, formData.personnel, ganttData.mode, activeTab, formData.equipesNumerotees, formData.assignationsEquipes, formData.ganttMode]);

            // Synchronisation automatique des modifications Gantt vers l'√©v√©nement
            const syncGanttToEvent = () => {
                // Calculer automatiquement la dur√©e totale du projet selon les √©tapes
                if (formData.etapes && formData.etapes.length > 0) {
                    const totalDuration = formData.etapes.reduce((sum, etape) => {
                        return sum + (parseFloat(etape.duration) || 0.25);
                    }, 0);
                    
                    // Mettre √† jour automatiquement si diff√©rent
                    if (totalDuration !== parseFloat(formData.dureePreviewHours || 0)) {
                        updateField('dureePreviewHours', totalDuration.toString());
                    }
                }
            };

            // Auto-sync quand les √©tapes changent
            useEffect(() => {
                syncGanttToEvent();
            }, [formData.etapes]);

            // S√©curit√© pour les √©quipes au chargement
            useEffect(() => {
                if (formData.equipesNumerotees && Object.keys(formData.equipesNumerotees).length > 0) {
                    const equipesCorrigees = {...formData.equipesNumerotees};
                    let needsUpdate = false;
                    
                    Object.keys(equipesCorrigees).forEach(num => {
                        if (!Array.isArray(equipesCorrigees[num].membres)) {
                            equipesCorrigees[num].membres = [];
                            needsUpdate = true;
                            console.log(`üîß Correction membres √©quipe ${num}`);
                        }
                    });
                    
                    if (needsUpdate) {
                        updateField('equipesNumerotees', equipesCorrigees);
                    }
                }
            }, [formData.equipesNumerotees]);

            // Initialiser le formulaire
            useEffect(() => {
                if (isOpen) {
                    if (job) {
                        // Migration des anciennes donn√©es vers le nouveau format
                        setFormData({
                            ...job,
                            personnel: Array.isArray(job.personnel) ? job.personnel : [],
                            equipements: Array.isArray(job.equipements) ? job.equipements : [],
                            sousTraitants: Array.isArray(job.sousTraitants) ? job.sousTraitants : [],
                            documents: Array.isArray(job.documents) ? job.documents : [],
                            photos: Array.isArray(job.photos) ? job.photos : [],
                            etapes: Array.isArray(job.etapes) ? job.etapes : [],
                            preparation: Array.isArray(job.preparation) ? job.preparation : [],
                            horairesIndividuels: job.horairesIndividuels || {},
                            recurrence: job.recurrence || {
                                active: false,
                                type: 'hebdomadaire',
                                intervalle: 1,
                                finRecurrence: 'date',
                                dateFin: '',
                                nombreOccurrences: 1,
                                joursApplicables: []
                            }
                        });
                        setModificationMode('groupe');
                    } else {
                        const today = new Date().toISOString().split('T')[0];
                        setFormData({
                            numeroJob: '',
                            nom: '',
                            description: '',
                            dateDebut: selectedCell?.date || today,
                            heureDebut: '08:00',
                            dateFin: selectedCell?.date || today,
                            heureFin: '17:00',
                            personnel: selectedCell?.personnelId ? [selectedCell.personnelId] : [],
                            equipements: [],
                            sousTraitants: [],
                            lieu: '',
                            priorite: 'normale',
                            statut: 'planifie',
                            bureau: '',
                            client: '',
                            budget: '',
                            notes: '',
                            documents: [],
                            photos: [],
                            dureePreviewHours: '',
                            includeWeekendsInDuration: false,
                            etapes: [],
                            preparation: [],
                            typeHoraire: 'jour',
                            horairesIndividuels: {}
                        });
                        setModificationMode('groupe');
                    }
                }
            }, [isOpen, job, generateJobNumber, selectedCell]);

            // Charger les plannings individuels existants quand on change de ressource
            useEffect(() => {
                if (ressourceIndividuelle && job?.planningsIndividuels?.[ressourceIndividuelle]) {
                    const planning = job.planningsIndividuels[ressourceIndividuelle];
                    setModificationsIndividuelles(prev => ({
                        ...prev,
                        [ressourceIndividuelle]: {
                            dateDebut: planning.dateDebut,
                            dateFin: planning.dateFin,
                            heureDebut: planning.heureDebut,
                            heureFin: planning.heureFin
                        }
                    }));
                }
            }, [ressourceIndividuelle, job]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.numeroJob || !formData.nom || !formData.dateDebut || !formData.bureau) {
                    addNotification('Veuillez remplir les champs obligatoires (num√©ro, nom, date d√©but, bureau)', 'error');
                    return;
                }

                if (formData.personnel.length === 0 && formData.sousTraitants.length === 0) {
                    addNotification('Veuillez assigner au moins une personne ou un sous-traitant', 'error');
                    return;
                }
                
                if (job && modificationMode === 'individuel' && !ressourceIndividuelle) {
                    addNotification('Veuillez s√©lectionner une ressource pour la modification individuelle', 'error');
                    return;
                }

                let jobData;
                
                if (job && modificationMode === 'individuel' && ressourceIndividuelle) {
                    // Mode modification individuel : ajouter planning personnalis√© √† l'√©v√©nement existant
                    const modifRessource = modificationsIndividuelles[ressourceIndividuelle];
                    
                    jobData = {
                        ...formData,
                        id: job.id,
                        dateCreation: job.dateCreation,
                        dateModification: new Date().toISOString(),
                        // Ajouter les plannings individuels
                        planningsIndividuels: (() => {
                            const plannings = { ...job.planningsIndividuels };
                            
                            if (modifRessource === null) {
                                // Supprimer le planning
                                delete plannings[ressourceIndividuelle];
                            } else if (modifRessource) {
                                // Ajouter/modifier le planning
                                plannings[ressourceIndividuelle] = {
                                    dateDebut: modifRessource.dateDebut || job.dateDebut,
                                    dateFin: modifRessource.dateFin || job.dateFin,
                                    heureDebut: modifRessource.heureDebut || job.heureDebut,
                                    heureFin: modifRessource.heureFin || job.heureFin,
                                    type: typeRessourceIndividuelle
                                };
                            }
                            
                            return plannings;
                        })()
                    };
                } else {
                    // Mode normal
                    jobData = {
                        ...formData,
                        id: job ? job.id : Date.now(),
                        dateCreation: job ? job.dateCreation : new Date().toISOString(),
                        dateModification: new Date().toISOString()
                    };
                }

                onSave(jobData);
                
                const message = job && modificationMode === 'individuel' && ressourceIndividuelle 
                    ? `Planning personnalis√© ajout√© pour ${
                        typeRessourceIndividuelle === 'personnel' 
                            ? personnel.find(p => p.id === ressourceIndividuelle)?.nom
                            : equipements.find(e => e.id === ressourceIndividuelle)?.nom
                    }`
                    : job ? 'Job modifi√© avec succ√®s' : 'Job cr√©√© avec succ√®s';
                    
                addNotification(message, 'success');
                onClose();
            };

            // Fonction pour calculer la date de fin bas√©e sur la dur√©e et le type d'horaire
            const calculateEndDate = (startDate, durationHours, typeHoraire, includeWeekends, heureDebut = '08:00', heureFin = '17:00') => {
                if (!startDate || !durationHours) return null;
                
                const start = new Date(startDate);
                let totalHours = parseFloat(durationHours);
                let currentDate = new Date(start);
                
                // Calculer les heures par jour selon le type d'horaire
                let dailyHours;
                if (typeHoraire === '24h') {
                    dailyHours = 24;
                } else {
                    // Pour jour/nuit, calculer les heures bas√©es sur heureDebut et heureFin
                    const [debutH, debutM] = heureDebut.split(':').map(Number);
                    const [finH, finM] = heureFin.split(':').map(Number);
                    const debutMinutes = debutH * 60 + debutM;
                    const finMinutes = finH * 60 + finM;
                    dailyHours = Math.max(1, (finMinutes - debutMinutes) / 60); // Au minimum 1h par jour
                }
                
                while (totalHours > 0) {
                    const dayOfWeek = currentDate.getDay(); // 0=dimanche, 6=samedi
                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                    
                    // Si on inclut pas les fins de semaine et c'est weekend, passer au jour suivant
                    if (!includeWeekends && isWeekend) {
                        currentDate.setDate(currentDate.getDate() + 1);
                        continue;
                    }
                    
                    // Soustraire les heures de la journ√©e
                    if (totalHours >= dailyHours) {
                        totalHours -= dailyHours;
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else {
                        // Derni√®re journ√©e partielle
                        break;
                    }
                }
                
                // Ajuster pour ne pas finir sur un weekend si non inclus
                if (!includeWeekends) {
                    const finalDayOfWeek = currentDate.getDay();
                    if (finalDayOfWeek === 0) { // Dimanche -> Lundi
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else if (finalDayOfWeek === 6) { // Samedi -> Lundi
                        currentDate.setDate(currentDate.getDate() + 2);
                    }
                }
                
                return currentDate.toISOString().split('T')[0];
            };

            const updateField = (field, value) => {
                setFormData(prev => {
                    const newData = { ...prev, [field]: value };
                    
                    // Auto-ajustement de la date de fin
                    if (field === 'dateDebut' && value && !prev.dateFin) {
                        // Si pas de date de fin, d√©finir par d√©faut √† la m√™me date
                        newData.dateFin = value;
                        // D√©finir les heures par d√©faut si pas d√©j√† d√©finies
                        if (!prev.heureDebut) newData.heureDebut = '08:00';
                        if (!prev.heureFin) newData.heureFin = '17:00';
                    }
                    
                    // Recalcul automatique bas√© sur la dur√©e
                    if ((field === 'dureePreviewHours' || field === 'typeHoraire' || field === 'includeWeekendsInDuration' || field === 'heureDebut' || field === 'heureFin') && 
                        newData.dateDebut && newData.dureePreviewHours) {
                        const calculatedEndDate = calculateEndDate(
                            newData.dateDebut,
                            newData.dureePreviewHours,
                            newData.typeHoraire,
                            newData.includeWeekendsInDuration,
                            newData.heureDebut || '08:00',
                            newData.heureFin || '17:00'
                        );
                        if (calculatedEndDate) {
                            newData.dateFin = calculatedEndDate;
                            // Pour 24h/24h, ajuster les heures
                            if (newData.typeHoraire === '24h') {
                                newData.heureDebut = '00:00';
                                newData.heureFin = '23:59';
                            }
                        }
                    }
                    
                    return newData;
                });
            };

            // Fonctions d'impression
            const printTodos = (type) => {
                const todos = type === 'etapes' ? formData.etapes : formData.preparation;
                const title = type === 'etapes' ? '√âtapes du projet' : 'Pr√©paration et mat√©riel';
                
                const printWindow = window.open('', '_blank');
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${title} - ${formData.nom || 'Nouveau projet'}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                            .header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; overflow: hidden; }
                            .header img { height: 60px; float: left; margin-right: 20px; }
                            .project-info { margin-bottom: 20px; background: #f5f5f5; padding: 15px; border-radius: 5px; }
                            .todo-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #eee; }
                            .checkbox { width: 15px; height: 15px; margin-right: 10px; }
                            .completed { text-decoration: line-through; color: #666; }
                            .status-badge { padding: 2px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; margin-right: 10px; }
                            .status-a_reserver { background: #fff3cd; color: #856404; }
                            .status-en_commande { background: #cce7ff; color: #0066cc; }
                            .status-fait { background: #d4edda; color: #155724; }
                            .print-date { text-align: right; font-size: 12px; color: #666; margin-top: 20px; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <img src="C-Secur360-logo.png.png" alt="C-Secur360" style="height: 60px; float: left; margin-right: 20px;">
                            <h1>${title}</h1>
                            <h2>${formData.nom || 'Nouveau projet'}</h2>
                        </div>
                        
                        <div class="project-info">
                            <strong>Projet #${formData.numeroJob}</strong><br>
                            ${formData.client ? `Client: ${formData.client}<br>` : ''}
                            ${formData.bureau ? `Bureau: ${formData.bureau}<br>` : ''}
                            ${formData.lieu ? `Lieu: ${formData.lieu}<br>` : ''}
                            ${formData.dateDebut ? `Date: ${formData.dateDebut}${formData.dateFin && formData.dateFin !== formData.dateDebut ? ` au ${formData.dateFin}` : ''}<br>` : ''}
                        </div>
                        
                        <div class="todos">
                            ${todos.length === 0 ? `<p><em>Aucun √©l√©ment dans ${title.toLowerCase()}</em></p>` : 
                                todos.map((item, index) => `
                                    <div class="todo-item">
                                        <input type="checkbox" class="checkbox" ${type === 'etapes' ? (item.completed ? 'checked' : '') : (item.statut === 'fait' ? 'checked' : '')} disabled>
                                        ${type === 'preparation' ? 
                                            `<span class="status-badge status-${item.statut}">
                                                ${item.statut === 'fait' ? '‚úì Fait' : item.statut === 'en_commande' ? 'En commande' : '√Ä r√©server'}
                                            </span>` : ''
                                        }
                                        <span class="${(type === 'etapes' && item.completed) || (type === 'preparation' && item.statut === 'fait') ? 'completed' : ''}">${item.text || '√âl√©ment vide'}</span>
                                    </div>
                                `).join('')
                            }
                        </div>
                        
                        <div class="print-date">
                            Imprim√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };

            const printFullEvent = () => {
                const printWindow = window.open('', '_blank');
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>√âv√©nement complet - ${formData.nom || 'Nouveau projet'}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; font-size: 12px; }
                            .header { border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; overflow: hidden; }
                            .header img { height: 60px; float: left; margin-right: 20px; }
                            .section { margin-bottom: 20px; page-break-inside: avoid; }
                            .section-title { font-weight: bold; font-size: 14px; margin-bottom: 10px; padding: 5px; background: #f0f0f0; }
                            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
                            .info-item { margin-bottom: 5px; }
                            .todo-item { display: flex; align-items: center; padding: 5px; border-bottom: 1px solid #eee; }
                            .checkbox { width: 12px; height: 12px; margin-right: 8px; }
                            .completed { text-decoration: line-through; color: #666; }
                            .status-badge { padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: bold; margin-right: 8px; }
                            .status-a_reserver { background: #fff3cd; color: #856404; }
                            .status-en_commande { background: #cce7ff; color: #0066cc; }
                            .status-fait { background: #d4edda; color: #155724; }
                            .resource-list { margin-left: 10px; }
                            .resource-item { padding: 2px 0; }
                            .print-date { text-align: right; font-size: 10px; color: #666; margin-top: 20px; }
                            @media print { body { margin: 0; } .section { page-break-inside: avoid; } }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <img src="C-Secur360-logo.png.png" alt="C-Secur360" style="height: 60px; float: left; margin-right: 20px;">
                            <h1>Fiche compl√®te du projet</h1>
                            <h2>${formData.nom || 'Nouveau projet'}</h2>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">üìù Informations g√©n√©rales</div>
                            <div class="info-grid">
                                <div>
                                    <div class="info-item"><strong>Num√©ro:</strong> ${formData.numeroJob}</div>
                                    <div class="info-item"><strong>Client:</strong> ${formData.client || 'Non sp√©cifi√©'}</div>
                                    <div class="info-item"><strong>Bureau:</strong> ${formData.bureau || 'Non sp√©cifi√©'}</div>
                                    <div class="info-item"><strong>Lieu:</strong> ${formData.lieu || 'Non sp√©cifi√©'}</div>
                                </div>
                                <div>
                                    <div class="info-item"><strong>Date d√©but:</strong> ${formData.dateDebut} ${formData.heureDebut}</div>
                                    <div class="info-item"><strong>Date fin:</strong> ${formData.dateFin} ${formData.heureFin}</div>
                                    <div class="info-item"><strong>Type d'horaire:</strong> ${formData.typeHoraire === '24h' ? '24h/24h' : formData.typeHoraire === 'nuit' ? 'Nuit' : 'Jour'}</div>
                                    <div class="info-item"><strong>Dur√©e pr√©vue:</strong> ${formData.dureePreviewHours ? formData.dureePreviewHours + 'h' : 'Non sp√©cifi√©e'}</div>
                                </div>
                            </div>
                        </div>

                        ${(formData.etapes && formData.etapes.length > 0) ? `
                            <div class="section">
                                <div class="section-title">üìã √âtapes du projet</div>
                                ${(formData.etapes || []).map((etape, index) => `
                                    <div class="todo-item">
                                        <input type="checkbox" class="checkbox" ${etape.completed ? 'checked' : ''} disabled>
                                        <span class="${etape.completed ? 'completed' : ''}">${etape.text || '√âtape vide'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        ${(formData.preparation && formData.preparation.length > 0) ? `
                            <div class="section">
                                <div class="section-title">üõ†Ô∏è Pr√©paration et mat√©riel</div>
                                ${(formData.preparation || []).map((item, index) => `
                                    <div class="todo-item">
                                        <input type="checkbox" class="checkbox" ${item.statut === 'fait' ? 'checked' : ''} disabled>
                                        <span class="status-badge status-${item.statut}">
                                            ${item.statut === 'fait' ? '‚úì Fait' : item.statut === 'en_commande' ? 'En commande' : '√Ä r√©server'}
                                        </span>
                                        <span class="${item.statut === 'fait' ? 'completed' : ''}">${item.text || '√âl√©ment vide'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        ${(formData.personnel && formData.personnel.length > 0) ? `
                            <div class="section">
                                <div class="section-title">üë• Personnel assign√©</div>
                                <div class="resource-list">
                                    ${(formData.personnel || []).map(id => {
                                        const person = personnel.find(p => p.id === id);
                                        return person ? `<div class="resource-item">‚Ä¢ ${person.nom} (${person.poste})</div>` : '';
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${(formData.equipements && formData.equipements.length > 0) ? `
                            <div class="section">
                                <div class="section-title">üîß √âquipements</div>
                                <div class="resource-list">
                                    ${(formData.equipements || []).map(id => {
                                        const equip = equipements.find(e => e.id === id);
                                        return equip ? `<div class="resource-item">‚Ä¢ ${equip.nom} (${equip.type})</div>` : '';
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${formData.sousTraitants.length > 0 ? `
                            <div class="section">
                                <div class="section-title">üè¢ Sous-traitants</div>
                                <div class="resource-list">
                                    ${formData.sousTraitants.map(id => {
                                        const st = sousTraitants.find(s => s.id === id);
                                        return st ? `<div class="resource-item">‚Ä¢ ${st.nom}</div>` : '';
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div class="print-date">
                            Document g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };

            const printGantt = () => {
                const printWindow = window.open('', '_blank');
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Diagramme de Gantt - ${formData.nom || 'Nouveau projet'}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; font-size: 12px; }
                            .header { border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; display: flex; align-items: center; }
                            .project-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 5px; }
                            .gantt-container { overflow-x: auto; }
                            .gantt-table { width: 100%; border-collapse: collapse; font-size: 10px; }
                            .gantt-table th, .gantt-table td { border: 1px solid #ddd; padding: 4px; text-align: left; }
                            .gantt-table th { background: #f1f3f4; font-weight: bold; }
                            .task-row { background: white; }
                            .task-row.completed { background: #e8f5e8; }
                            .gantt-bar { height: 20px; background: linear-gradient(135deg, #4285f4, #1a73e8); border-radius: 3px; position: relative; margin: 2px 0; }
                            .gantt-bar.completed { background: linear-gradient(135deg, #34a853, #137333); }
                            .assignment-list { font-size: 9px; color: #666; margin-top: 2px; }
                            .print-date { text-align: right; font-size: 10px; color: #666; margin-top: 20px; }
                            @media print { 
                                body { margin: 0; } 
                                .gantt-container { overflow: visible; }
                                .gantt-table { font-size: 8px; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <img src="C-Secur360-logo.png.png" alt="C-Secur360" style="height: 60px; margin-right: 20px;">
                            <div>
                                <h1>üìä Diagramme de Gantt</h1>
                                <h2>${formData.nom || 'Nouveau projet'}</h2>
                            </div>
                        </div>
                        
                        <div class="project-info">
                            <div>
                                <div><strong>Num√©ro:</strong> ${formData.numeroJob}</div>
                                <div><strong>Client:</strong> ${formData.client || 'Non sp√©cifi√©'}</div>
                                <div><strong>Bureau:</strong> ${formData.bureau || 'Non sp√©cifi√©'}</div>
                                <div><strong>Mode:</strong> ${ganttData.mode === 'global' ? 'Assignation globale' : 'Assignation individuelle'}</div>
                            </div>
                            <div>
                                <div><strong>Date d√©but:</strong> ${formData.dateDebut} ${formData.heureDebut}</div>
                                <div><strong>Date fin:</strong> ${formData.dateFin} ${formData.heureFin}</div>
                                <div><strong>Dur√©e totale:</strong> ${formData.dureePreviewHours}h</div>
                                <div><strong>Type d'horaire:</strong> ${formData.typeHoraire === '24h' ? '24h/24h' : formData.typeHoraire === 'nuit' ? 'Nuit' : 'Jour'}</div>
                            </div>
                        </div>

                        <div class="gantt-container">
                            <table class="gantt-table">
                                <thead>
                                    <tr>
                                        <th style="width: 200px;">T√¢che</th>
                                        <th style="width: 120px;">Date d√©but</th>
                                        <th style="width: 120px;">Date fin</th>
                                        <th style="width: 80px;">Dur√©e</th>
                                        <th>Ressources assign√©es</th>
                                        <th style="width: 300px;">Timeline</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${ganttData.tasks.map((task, index) => {
                                        const taskAssignments = ganttData.assignments.filter(a => a.taskId === task.id);
                                        const startDate = new Date(task.startDate);
                                        const endDate = new Date(task.endDate);
                                        
                                        return `
                                            <tr class="task-row ${task.completed ? 'completed' : ''}">
                                                <td><strong>${task.name}</strong></td>
                                                <td>${startDate.toLocaleDateString('fr-FR')} ${startDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</td>
                                                <td>${endDate.toLocaleDateString('fr-FR')} ${endDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</td>
                                                <td>${task.duration.toFixed(1)}h</td>
                                                <td>
                                                    ${taskAssignments.map(assignment => 
                                                        `<div class="assignment-list">${assignment.resourceType === 'personnel' ? 'üë§' : 'üîß'} ${assignment.resourceName}</div>`
                                                    ).join('')}
                                                </td>
                                                <td>
                                                    <div class="gantt-bar ${task.completed ? 'completed' : ''}" style="width: 90%; position: relative;">
                                                        <span style="position: absolute; left: 5px; top: 2px; color: white; font-size: 8px; font-weight: bold;">${task.name}</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="print-date">
                            Gantt g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };

            const getPriorityColor = (priorite) => {
                switch (priorite) {
                    case 'urgent': return 'border-red-500 bg-red-50';
                    case 'haute': return 'border-orange-500 bg-orange-50';
                    case 'normale': return 'border-blue-500 bg-blue-50';
                    case 'faible': return 'border-gray-500 bg-gray-50';
                    default: return 'border-blue-500 bg-blue-50';
                }
            };

            if (!isOpen) return null;

            return React.createElement(Modal, {
                isOpen,
                onClose,
                title: job ? 'Modifier l\'√©v√©nement' : 'Nouveau √©v√©nement',
                size: 'xl'
            },
                // Navigation des onglets
                React.createElement('div', { className: "border-b" },
                    React.createElement('nav', { className: "flex px-6" },
                        React.createElement('button', {
                            onClick: () => {
                                setActiveTab('gantt');
                                updateGanttData();
                            },
                            className: `py-2 px-1 border-b-2 font-medium text-sm ${
                                activeTab === 'gantt' 
                                    ? 'border-blue-500 text-blue-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`,
                            disabled: !formData.etapes.length || !formData.dureePreviewHours,
                            title: !formData.etapes.length || !formData.dureePreviewHours ? 'Ajoutez des √©tapes et une dur√©e pour voir le Gantt' : ''
                        },
                            React.createElement('span', null, "üìä"),
                            " Gantt",
                            ganttData.tasks.length > 0 && React.createElement('span', { className: "ml-1 bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs" }, ganttData.tasks.length)
                        ),
                        React.createElement('button', {
                            onClick: () => setActiveTab('form'),
                            className: `py-2 px-1 border-b-2 font-medium text-sm ${
                                activeTab === 'form' 
                                    ? 'border-blue-500 text-blue-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            }`
                        },
                            React.createElement('span', null, "üìù"),
                            " Formulaire"
                        )
                    )
                ),
                // Contenu des onglets
                activeTab === 'form' ? React.createElement('form', { onSubmit: handleSubmit, className: "p-6 space-y-6" },
                    // Mode de modification pour les jobs existants
                    job && React.createElement('div', { className: "bg-yellow-50 border border-yellow-200 rounded-lg p-4" },
                        React.createElement('h4', { className: "font-semibold text-yellow-800 mb-2" }, "Mode de modification :"),
                        React.createElement('div', { className: "flex gap-4" },
                            React.createElement('label', { className: "flex items-center gap-2" },
                                React.createElement('input', {
                                    type: "radio",
                                    name: "modificationMode",
                                    value: "groupe",
                                    checked: modificationMode === 'groupe',
                                    onChange: (e) => setModificationMode(e.target.value)
                                }),
                                React.createElement('span', { className: "text-sm" }, "Modifier pour tout le groupe assign√©")
                            ),
                            React.createElement('label', { className: "flex items-center gap-2" },
                                React.createElement('input', {
                                    type: "radio",
                                    name: "modificationMode",
                                    value: "individuel",
                                    checked: modificationMode === 'individuel',
                                    onChange: (e) => setModificationMode(e.target.value)
                                }),
                                React.createElement('span', { className: "text-sm" }, "Cr√©er une version individuelle")
                            )
                        ),
                        
                        // S√©lection de la ressource √† modifier (mode individuel)
                        modificationMode === 'individuel' && job && React.createElement('div', { className: "mt-4 p-3 bg-blue-50 rounded-lg" },
                            React.createElement('h5', { className: "font-medium text-blue-800 mb-2" }, "Cr√©er planning personnalis√© pour :"),
                            
                            // S√©lection du type de ressource
                            React.createElement('div', { className: "flex gap-4 mb-3" },
                                React.createElement('label', { className: "flex items-center gap-2" },
                                    React.createElement('input', {
                                        type: "radio",
                                        name: "typeRessourceIndividuelle",
                                        value: "personnel",
                                        checked: typeRessourceIndividuelle === 'personnel',
                                        onChange: (e) => {
                                            setTypeRessourceIndividuelle(e.target.value);
                                            setRessourceIndividuelle(null);
                                        }
                                    }),
                                    React.createElement('span', { className: "text-sm" }, "Personnel")
                                ),
                                React.createElement('label', { className: "flex items-center gap-2" },
                                    React.createElement('input', {
                                        type: "radio",
                                        name: "typeRessourceIndividuelle",
                                        value: "equipement",
                                        checked: typeRessourceIndividuelle === 'equipement',
                                        onChange: (e) => {
                                            setTypeRessourceIndividuelle(e.target.value);
                                            setRessourceIndividuelle(null);
                                        }
                                    }),
                                    React.createElement('span', { className: "text-sm" }, "√âquipement")
                                )
                            ),
                            
                            // S√©lection de la ressource sp√©cifique
                            React.createElement('select', {
                                value: ressourceIndividuelle || '',
                                onChange: (e) => setRessourceIndividuelle(e.target.value || null),
                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                            },
                                React.createElement('option', { value: "" }, 
                                    typeRessourceIndividuelle === 'personnel' ? "S√©lectionner un travailleur" : "S√©lectionner un √©quipement"
                                ),
                                ...(typeRessourceIndividuelle === 'personnel' 
                                    ? personnel.filter(p => job.personnel?.includes(p.id)).map(p =>
                                        React.createElement('option', { key: p.id, value: p.id }, p.nom)
                                    )
                                    : equipements.filter(e => job.equipements?.includes(e.id)).map(e =>
                                        React.createElement('option', { key: e.id, value: e.id }, e.nom)
                                    )
                                )
                            ),
                            
                            // Champs de modification pour la ressource s√©lectionn√©e
                            ressourceIndividuelle && React.createElement('div', { className: "mt-3 p-3 bg-white rounded border" },
                                React.createElement('h6', { className: "font-medium mb-2" }, 
                                    `Planning pour ${
                                        typeRessourceIndividuelle === 'personnel' 
                                            ? personnel.find(p => p.id === ressourceIndividuelle)?.nom
                                            : equipements.find(e => e.id === ressourceIndividuelle)?.nom
                                    }`
                                ),
                                React.createElement('div', { className: "grid grid-cols-2 gap-3" },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-medium mb-1" }, "Date d√©but personnalis√©e"),
                                        React.createElement('input', {
                                            type: "date",
                                            value: modificationsIndividuelles[ressourceIndividuelle]?.dateDebut || formData.dateDebut,
                                            onChange: (e) => setModificationsIndividuelles(prev => ({
                                                ...prev,
                                                [ressourceIndividuelle]: {
                                                    ...prev[ressourceIndividuelle],
                                                    dateDebut: e.target.value
                                                }
                                            })),
                                            className: "w-full p-1 text-xs border rounded focus:ring-1 focus:ring-blue-500"
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-medium mb-1" }, "Date fin personnalis√©e"),
                                        React.createElement('input', {
                                            type: "date",
                                            value: modificationsIndividuelles[ressourceIndividuelle]?.dateFin || formData.dateFin,
                                            onChange: (e) => setModificationsIndividuelles(prev => ({
                                                ...prev,
                                                [ressourceIndividuelle]: {
                                                    ...prev[ressourceIndividuelle],
                                                    dateFin: e.target.value
                                                }
                                            })),
                                            className: "w-full p-1 text-xs border rounded focus:ring-1 focus:ring-blue-500"
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-medium mb-1" }, "Heure d√©but"),
                                        React.createElement('input', {
                                            type: "time",
                                            value: modificationsIndividuelles[ressourceIndividuelle]?.heureDebut || formData.heureDebut,
                                            onChange: (e) => setModificationsIndividuelles(prev => ({
                                                ...prev,
                                                [ressourceIndividuelle]: {
                                                    ...prev[ressourceIndividuelle],
                                                    heureDebut: e.target.value
                                                }
                                            })),
                                            className: "w-full p-1 text-xs border rounded focus:ring-1 focus:ring-blue-500"
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-medium mb-1" }, "Heure fin"),
                                        React.createElement('input', {
                                            type: "time",
                                            value: modificationsIndividuelles[ressourceIndividuelle]?.heureFin || formData.heureFin,
                                            onChange: (e) => setModificationsIndividuelles(prev => ({
                                                ...prev,
                                                [ressourceIndividuelle]: {
                                                    ...prev[ressourceIndividuelle],
                                                    heureFin: e.target.value
                                                }
                                            })),
                                            className: "w-full p-1 text-xs border rounded focus:ring-1 focus:ring-blue-500"
                                        })
                                    )
                                ),
                                // Bouton pour supprimer le planning personnalis√©
                                job?.planningsIndividuels?.[ressourceIndividuelle] && 
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => {
                                        setModificationsIndividuelles(prev => {
                                            const newModifs = { ...prev };
                                            delete newModifs[ressourceIndividuelle];
                                            return newModifs;
                                        });
                                        // Marquer pour suppression lors de la sauvegarde
                                        setModificationsIndividuelles(prev => ({
                                            ...prev,
                                            [ressourceIndividuelle]: null
                                        }));
                                    },
                                    className: "mt-2 px-3 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200"
                                }, "Supprimer planning personnalis√©")
                            )
                        )
                    ),

                    // Informations de base
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('h3', { className: "text-lg font-semibold border-b pb-2" }, "Informations de base"),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Num√©ro de Job *"),
                                React.createElement('input', {
                                    type: "text",
                                    value: formData.numeroJob,
                                    onChange: (e) => updateField('numeroJob', e.target.value),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                })
                            ),

                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Client"),
                                    React.createElement('input', {
                                        type: "text",
                                        value: formData.client,
                                        onChange: (e) => updateField('client', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Bureau responsable *"),
                                    React.createElement('select', {
                                        value: formData.bureau,
                                        onChange: (e) => updateField('bureau', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                        required: true
                                    },
                                        React.createElement('option', { value: "" }, "S√©lectionner un bureau"),
                                        ...getBureauOptions().slice(1).map(bureau => 
                                            React.createElement('option', { key: bureau.value, value: bureau.value }, bureau.label)
                                        )
                                    )
                                )
                            ),

                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Nom du Job *"),
                                React.createElement('input', {
                                    type: "text",
                                    value: formData.nom,
                                    onChange: (e) => updateField('nom', e.target.value),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                    required: true
                                })
                            ),

                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Lieu"),
                                React.createElement('input', {
                                    type: "text",
                                    value: formData.lieu,
                                    onChange: (e) => updateField('lieu', e.target.value),
                                    className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                })
                            ),

                            // Section √âtapes du projet (remplace Description)
                            React.createElement('div', { 
                                className: `p-4 bg-blue-50 rounded-lg border border-blue-200 transition-all duration-300 ${
                                    expandedSections.etapes ? 'fixed inset-4 z-50 bg-white shadow-2xl' : ''
                                }`,
                                onDoubleClick: () => {
                                    setExpandedSections(prev => ({
                                        ...prev,
                                        etapes: !prev.etapes
                                    }));
                                }
                            },
                                React.createElement('h4', { className: `font-medium text-blue-800 flex items-center gap-2 mb-3 ${expandedSections.etapes ? 'text-lg' : ''}` },
                                    React.createElement('span', null, "üìã"),
                                    "Description / √âtapes du projet",
                                    React.createElement('button', {
                                        onClick: (e) => {
                                            e.stopPropagation();
                                            printTodos('etapes');
                                        },
                                        className: "ml-auto text-blue-600 hover:text-blue-800 p-1 rounded bg-blue-100 hover:bg-blue-200 text-sm",
                                        title: "Imprimer les √©tapes"
                                    }, "üñ®Ô∏è"),
                                    expandedSections.etapes && React.createElement('button', {
                                        onClick: (e) => {
                                            e.stopPropagation();
                                            setExpandedSections(prev => ({
                                                ...prev,
                                                etapes: false
                                            }));
                                        },
                                        className: "ml-2 text-gray-500 hover:text-gray-700 text-2xl"
                                    }, "√ó"),
                                    !expandedSections.etapes && React.createElement('span', { className: "ml-2 text-xs text-blue-400" }, "Double-clic pour agrandir")
                                ),
                                
                                // MODE DE PLANIFICATION INTUITIF (Option 1)
                                React.createElement('div', { className: 'mb-4 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200' },
                                    React.createElement('div', { className: 'text-sm font-medium text-gray-700 mb-2 flex items-center gap-2' },
                                        React.createElement('span', null, 'üéØ Mode de planification'),
                                        React.createElement('span', { className: 'text-xs text-gray-500' }, '(Comment organiser vos √©tapes ?)')
                                    ),
                                    React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                        // Mode S√©quentiel
                                        React.createElement('label', { 
                                            className: `flex flex-col items-center p-3 rounded-lg border-2 cursor-pointer transition-all ${
                                                (formData.planningMode || 'sequential') === 'sequential' 
                                                    ? 'border-blue-500 bg-blue-100 text-blue-800' 
                                                    : 'border-gray-200 bg-white hover:bg-gray-50'
                                            }`
                                        },
                                            React.createElement('input', {
                                                type: 'radio',
                                                name: 'planningMode',
                                                value: 'sequential',
                                                checked: (formData.planningMode || 'sequential') === 'sequential',
                                                onChange: (e) => {
                                                    updateField('planningMode', e.target.value);
                                                    // Appliquer automatiquement les d√©pendances s√©quentielles
                                                    if (e.target.checked) {
                                                        const newEtapes = formData.etapes.map((etape, index) => ({
                                                            ...etape,
                                                            dependencies: index === 0 ? [] : [index - 1],
                                                            dependencyType: 'FS',
                                                            isParallel: false
                                                        }));
                                                        updateField('etapes', newEtapes);
                                                    }
                                                },
                                                className: 'sr-only'
                                            }),
                                            React.createElement('div', { className: 'text-2xl mb-1' }, 'üîÑ'),
                                            React.createElement('div', { className: 'text-xs font-medium' }, 'S√©quentiel'),
                                            React.createElement('div', { className: 'text-xs text-gray-500 text-center mt-1' }, '1 ‚Üí 2 ‚Üí 3 ‚Üí 4'),
                                            React.createElement('div', { className: 'text-xs text-gray-400 text-center mt-1' }, 'Chaque √©tape apr√®s la pr√©c√©dente')
                                        ),
                                        
                                        // Mode Parall√®le
                                        React.createElement('label', { 
                                            className: `flex flex-col items-center p-3 rounded-lg border-2 cursor-pointer transition-all ${
                                                formData.planningMode === 'parallel' 
                                                    ? 'border-green-500 bg-green-100 text-green-800' 
                                                    : 'border-gray-200 bg-white hover:bg-gray-50'
                                            }`
                                        },
                                            React.createElement('input', {
                                                type: 'radio',
                                                name: 'planningMode',
                                                value: 'parallel',
                                                checked: formData.planningMode === 'parallel',
                                                onChange: (e) => {
                                                    updateField('planningMode', e.target.value);
                                                    // Appliquer automatiquement le parall√©lisme
                                                    if (e.target.checked) {
                                                        const newEtapes = formData.etapes.map(etape => ({
                                                            ...etape,
                                                            dependencies: [],
                                                            isParallel: true
                                                        }));
                                                        updateField('etapes', newEtapes);
                                                    }
                                                },
                                                className: 'sr-only'
                                            }),
                                            React.createElement('div', { className: 'text-2xl mb-1' }, '‚ö°'),
                                            React.createElement('div', { className: 'text-xs font-medium' }, 'Parall√®le'),
                                            React.createElement('div', { className: 'text-xs text-gray-500 text-center mt-1' }, '1,2,3,4 ensemble'),
                                            React.createElement('div', { className: 'text-xs text-gray-400 text-center mt-1' }, 'Toutes en m√™me temps')
                                        ),
                                        
                                        // Mode Mixte
                                        React.createElement('label', { 
                                            className: `flex flex-col items-center p-3 rounded-lg border-2 cursor-pointer transition-all ${
                                                formData.planningMode === 'custom' 
                                                    ? 'border-purple-500 bg-purple-100 text-purple-800' 
                                                    : 'border-gray-200 bg-white hover:bg-gray-50'
                                            }`
                                        },
                                            React.createElement('input', {
                                                type: 'radio',
                                                name: 'planningMode',
                                                value: 'custom',
                                                checked: formData.planningMode === 'custom',
                                                onChange: (e) => {
                                                    updateField('planningMode', e.target.value);
                                                    // En mode custom, garder les d√©pendances actuelles
                                                },
                                                className: 'sr-only'
                                            }),
                                            React.createElement('div', { className: 'text-2xl mb-1' }, 'üéõÔ∏è'),
                                            React.createElement('div', { className: 'text-xs font-medium' }, 'Mixte'),
                                            React.createElement('div', { className: 'text-xs text-gray-500 text-center mt-1' }, 'Personnalis√©'),
                                            React.createElement('div', { className: 'text-xs text-gray-400 text-center mt-1' }, 'Contr√¥le avanc√©')
                                        )
                                    ),
                                    
                                    // Exemple visuel du mode s√©lectionn√©
                                    (formData.planningMode || 'sequential') !== 'custom' && React.createElement('div', { className: 'mt-3 p-2 bg-white rounded border' },
                                        React.createElement('div', { className: 'text-xs font-medium text-gray-600 mb-1' }, 'Aper√ßu:'),
                                        React.createElement('div', { className: 'flex items-center justify-center gap-2 text-sm' },
                                            (formData.planningMode || 'sequential') === 'sequential' ? 
                                                [1,2,3,4,5].map((num, i) => 
                                                    React.createElement('span', { key: num, className: 'flex items-center' },
                                                        React.createElement('span', { className: 'w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs' }, num),
                                                        i < 4 && React.createElement('span', { className: 'mx-1 text-gray-400' }, '‚Üí')
                                                    )
                                                ) :
                                                React.createElement('div', { className: 'flex flex-col items-center' },
                                                    React.createElement('div', { className: 'flex items-center gap-1' },
                                                        [1,2,3,4,5].map(num => 
                                                            React.createElement('span', { 
                                                                key: num, 
                                                                className: 'w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-xs' 
                                                            }, num)
                                                        )
                                                    ),
                                                    React.createElement('div', { className: 'text-xs text-green-600 mt-1' }, '‚Üë Toutes d√©marrent ensemble')
                                                )
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { 
                                    className: `space-y-2 mb-3 ${
                                        expandedSections.etapes 
                                            ? 'overflow-y-auto max-h-[70vh]' 
                                            : 'max-h-40 overflow-y-auto'
                                    }`,
                                    style: expandedSections.etapes ? { maxHeight: 'calc(100vh - 200px)' } : {}
                                },
                                    formData.etapes.map((etape, index) => 
                                        React.createElement('div', { 
                                            key: `etape-${etape.id || index}`,
                                            className: `group flex items-center gap-2 p-2 bg-white rounded border hover:shadow-md transition-all ${
                                                expandedSections.etapes ? 'p-3 mb-2' : 'mb-1'
                                            }`,
                                            draggable: true,
                                            onDragStart: (e) => {
                                                e.dataTransfer.setData('text/plain', JSON.stringify({
                                                    type: 'etape-reorder',
                                                    fromIndex: index,
                                                    etapeData: etape
                                                }));
                                                e.currentTarget.style.opacity = '0.5';
                                            },
                                            onDragEnd: (e) => {
                                                e.currentTarget.style.opacity = '1';
                                            },
                                            onDragOver: (e) => {
                                                e.preventDefault();
                                                e.currentTarget.style.borderColor = '#3b82f6';
                                                e.currentTarget.style.borderWidth = '2px';
                                            },
                                            onDragLeave: (e) => {
                                                e.currentTarget.style.borderColor = '';
                                                e.currentTarget.style.borderWidth = '1px';
                                            },
                                            onDrop: (e) => {
                                                e.preventDefault();
                                                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                                                if (data.type === 'etape-reorder') {
                                                    const newEtapes = [...formData.etapes];
                                                    const draggedEtape = newEtapes.splice(data.fromIndex, 1)[0];
                                                    newEtapes.splice(index, 0, draggedEtape);
                                                    
                                                    // Renumeroter automatiquement
                                                    const renumberedEtapes = newEtapes.map((etape, i) => ({
                                                        ...etape,
                                                        number: i + 1,
                                                        id: etape.id || `etape-${Date.now()}-${i}`
                                                    }));
                                                    
                                                    updateField('etapes', renumberedEtapes);
                                                }
                                                e.currentTarget.style.borderColor = '';
                                                e.currentTarget.style.borderWidth = '1px';
                                            }
                                        },
                                            
                                            // NUMERO AUTOMATIQUE + INDICATEUR MODE + POIGNEE DRAG
                                            React.createElement('div', { className: 'flex items-center gap-2' },
                                                React.createElement('div', {
                                                    className: `w-6 h-6 text-white rounded-full flex items-center justify-center text-xs font-bold cursor-grab active:cursor-grabbing ${
                                                        (formData.planningMode || 'sequential') === 'sequential' ? 'bg-blue-500' :
                                                        formData.planningMode === 'parallel' ? 'bg-green-500' :
                                                        'bg-purple-500'
                                                    }`,
                                                    title: `√âtape #${index + 1} - ${
                                                        (formData.planningMode || 'sequential') === 'sequential' ? 'Mode S√©quentiel' :
                                                        formData.planningMode === 'parallel' ? 'Mode Parall√®le' :
                                                        'Mode Mixte'
                                                    } - Glisser pour r√©organiser`
                                                }, (index + 1).toString()),
                                                React.createElement('div', {
                                                    className: 'flex flex-col gap-0.5 text-gray-400 opacity-0 group-hover:opacity-100 cursor-grab',
                                                    title: 'Poign√©e de glissement'
                                                },
                                                    React.createElement('div', { className: 'w-1 h-0.5 bg-current' }),
                                                    React.createElement('div', { className: 'w-1 h-0.5 bg-current' }),
                                                    React.createElement('div', { className: 'w-1 h-0.5 bg-current' })
                                                )
                                            ),
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: etape.completed,
                                                onChange: (e) => {
                                                    const newEtapes = [...formData.etapes];
                                                    newEtapes[index].completed = e.target.checked;
                                                    updateField('etapes', newEtapes);
                                                },
                                                className: "rounded focus:ring-blue-500"
                                            }),
                                            React.createElement('input', {
                                                type: "text",
                                                value: etape.text || '',
                                                onChange: (e) => {
                                                    const newEtapes = [...formData.etapes];
                                                    newEtapes[index].text = e.target.value;
                                                    updateField('etapes', newEtapes);
                                                },
                                                className: `flex-1 p-1 border rounded focus:ring-2 focus:ring-blue-500 ${etape.completed ? 'line-through text-gray-500' : ''}`,
                                                placeholder: "Description de l'√©tape..."
                                            }),
                                            
                                            // Dur√©e de l'√©tape (V6.2)
                                            React.createElement('input', {
                                                type: "number",
                                                value: etape.duration === '' ? '' : (etape.duration || 0.25),
                                                onChange: (e) => {
                                                    const newEtapes = [...formData.etapes];
                                                    let inputValue = e.target.value;
                                                    
                                                    // Permettre la saisie vide temporairement
                                                    if (inputValue === '') {
                                                        newEtapes[index].duration = '';
                                                        updateField('etapes', newEtapes);
                                                        return;
                                                    }
                                                    
                                                    // Convertir la valeur
                                                    let numValue = parseFloat(inputValue);
                                                    
                                                    // Si pas un nombre valide, garder la valeur pr√©c√©dente
                                                    if (isNaN(numValue)) {
                                                        return;
                                                    }
                                                    
                                                    // Appliquer le minimum de 0.25
                                                    if (numValue < 0.25) {
                                                        numValue = 0.25;
                                                    }
                                                    
                                                    newEtapes[index].duration = numValue;
                                                    updateField('etapes', newEtapes);
                                                },
                                                onBlur: (e) => {
                                                    // Au blur, s'assurer qu'il y a une valeur valide
                                                    const newEtapes = [...formData.etapes];
                                                    if (!newEtapes[index].duration || newEtapes[index].duration === '') {
                                                        newEtapes[index].duration = 0.25;
                                                        updateField('etapes', newEtapes);
                                                    }
                                                },
                                                className: "w-20 p-1 border rounded text-center focus:ring-2 focus:ring-blue-500",
                                                placeholder: "1",
                                                min: "0.25",
                                                step: "0.25",
                                                title: "Saisissez directement (ex: 15) puis ajustez avec +/- si besoin"
                                            }),
                                            React.createElement('div', { className: "flex flex-col items-center" },
                                                React.createElement('span', { className: "text-gray-500 text-xs" }, "h"),
                                                etape.duration && etape.duration >= 1 && React.createElement('span', { 
                                                    className: "text-xs text-blue-600 mt-0.5",
                                                    title: `${etape.duration}h = ${Math.floor(etape.duration)}h${((etape.duration % 1) * 60) > 0 ? ` ${((etape.duration % 1) * 60)}min` : ''}`
                                                }, 
                                                    etape.duration % 1 === 0 ? `${etape.duration}h` : 
                                                    `${Math.floor(etape.duration)}h${Math.round((etape.duration % 1) * 60)}min`
                                                )
                                            ),
                                            
                                            // Priorit√© de l'√©tape (V6.2)
                                            React.createElement('select', {
                                                value: etape.priority || 'normal',
                                                onChange: (e) => {
                                                    const newEtapes = [...formData.etapes];
                                                    newEtapes[index].priority = e.target.value;
                                                    updateField('etapes', newEtapes);
                                                },
                                                className: "p-1 border rounded focus:ring-2 focus:ring-red-500 text-xs",
                                                title: "Priorit√© de l'√©tape"
                                            },
                                                React.createElement('option', { value: 'low' }, "üü¢ Basse"),
                                                React.createElement('option', { value: 'normal' }, "üü° Normale"),
                                                React.createElement('option', { value: 'high' }, "üü† Haute"),
                                                React.createElement('option', { value: 'critical' }, "üî¥ Critique")
                                            ),
                                            
                                            // INDICATEUR SIMPLE DES DEPENDANCES SELON LE MODE
                                            formData.planningMode !== 'custom' && React.createElement('div', { 
                                                className: `text-xs px-2 py-1 rounded ${
                                                    (formData.planningMode || 'sequential') === 'sequential' ? 'bg-blue-50 text-blue-700 border border-blue-200' :
                                                    'bg-green-50 text-green-700 border border-green-200'
                                                }`
                                            },
                                                (formData.planningMode || 'sequential') === 'sequential' ? 
                                                    (index === 0 ? 'üöÄ Premi√®re √©tape' : `‚û°Ô∏è Apr√®s √©tape ${index}`) :
                                                    '‚ö° D√©marre avec toutes les autres'
                                            ),
                                            
                                            // V6.5 ULTRA: Contr√¥les de d√©pendance MS Project+ (Visible uniquement en mode Mixte)
                                            formData.planningMode === 'custom' && React.createElement('div', { className: "flex flex-col gap-1 border-l-2 border-purple-300 pl-2" },
                                                React.createElement('div', { className: "text-xs text-purple-600 font-medium mb-1" }, "üéõÔ∏è Mode Mixte - Contr√¥les avanc√©s"),
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('span', { 
                                                        className: "text-xs font-medium text-blue-700",
                                                        title: "Gestion des d√©pendances entre √©tapes"
                                                    }, "üîó D√©pendances"),
                                                    React.createElement('select', {
                                                        value: etape.dependencyType || 'FS',
                                                        onChange: (e) => {
                                                            const newEtapes = [...formData.etapes];
                                                            newEtapes[index].dependencyType = e.target.value;
                                                            updateField('etapes', newEtapes);
                                                        },
                                                        className: "text-xs border rounded px-1 py-0.5 focus:ring-1 focus:ring-blue-500",
                                                        title: "Type de d√©pendance"
                                                    },
                                                        React.createElement('option', { value: 'FS', title: 'Finish-to-Start: La t√¢che pr√©d√©cesseur doit finir avant que cette t√¢che commence' }, "FS (Fin‚ÜíD√©but)"),
                                                        React.createElement('option', { value: 'SS', title: 'Start-to-Start: Cette t√¢che ne peut commencer avant que le pr√©d√©cesseur commence' }, "SS (D√©but‚ÜíD√©but)"),
                                                        React.createElement('option', { value: 'FF', title: 'Finish-to-Finish: Cette t√¢che ne peut finir avant que le pr√©d√©cesseur finisse' }, "FF (Fin‚ÜíFin)"),
                                                        React.createElement('option', { value: 'SF', title: 'Start-to-Finish: Cette t√¢che ne peut finir avant que le pr√©d√©cesseur commence' }, "SF (D√©but‚ÜíFin)")
                                                    )
                                                ),
                                                
                                                // S√©lection des pr√©d√©cesseurs
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('label', { className: "text-xs text-gray-600" }, "Apr√®s √©tape(s):"),
                                                    React.createElement('select', {
                                                        multiple: true,
                                                        value: etape.dependencies || [],
                                                        onChange: (e) => {
                                                            const selectedOptions = Array.from(e.target.selectedOptions).map(option => parseInt(option.value));
                                                            const newEtapes = [...formData.etapes];
                                                            newEtapes[index].dependencies = selectedOptions;
                                                            updateField('etapes', newEtapes);
                                                        },
                                                        className: "text-xs border rounded px-1 py-0.5 focus:ring-1 focus:ring-blue-500 max-w-[120px]",
                                                        size: 2
                                                    },
                                                        React.createElement('option', { value: '', disabled: true }, "Aucune"),
                                                        ...formData.etapes.map((e, i) => 
                                                            i !== index && e.text.trim() ? 
                                                                React.createElement('option', { 
                                                                    key: i, 
                                                                    value: i,
                                                                    title: e.text 
                                                                }, `${i + 1}. ${e.text.substring(0, 20)}${e.text.length > 20 ? '...' : ''}`)
                                                                : null
                                                        ).filter(Boolean)
                                                    )
                                                ),
                                                
                                                // Lead/Lag time
                                                (etape.dependencies && etape.dependencies.length > 0) &&
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('label', { className: "text-xs text-gray-600" }, "D√©calage:"),
                                                    React.createElement('input', {
                                                        type: "number",
                                                        value: etape.leadLag || 0,
                                                        onChange: (e) => {
                                                            const newEtapes = [...formData.etapes];
                                                            newEtapes[index].leadLag = parseFloat(e.target.value) || 0;
                                                            updateField('etapes', newEtapes);
                                                        },
                                                        className: "w-16 text-xs border rounded px-1 py-0.5 focus:ring-1 focus:ring-blue-500",
                                                        step: "0.25",
                                                        title: "D√©calage en heures (n√©gatif = avance, positif = retard)"
                                                    }),
                                                    React.createElement('span', { className: "text-xs text-gray-500" }, "h")
                                                )
                                            ),
                                            
                                            // Parall√©lisme (V6.2) - Maintenant compl√©mentaire aux d√©pendances
                                            React.createElement('label', { 
                                                className: "flex items-center gap-1 text-xs text-orange-600",
                                                title: "Mode legacy - Utilisez plut√¥t les d√©pendances pour un contr√¥le pr√©cis"
                                            },
                                                React.createElement('input', {
                                                    type: "checkbox",
                                                    checked: etape.isParallel || false,
                                                    onChange: (e) => {
                                                        const newEtapes = [...formData.etapes];
                                                        newEtapes[index].isParallel = e.target.checked;
                                                        updateField('etapes', newEtapes);
                                                    },
                                                    className: "rounded focus:ring-orange-500"
                                                }),
                                                "‚ö° Parall√®le (Legacy)"
                                            ),
                                            
                                            // S√©lecteur d'√©quipe pour cette √©tape (V6.4 Ultra-Pro)
                                            (formData.ganttMode === 'equipe' && Object.keys(formData.equipesNumerotees || {}).length > 0) ?
                                                React.createElement('div', { className: "flex flex-col gap-1" },
                                                    React.createElement('select', {
                                                        value: formData.assignationsEquipes[index] || '',
                                                        onChange: (e) => {
                                                            const newAssignations = {...formData.assignationsEquipes};
                                                            if (e.target.value) {
                                                                newAssignations[index] = e.target.value;
                                                            } else {
                                                                delete newAssignations[index];
                                                            }
                                                            updateField('assignationsEquipes', newAssignations);
                                                        },
                                                        className: "p-1 border rounded focus:ring-2 focus:ring-purple-500 bg-gradient-to-r from-purple-50 to-blue-50 text-purple-800 min-w-[100px] text-xs font-medium"
                                                    },
                                                        React.createElement('option', { value: '' }, "Aucune √©quipe"),
                                                        ...Object.entries(formData.equipesNumerotees || {}).map(([num, equipe]) => {
                                                            const membresInfo = (equipe.membres || []).map(personnelId => {
                                                                const person = personnel.find(p => p.id === personnelId);
                                                                const horaire = formData.typeHoraire === '24h' && formData.horairesIndividuels[personnelId] 
                                                                    ? (formData.horairesIndividuels[personnelId] === 'nuit' ? ' üåô' : ' ‚òÄÔ∏è')
                                                                    : '';
                                                                return person ? `${person.nom}${horaire}` : '';
                                                            }).filter(Boolean).join(', ');
                                                            
                                                            return React.createElement('option', {
                                                                key: num,
                                                                value: `equipe-${num}`,
                                                                style: { color: equipe.couleur },
                                                                title: membresInfo || 'Aucun membre assign√©'
                                                            }, `üèóÔ∏è √âquipe ${num} (${(equipe.membres || []).length})${equipe.horaire ? ` ${equipe.horaire === 'nuit' ? 'üåô' : '‚òÄÔ∏è'}` : ''}`);
                                                        })
                                                    ),
                                                    // Affichage d√©taill√© des membres avec horaires en mode 24h
                                                    formData.assignationsEquipes[index] && formData.typeHoraire === '24h' && (() => {
                                                        const equipeNum = formData.assignationsEquipes[index]?.replace('equipe-', '');
                                                        const equipe = formData.equipesNumerotees[equipeNum];
                                                        if (!equipe || !equipe.membres || equipe.membres.length === 0) return null;
                                                        
                                                        return React.createElement('div', { 
                                                            className: "text-xs text-gray-600 bg-gray-50 rounded px-2 py-1 max-w-[200px]",
                                                            title: "Membres de l'√©quipe et leurs horaires"
                                                        },
                                                            equipe.membres.map(personnelId => {
                                                                const person = personnel.find(p => p.id === personnelId);
                                                                const horaire = formData.horairesIndividuels[personnelId];
                                                                if (!person) return null;
                                                                return React.createElement('div', { 
                                                                    key: personnelId,
                                                                    className: "flex items-center justify-between"
                                                                },
                                                                    React.createElement('span', null, person.nom),
                                                                    React.createElement('span', { 
                                                                        className: horaire === 'nuit' ? 'text-blue-600' : 'text-orange-600'
                                                                    }, horaire === 'nuit' ? 'üåô' : '‚òÄÔ∏è')
                                                                );
                                                            }).filter(Boolean)
                                                        );
                                                    })()
                                                ) :
                                                // Mode classique avec √©quipes personnalis√©es
                                                (formData.equipes && formData.equipes.length > 0 && React.createElement('select', {
                                                    value: formData.assignationsEquipes[index] || '',
                                                    onChange: (e) => {
                                                        const newAssignations = {...formData.assignationsEquipes};
                                                        if (e.target.value) {
                                                            newAssignations[index] = e.target.value;
                                                        } else {
                                                            delete newAssignations[index];
                                                        }
                                                        updateField('assignationsEquipes', newAssignations);
                                                    },
                                                    className: "p-1 border rounded focus:ring-2 focus:ring-purple-500 bg-purple-50 text-purple-800 min-w-[120px]"
                                                },
                                                    React.createElement('option', { value: '' }, "Aucune √©quipe"),
                                                    ...(formData.equipes || []).filter(eq => eq.actif).map(equipe =>
                                                        React.createElement('option', {
                                                            key: equipe.id,
                                                            value: equipe.id
                                                        }, `üë• ${equipe.nom}`)
                                                    )
                                                )),
                                            
                                            // NOUVELLE SECTION: Assignation individuelle personnel et √©quipements
                                            React.createElement('div', { className: 'border-t border-gray-200 pt-2 mt-2' },
                                                React.createElement('div', { className: 'text-xs font-medium text-gray-700 mb-1' }, 'üë§ Personnel & üîß √âquipements'),
                                                
                                                // Personnel assign√©
                                                React.createElement('div', { className: 'flex flex-wrap gap-1 mb-2' },
                                                    React.createElement('label', { className: 'text-xs text-gray-600 w-full' }, 'Personnel:'),
                                                    React.createElement('select', {
                                                        multiple: true,
                                                        value: etape.assignedPersonnel || [],
                                                        onChange: (e) => {
                                                            const selectedIds = Array.from(e.target.selectedOptions).map(option => option.value);
                                                            const newEtapes = [...formData.etapes];
                                                            newEtapes[index].assignedPersonnel = selectedIds;
                                                            updateField('etapes', newEtapes);
                                                        },
                                                        className: 'text-xs border rounded px-1 py-0.5 focus:ring-1 focus:ring-blue-500 max-w-[150px] bg-blue-50',
                                                        size: 3
                                                    },
                                                        React.createElement('option', { value: '', disabled: true }, 'S√©lectionner...'),
                                                        ...personnel.map(person =>
                                                            React.createElement('option', {
                                                                key: person.id,
                                                                value: person.id,
                                                                title: `${person.nom} - ${person.poste || 'Poste non sp√©cifi√©'}`
                                                            }, `${person.nom} (${person.poste || 'N/A'})`)
                                                        )
                                                    ),
                                                    
                                                    // Affichage compact du personnel assign√©
                                                    etape.assignedPersonnel && etape.assignedPersonnel.length > 0 &&
                                                    React.createElement('div', { className: 'flex flex-wrap gap-1 mt-1' },
                                                        etape.assignedPersonnel.map(personnelId => {
                                                            const person = personnel.find(p => p.id === personnelId);
                                                            if (!person) return null;
                                                            return React.createElement('span', {
                                                                key: personnelId,
                                                                className: 'inline-flex items-center gap-1 px-1 py-0.5 bg-blue-100 text-blue-800 text-xs rounded',
                                                                title: `${person.nom} - ${person.poste || 'N/A'}`
                                                            },
                                                                React.createElement('span', null, person.nom.split(' ')[0]),
                                                                React.createElement('button', {
                                                                    type: 'button',
                                                                    onClick: () => {
                                                                        const newEtapes = [...formData.etapes];
                                                                        newEtapes[index].assignedPersonnel = (newEtapes[index].assignedPersonnel || []).filter(id => id !== personnelId);
                                                                        updateField('etapes', newEtapes);
                                                                    },
                                                                    className: 'text-blue-600 hover:text-blue-800 text-xs'
                                                                }, '√ó')
                                                            );
                                                        })
                                                    )
                                                ),
                                                
                                                // √âquipements assign√©s
                                                React.createElement('div', { className: 'flex flex-wrap gap-1' },
                                                    React.createElement('label', { className: 'text-xs text-gray-600 w-full' }, '√âquipements:'),
                                                    React.createElement('select', {
                                                        multiple: true,
                                                        value: etape.assignedEquipment || [],
                                                        onChange: (e) => {
                                                            const selectedIds = Array.from(e.target.selectedOptions).map(option => option.value);
                                                            const newEtapes = [...formData.etapes];
                                                            newEtapes[index].assignedEquipment = selectedIds;
                                                            updateField('etapes', newEtapes);
                                                        },
                                                        className: 'text-xs border rounded px-1 py-0.5 focus:ring-1 focus:ring-orange-500 max-w-[150px] bg-orange-50',
                                                        size: 3
                                                    },
                                                        React.createElement('option', { value: '', disabled: true }, 'S√©lectionner...'),
                                                        ...equipements.map(equipment =>
                                                            React.createElement('option', {
                                                                key: equipment.id,
                                                                value: equipment.id,
                                                                title: `${equipment.nom} - ${equipment.type || 'Type non sp√©cifi√©'}`
                                                            }, `${equipment.nom} (${equipment.type || 'N/A'})`)
                                                        )
                                                    ),
                                                    
                                                    // Affichage compact des √©quipements assign√©s
                                                    etape.assignedEquipment && etape.assignedEquipment.length > 0 &&
                                                    React.createElement('div', { className: 'flex flex-wrap gap-1 mt-1' },
                                                        etape.assignedEquipment.map(equipmentId => {
                                                            const equipment = equipements.find(e => e.id === equipmentId);
                                                            if (!equipment) return null;
                                                            return React.createElement('span', {
                                                                key: equipmentId,
                                                                className: 'inline-flex items-center gap-1 px-1 py-0.5 bg-orange-100 text-orange-800 text-xs rounded',
                                                                title: `${equipment.nom} - ${equipment.type || 'N/A'}`
                                                            },
                                                                React.createElement('span', null, equipment.nom.split(' ')[0]),
                                                                React.createElement('button', {
                                                                    type: 'button',
                                                                    onClick: () => {
                                                                        const newEtapes = [...formData.etapes];
                                                                        newEtapes[index].assignedEquipment = (newEtapes[index].assignedEquipment || []).filter(id => id !== equipmentId);
                                                                        updateField('etapes', newEtapes);
                                                                    },
                                                                    className: 'text-orange-600 hover:text-orange-800 text-xs'
                                                                }, '√ó')
                                                            );
                                                        })
                                                    )
                                                ),
                                                
                                                // R√©sum√© compact des assignations
                                                React.createElement('div', { className: 'text-xs text-gray-500 mt-1 flex gap-2' },
                                                    React.createElement('span', null, 
                                                        `üë§ ${(etape.assignedPersonnel || []).length} pers.`
                                                    ),
                                                    React.createElement('span', null, 
                                                        `üîß ${(etape.assignedEquipment || []).length} √©quip.`
                                                    )
                                                )
                                            ),
                                            React.createElement('button', {
                                                type: "button",
                                                onClick: () => {
                                                    const newEtapes = formData.etapes.filter((_, i) => i !== index);
                                                    updateField('etapes', newEtapes);
                                                },
                                                className: "text-red-500 hover:text-red-700 p-1"
                                            }, "üóëÔ∏è")
                                        )
                                    )
                                ),
                                
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => {
                                        const newEtapes = [...formData.etapes, { 
                                            id: `etape-${Date.now()}-${formData.etapes.length}`,
                                            number: formData.etapes.length + 1,
                                            text: '', 
                                            completed: false,
                                            assignedPersonnel: [],
                                            assignedEquipment: [], 
                                            duration: 0.25, 
                                            isParallel: false, 
                                            dependencies: [], 
                                            priority: 'normal',
                                            baseline: { startDate: '', endDate: '', duration: 0.25 }
                                        }];
                                        updateField('etapes', newEtapes);
                                    },
                                    className: "w-full p-2 border border-dashed border-blue-300 rounded-lg text-blue-600 hover:bg-blue-100 transition-colors flex items-center justify-center gap-2"
                                },
                                    React.createElement('span', null, "‚ûï"),
                                    "Ajouter une √©tape"
                                ),
                                
                                // Vue d'ensemble des assignations d'√©quipes
                                formData.equipes && formData.equipes.length > 0 && formData.assignationsEquipes && Object.keys(formData.assignationsEquipes).length > 0 && React.createElement('div', {
                                    className: "mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200"
                                },
                                    React.createElement('h5', { className: "text-sm font-medium text-purple-800 mb-2" },
                                        "üë• Vue d'ensemble des assignations"
                                    ),
                                    React.createElement('div', { className: "space-y-1 text-sm" },
                                        Object.entries(formData.assignationsEquipes || {}).map(([etapeIndex, equipeId]) => {
                                            const etape = formData.etapes[parseInt(etapeIndex)];
                                            
                                            // V6.4 Ultra-Pro: Support √©quipes num√©rot√©es et classiques
                                            let equipeName = '';
                                            let equipeColor = '#6B7280';
                                            
                                            if (equipeId && equipeId.startsWith('equipe-')) {
                                                const equipeNum = equipeId.replace('equipe-', '');
                                                const equipeNumerotee = formData.equipesNumerotees && formData.equipesNumerotees[equipeNum];
                                                if (equipeNumerotee) {
                                                    equipeName = `üèóÔ∏è √âquipe ${equipeNum} (${(equipeNumerotee.membres || []).length})`;
                                                    equipeColor = equipeNumerotee.couleur;
                                                }
                                            } else if (equipeId) {
                                                const equipe = (formData.equipes || []).find(eq => eq.id === equipeId);
                                                if (equipe) {
                                                    equipeName = `üë• ${equipe.nom}`;
                                                }
                                            }
                                            
                                            if (!etape || !equipeName) return null;
                                            
                                            return React.createElement('div', {
                                                key: etapeIndex,
                                                className: "flex items-center justify-between text-purple-700 p-2 bg-white rounded border hover:shadow-sm transition-shadow"
                                            },
                                                React.createElement('span', { className: "truncate flex-1 text-xs" },
                                                    `√âtape ${parseInt(etapeIndex) + 1}: ${etape.text || 'Sans nom'}`
                                                ),
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('span', { 
                                                        className: "font-medium ml-2 text-xs px-2 py-1 rounded",
                                                        style: { 
                                                            color: equipeColor,
                                                            backgroundColor: `${equipeColor}15`
                                                        }
                                                    }, equipeName),
                                                    // Modification rapide directement dans l'aper√ßu
                                                    React.createElement('select', {
                                                        value: equipeId || '',
                                                        onChange: (e) => {
                                                            const newAssignations = {...formData.assignationsEquipes};
                                                            if (e.target.value) {
                                                                newAssignations[etapeIndex] = e.target.value;
                                                            } else {
                                                                delete newAssignations[etapeIndex];
                                                            }
                                                            updateField('assignationsEquipes', newAssignations);
                                                        },
                                                        className: "px-1 py-0.5 border rounded text-xs focus:ring-1 focus:ring-purple-500 bg-white",
                                                        title: "Modification rapide de l'√©quipe"
                                                    },
                                                        React.createElement('option', { value: '' }, "Aucune"),
                                                        formData.ganttMode === 'equipe' ?
                                                            Object.entries(formData.equipesNumerotees || {}).map(([num, equipe]) =>
                                                                React.createElement('option', { 
                                                                    key: num, 
                                                                    value: `equipe-${num}`,
                                                                    style: { color: equipe.couleur }
                                                                }, `√âquipe ${num}`)
                                                            ) :
                                                            (formData.equipes || []).filter(eq => eq.actif).map(equipe =>
                                                                React.createElement('option', { 
                                                                    key: equipe.id, 
                                                                    value: equipe.id 
                                                                }, equipe.nom)
                                                            )
                                                    )
                                                )
                                            );
                                        }).filter(Boolean)
                                    )
                                ),
                                
                                // Section √âquipes optimis√©e
                                React.createElement('div', {
                                    className: "mt-3 p-3 bg-purple-50 rounded-lg border border-purple-200 space-y-2"
                                },
                                    React.createElement('h5', { className: "text-sm font-medium text-purple-800 mb-2 flex items-center justify-between" },
                                        React.createElement('span', null, "üë• √âquipes"),
                                        React.createElement('div', { className: "flex gap-2" },
                                            // Cr√©er nouvelle √©quipe
                                            React.createElement('button', {
                                                type: "button",
                                                onClick: () => creerNouvelleEquipe(),
                                                className: "px-3 py-1 bg-green-100 text-green-700 rounded text-xs hover:bg-green-200 border border-green-300",
                                                title: "Cr√©er une nouvelle √©quipe (d√©tection horaire auto)"
                                            }, "‚ûï Nouvelle √âquipe"),
                                            
                                            
                                            // Toggle mode Gantt
                                            React.createElement('select', {
                                                value: formData.ganttMode,
                                                onChange: (e) => updateField('ganttMode', e.target.value),
                                                className: "px-2 py-1 border rounded text-xs focus:ring-2 focus:ring-purple-500 bg-white"
                                            },
                                                React.createElement('option', { value: 'individuel' }, "üë§ Mode Individuel"),
                                                React.createElement('option', { value: 'equipe' }, "üë• Mode √âquipe")
                                            )
                                        )
                                    ),
                                    
                                    // Assignation personnel aux √©quipes
                                    formData.ganttMode === 'equipe' && Object.keys(formData.equipesNumerotees || {}).length > 0 && 
                                    React.createElement('div', { className: "space-y-2" },
                                        React.createElement('div', { className: "flex items-center justify-between mb-2" },
                                            React.createElement('h6', { className: "text-xs font-medium text-purple-700" },
                                                "üë∑ Assignation Personnel ‚Üí √âquipes"
                                            ),
                                            React.createElement('div', { className: "text-xs text-gray-600" },
                                                `${(formData.personnel || []).filter(pId => getPersonnelEquipe(pId) !== null).length}/${(formData.personnel || []).length} assign√©s`
                                            )
                                        ),
                                        React.createElement('div', { className: "grid grid-cols-1 gap-2 max-h-40 overflow-y-auto" },
                                            (formData.personnel || []).map(personnelId => {
                                                const person = personnel.find(p => p.id === personnelId);
                                                const equipeActuelle = getPersonnelEquipe(personnelId);
                                                const equipeInfo = equipeActuelle ? formData.equipesNumerotees[equipeActuelle] : null;
                                                
                                                return person && React.createElement('div', {
                                                    key: personnelId,
                                                    className: "flex items-center justify-between p-2 bg-white rounded border text-xs hover:shadow-sm transition-shadow",
                                                    style: equipeInfo ? { 
                                                        borderLeftColor: equipeInfo.couleur,
                                                        borderLeftWidth: '3px',
                                                        backgroundColor: `${equipeInfo.couleur}08`
                                                    } : {}
                                                },
                                                    React.createElement('div', { className: "flex items-center gap-2" },
                                                        // Ic√¥ne horaire de l'√©quipe
                                                        equipeInfo && React.createElement('span', { 
                                                            className: "text-xs",
                                                            title: `Horaire: ${equipeInfo.horaire}`
                                                        }, equipeInfo.horaire === 'jour' ? 'üåû' : 'üåô'),
                                                        
                                                        React.createElement('span', { 
                                                            className: `font-medium ${equipeActuelle ? 'text-purple-700' : 'text-gray-600'}` 
                                                        }, 
                                                            person.nom
                                                        ),
                                                        
                                                        // Badge √©quipe actuelle
                                                        equipeActuelle && React.createElement('span', { 
                                                            className: "px-2 py-1 rounded text-xs font-medium",
                                                            style: { 
                                                                backgroundColor: equipeInfo?.couleur + '20',
                                                                color: equipeInfo?.couleur
                                                            }
                                                        }, `${equipeInfo?.nom || `√âquipe ${equipeActuelle}`}`)
                                                    ),
                                                    
                                                    React.createElement('select', {
                                                        value: equipeActuelle || '',
                                                        onChange: (e) => {
                                                            console.log(`Assignation ${person.nom} ‚Üí √âquipe ${e.target.value}`);
                                                            assignerPersonnelEquipe(personnelId, e.target.value || null);
                                                        },
                                                        className: "px-2 py-1 border rounded text-xs focus:ring-2 focus:ring-purple-500 bg-white min-w-[100px]"
                                                    },
                                                        React.createElement('option', { value: '' }, "‚ùå Aucune"),
                                                        ...Object.entries(formData.equipesNumerotees || {}).map(([num, equipe]) =>
                                                            React.createElement('option', { 
                                                                key: num, 
                                                                value: num,
                                                                style: { color: equipe.couleur }
                                                            }, `${equipe.horaire === 'jour' ? 'üåû' : 'üåô'} ${equipe.nom}`)
                                                        )
                                                    )
                                                );
                                            }).filter(Boolean)
                                        )
                                    ),
                                    
                                    // Aper√ßu des √©quipes
                                    Object.keys(formData.equipesNumerotees || {}).length > 0 && React.createElement('div', {
                                        className: "mt-3 p-2 bg-white rounded border space-y-1"
                                    },
                                        React.createElement('div', { className: "text-xs font-medium text-gray-700 mb-2 flex items-center justify-between" }, 
                                            React.createElement('span', null, `üìä Aper√ßu √âquipes (${Object.keys(formData.equipesNumerotees || {}).length} cr√©√©e${Object.keys(formData.equipesNumerotees || {}).length !== 1 ? 's' : ''})`),
                                            React.createElement('div', { className: "flex gap-1" },
                                                // Bouton cr√©ation rapide jour
                                                formData.typeHoraire === '24h' && React.createElement('button', {
                                                    type: "button",
                                                    onClick: () => creerNouvelleEquipe('jour'),
                                                    className: "px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs hover:bg-yellow-200 border border-yellow-300",
                                                    title: "Cr√©er √©quipe JOUR"
                                                }, "üåû J"),
                                                
                                                // Bouton cr√©ation rapide nuit  
                                                formData.typeHoraire === '24h' && React.createElement('button', {
                                                    type: "button",
                                                    onClick: () => creerNouvelleEquipe('nuit'),
                                                    className: "px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs hover:bg-indigo-200 border border-indigo-300",
                                                    title: "Cr√©er √©quipe NUIT"
                                                }, "üåô N"),
                                                
                                                // Bouton suppression toutes √©quipes
                                                Object.keys(formData.equipesNumerotees || {}).length > 0 && React.createElement('button', {
                                                    type: "button",
                                                    onClick: () => {
                                                        if (confirm(`Supprimer toutes les ${Object.keys(formData.equipesNumerotees || {}).length} √©quipes ?`)) {
                                                            updateField('equipesNumerotees', {});
                                                            updateField('assignationsEquipes', {});
                                                            updateField('prochainNumeroEquipe', 1);
                                                        }
                                                    },
                                                    className: "px-2 py-1 bg-red-100 text-red-700 rounded text-xs hover:bg-red-200 border border-red-300",
                                                    title: "Supprimer toutes les √©quipes"
                                                }, "üóëÔ∏è")
                                            )
                                        ),
                                        Object.entries(formData.equipesNumerotees || {}).map(([num, equipe]) =>
                                            React.createElement('div', {
                                                key: num,
                                                className: "flex items-center justify-between text-xs p-2 rounded border-l-4 hover:shadow-sm transition-shadow",
                                                style: { 
                                                    backgroundColor: `${equipe.couleur}10`,
                                                    borderLeftColor: equipe.couleur
                                                }
                                            },
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    // Ic√¥ne horaire
                                                    React.createElement('span', { 
                                                        className: "text-xs",
                                                        title: `Horaire: ${equipe.horaire}`
                                                    }, equipe.horaire === 'jour' ? 'üåû' : equipe.horaire === 'nuit' ? 'üåô' : '‚è∞'),
                                                    
                                                    // Nom modifiable
                                                    React.createElement('input', {
                                                        type: "text",
                                                        value: equipe.nom,
                                                        onChange: (e) => modifierEquipe(num, { nom: e.target.value }),
                                                        className: "bg-transparent border-none p-0 font-medium focus:outline-none focus:bg-white focus:px-1 focus:rounded text-xs min-w-0 flex-1",
                                                        style: { color: equipe.couleur }
                                                    }),
                                                    
                                                    // S√©lecteur horaire en mode 24h
                                                    formData.typeHoraire === '24h' && React.createElement('select', {
                                                        value: equipe.horaire,
                                                        onChange: (e) => modifierEquipe(num, { horaire: e.target.value }),
                                                        className: "bg-white border rounded px-1 py-0.5 text-xs focus:ring-1 focus:ring-blue-500",
                                                        style: { color: equipe.couleur }
                                                    },
                                                        React.createElement('option', { value: 'jour' }, "üåû Jour"),
                                                        React.createElement('option', { value: 'nuit' }, "üåô Nuit")
                                                    )
                                                ),
                                                
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('span', { 
                                                        className: "text-gray-600 font-medium px-2 py-1 bg-white rounded",
                                                        title: "Nombre de membres"
                                                    }, `${Array.isArray(equipe.membres) ? equipe.membres.length : 0}`),
                                                    
                                                    // Bouton supprimer √©quipe
                                                    React.createElement('button', {
                                                        type: "button",
                                                        onClick: () => {
                                                            if (confirm(`Supprimer "${equipe.nom}" ?`)) {
                                                                supprimerEquipe(num);
                                                            }
                                                        },
                                                        className: "text-red-500 hover:text-red-700 p-1 hover:bg-red-100 rounded",
                                                        title: "Supprimer cette √©quipe"
                                                    }, "√ó")
                                                )
                                            )
                                        )
                                    )
                                ),
                                
                                // V6.2: Section contr√¥les Gantt avanc√©s
                                React.createElement('div', {
                                    className: "mt-4 p-3 bg-indigo-50 rounded-lg border border-indigo-200 space-y-3"
                                },
                                    React.createElement('h5', { className: "text-sm font-medium text-indigo-800 mb-2" },
                                        "‚öôÔ∏è Contr√¥les Gantt avanc√©s (V6.2)"
                                    ),
                                    
                                    React.createElement('div', { className: "flex flex-wrap gap-3" },
                                        // Bouton sauvegarde baseline
                                        React.createElement('button', {
                                            type: "button",
                                            onClick: saveBaseline,
                                            className: "px-3 py-1 bg-indigo-100 text-indigo-700 rounded text-xs hover:bg-indigo-200 border border-indigo-300",
                                            title: "Sauvegarder le planning actuel comme r√©f√©rence"
                                        }, "üíæ Sauver Baseline"),
                                        
                                        // Toggle chemin critique
                                        React.createElement('label', { 
                                            className: "flex items-center gap-1 text-xs text-red-700",
                                            title: "Afficher le chemin critique en rouge"
                                        },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: formData.showCriticalPath,
                                                onChange: (e) => updateField('showCriticalPath', e.target.checked),
                                                className: "rounded focus:ring-red-500"
                                            }),
                                            "üî¥ Chemin critique"
                                        ),
                                        
                                        // S√©lecteur vue Gantt
                                        React.createElement('select', {
                                            value: formData.ganttViewMode,
                                            onChange: (e) => updateField('ganttViewMode', e.target.value),
                                            className: "px-2 py-1 border rounded text-xs focus:ring-2 focus:ring-indigo-500"
                                        },
                                            React.createElement('option', { value: 'hours' }, "Vue Heures"),
                                            React.createElement('option', { value: 'days' }, "Vue Jours"),
                                            React.createElement('option', { value: 'weeks' }, "Vue Semaines"),
                                            React.createElement('option', { value: 'months' }, "Vue Mois")
                                        )
                                    ),
                                    
                                    // Informations baseline
                                    formData.ganttBaseline && formData.ganttBaseline.savedDate && React.createElement('div', {
                                        className: "text-xs text-gray-600 mt-2 p-2 bg-white rounded border"
                                    },
                                        React.createElement('span', { className: "font-medium" }, "üìä Baseline sauv√©e: "),
                                        new Date(formData.ganttBaseline.savedDate).toLocaleString(),
                                        React.createElement('span', { className: "ml-2" }, 
                                            `(${formData.ganttBaseline.totalDuration}h total)`
                                        )
                                    )
                                ),
                                
                                React.createElement('div', {
                                    className: "mt-4 p-3 bg-green-50 rounded-lg border border-green-200"
                                },
                                    React.createElement('h5', { className: "font-medium text-green-800 text-center" },
                                        "üéØ Planificateur C-Secur360 V6.4"
                                    ),
                                    React.createElement('div', { className: "text-xs text-green-600 text-center mt-1" },
                                        `Dur√©e totale: ${
                                            formData.etapes && formData.etapes.length > 0 
                                                ? `${formData.etapes.reduce((sum, etape) => sum + (parseFloat(etape.duration) || 0.25), 0)}h`
                                                : '0h'
                                        }`
                                    )
                                )
                            )
                        ),

                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('h3', { className: "text-lg font-semibold border-b pb-2" }, "Planification"),
                            
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Date d√©but *"),
                                    React.createElement('input', {
                                        type: "date",
                                        value: formData.dateDebut,
                                        onChange: (e) => updateField('dateDebut', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                        required: true
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Heure d√©but"),
                                    React.createElement('input', {
                                        type: "time",
                                        value: formData.heureDebut,
                                        onChange: (e) => updateField('heureDebut', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    })
                                )
                            ),

                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Date fin"),
                                    React.createElement('input', {
                                        type: "date",
                                        value: formData.dateFin,
                                        onChange: (e) => updateField('dateFin', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Heure fin"),
                                    React.createElement('input', {
                                        type: "time",
                                        value: formData.heureFin,
                                        onChange: (e) => updateField('heureFin', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    })
                                )
                            ),

                            // Section Calcul automatique de dur√©e
                            React.createElement('div', { className: "p-4 bg-green-50 rounded-lg space-y-4 border border-green-200" },
                                React.createElement('h4', { className: "font-medium text-green-800 flex items-center gap-2 mb-3" },
                                    React.createElement('span', null, "‚è±Ô∏è"),
                                    "Calcul automatique de dur√©e"
                                ),
                                
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-sm font-medium mb-1 text-green-700" }, "Dur√©e pr√©vue (heures)"),
                                        React.createElement('input', {
                                            type: "number",
                                            min: "0",
                                            step: "0.25",
                                            value: formData.dureePreviewHours,
                                            onChange: (e) => updateField('dureePreviewHours', e.target.value),
                                            className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-green-500",
                                            placeholder: "Ex: 96"
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-sm font-medium mb-1 text-green-700" }, "Type d'horaire"),
                                        React.createElement('select', {
                                            value: formData.typeHoraire,
                                            onChange: (e) => updateField('typeHoraire', e.target.value),
                                            className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-green-500"
                                        },
                                            React.createElement('option', { value: "jour" }, "Jour"),
                                            React.createElement('option', { value: "nuit" }, "Nuit"),
                                            React.createElement('option', { value: "24h" }, "24h/24h")
                                        )
                                    ),
                                    React.createElement('div', { className: "flex items-center justify-center" },
                                        React.createElement('label', { className: "flex items-center gap-2 text-sm font-medium text-green-700" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: formData.includeWeekendsInDuration,
                                                onChange: (e) => updateField('includeWeekendsInDuration', e.target.checked),
                                                className: "rounded focus:ring-green-500"
                                            }),
                                            "Inclure fins de semaine"
                                        )
                                    )
                                ),
                                
                                React.createElement('p', { className: "text-xs text-green-600" },
                                    "üí° Entrez la dur√©e totale en heures. La date de fin sera calcul√©e automatiquement selon :",
                                    React.createElement('br'),
                                    "‚Ä¢ Jour/Nuit : Bas√© sur vos heures d√©but/fin ‚Ä¢ 24h/24h : 24h/jour"
                                )
                            ),

                            // Section R√©currence
                            React.createElement('div', { className: "p-4 bg-blue-50 rounded-lg space-y-3" },
                                React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                                    React.createElement('input', {
                                        type: "checkbox",
                                        id: "recurrence-active",
                                        checked: formData.recurrence?.active || false,
                                        onChange: (e) => updateField('recurrence', {
                                            ...(formData.recurrence || {}),
                                            active: e.target.checked
                                        }),
                                        className: "rounded"
                                    }),
                                    React.createElement('label', { 
                                        htmlFor: "recurrence-active",
                                        className: "font-medium text-blue-800" 
                                    }, "üîÑ √âv√©nement r√©current")
                                ),

                                formData.recurrence?.active && React.createElement('div', { className: "space-y-4" },
                                    // Type de r√©currence
                                    React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Fr√©quence"),
                                            React.createElement('select', {
                                                value: formData.recurrence?.type || 'hebdomadaire',
                                                onChange: (e) => updateField('recurrence', {
                                                    ...(formData.recurrence || {}),
                                                    type: e.target.value
                                                }),
                                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                            },
                                                React.createElement('option', { value: "hebdomadaire" }, "Hebdomadaire"),
                                                React.createElement('option', { value: "mensuel" }, "Mensuel"),
                                                React.createElement('option', { value: "annuel" }, "Annuel")
                                            )
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, 
                                                `R√©p√©ter tous les ${formData.recurrence?.intervalle || 1} ${
                                                    (formData.recurrence?.type || 'hebdomadaire') === 'hebdomadaire' ? 'semaine(s)' :
                                                    (formData.recurrence?.type || 'hebdomadaire') === 'mensuel' ? 'mois' : 'ann√©e(s)'
                                                }`
                                            ),
                                            React.createElement('input', {
                                                type: "number",
                                                min: "1",
                                                max: "12",
                                                value: formData.recurrence?.intervalle || 1,
                                                onChange: (e) => updateField('recurrence', {
                                                    ...(formData.recurrence || {}),
                                                    intervalle: parseInt(e.target.value) || 1
                                                }),
                                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                            })
                                        )
                                    ),

                                    // Fin de r√©currence
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Fin de r√©currence"),
                                        React.createElement('div', { className: "flex gap-4 mb-3" },
                                            React.createElement('label', { className: "flex items-center gap-2" },
                                                React.createElement('input', {
                                                    type: "radio",
                                                    name: "finRecurrence",
                                                    value: "date",
                                                    checked: (formData.recurrence?.finRecurrence || 'date') === 'date',
                                                    onChange: (e) => updateField('recurrence', {
                                                        ...(formData.recurrence || {}),
                                                        finRecurrence: e.target.value
                                                    })
                                                }),
                                                React.createElement('span', { className: "text-sm" }, "Jusqu'√† une date")
                                            ),
                                            React.createElement('label', { className: "flex items-center gap-2" },
                                                React.createElement('input', {
                                                    type: "radio",
                                                    name: "finRecurrence",
                                                    value: "occurrences",
                                                    checked: (formData.recurrence?.finRecurrence || 'date') === 'occurrences',
                                                    onChange: (e) => updateField('recurrence', {
                                                        ...(formData.recurrence || {}),
                                                        finRecurrence: e.target.value
                                                    })
                                                }),
                                                React.createElement('span', { className: "text-sm" }, "Nombre d'occurrences")
                                            )
                                        ),

                                        (formData.recurrence?.finRecurrence || 'date') === 'date' ? 
                                            React.createElement('input', {
                                                type: "date",
                                                value: formData.recurrence?.dateFinRecurrence || '',
                                                onChange: (e) => updateField('recurrence', {
                                                    ...(formData.recurrence || {}),
                                                    dateFinRecurrence: e.target.value
                                                }),
                                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                            }) :
                                            React.createElement('input', {
                                                type: "number",
                                                min: "1",
                                                max: "100",
                                                value: formData.recurrence?.nombreOccurrences || 10,
                                                onChange: (e) => updateField('recurrence', {
                                                    ...(formData.recurrence || {}),
                                                    nombreOccurrences: parseInt(e.target.value) || 1
                                                }),
                                                className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                                placeholder: "Nombre d'√©v√©nements"
                                            })
                                    )
                                )
                            ),


                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Priorit√©"),
                                    React.createElement('select', {
                                        value: formData.priorite,
                                        onChange: (e) => updateField('priorite', e.target.value),
                                        className: `w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${getPriorityColor(formData.priorite)}`
                                    },
                                        React.createElement('option', { value: "faible" }, "Faible"),
                                        React.createElement('option', { value: "normale" }, "Normale"),
                                        React.createElement('option', { value: "haute" }, "Haute"),
                                        React.createElement('option', { value: "urgent" }, "Urgent")
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium mb-1" }, "Statut"),
                                    React.createElement('select', {
                                        value: formData.statut,
                                        onChange: (e) => updateField('statut', e.target.value),
                                        className: "w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    },
                                        React.createElement('option', { value: "planifie" }, "Planifi√©"),
                                        React.createElement('option', { value: "tentatif" }, "Tentatif"),
                                        React.createElement('option', { value: "reporte" }, "Report√©"),
                                        React.createElement('option', { value: "annule" }, "Annul√©")
                                    )
                                )
                            ),


                            // Section Pr√©paration (remplace Notes)
                            React.createElement('div', { 
                                className: `p-4 bg-orange-50 rounded-lg border border-orange-200 transition-all duration-300 ${
                                    expandedSections.preparation ? 'fixed inset-4 z-50 bg-white shadow-2xl' : ''
                                }`,
                                onDoubleClick: () => {
                                    setExpandedSections(prev => ({
                                        ...prev,
                                        preparation: !prev.preparation
                                    }));
                                }
                            },
                                React.createElement('h4', { className: `font-medium text-orange-800 flex items-center gap-2 mb-3 ${expandedSections.preparation ? 'text-lg' : ''}` },
                                    React.createElement('span', null, "üõ†Ô∏è"),
                                    "Pr√©paration et mat√©riel",
                                    React.createElement('button', {
                                        onClick: (e) => {
                                            e.stopPropagation();
                                            printTodos('preparation');
                                        },
                                        className: "ml-auto text-orange-600 hover:text-orange-800 p-1 rounded bg-orange-100 hover:bg-orange-200 text-sm",
                                        title: "Imprimer la pr√©paration"
                                    }, "üñ®Ô∏è"),
                                    expandedSections.preparation && React.createElement('button', {
                                        onClick: (e) => {
                                            e.stopPropagation();
                                            setExpandedSections(prev => ({
                                                ...prev,
                                                preparation: false
                                            }));
                                        },
                                        className: "ml-2 text-gray-500 hover:text-gray-700 text-2xl"
                                    }, "√ó"),
                                    !expandedSections.preparation && React.createElement('span', { className: "ml-2 text-xs text-orange-400" }, "Double-clic pour agrandir")
                                ),
                                
                                React.createElement('div', { 
                                    className: `space-y-2 mb-3 ${
                                        expandedSections.preparation 
                                            ? 'overflow-y-auto max-h-[70vh]' 
                                            : 'max-h-40 overflow-y-auto'
                                    }`,
                                    style: expandedSections.preparation ? { maxHeight: 'calc(100vh - 200px)' } : {}
                                },
                                    formData.preparation.map((item, index) => 
                                        React.createElement('div', { 
                                            key: index,
                                            className: `flex items-center gap-2 p-2 bg-white rounded border ${
                                                expandedSections.preparation ? 'p-3' : ''
                                            }`
                                        },
                                            React.createElement('select', {
                                                value: item.statut,
                                                onChange: (e) => {
                                                    const newPreparation = [...formData.preparation];
                                                    newPreparation[index].statut = e.target.value;
                                                    updateField('preparation', newPreparation);
                                                },
                                                className: `px-2 py-1 border rounded text-xs font-medium ${
                                                    item.statut === 'fait' ? 'bg-green-100 text-green-700 border-green-300' :
                                                    item.statut === 'en_commande' ? 'bg-blue-100 text-blue-700 border-blue-300' :
                                                    'bg-yellow-100 text-yellow-700 border-yellow-300'
                                                }`
                                            },
                                                React.createElement('option', { value: "a_reserver" }, "√Ä r√©server"),
                                                React.createElement('option', { value: "en_commande" }, "En commande"),
                                                React.createElement('option', { value: "fait" }, "‚úì Fait")
                                            ),
                                            React.createElement('input', {
                                                type: "text",
                                                value: item.text,
                                                onChange: (e) => {
                                                    const newPreparation = [...formData.preparation];
                                                    newPreparation[index].text = e.target.value;
                                                    updateField('preparation', newPreparation);
                                                },
                                                className: `flex-1 p-1 border rounded focus:ring-2 focus:ring-orange-500 ${item.statut === 'fait' ? 'line-through text-gray-500' : ''}`,
                                                placeholder: "Mat√©riel, √©quipement, r√©servation..."
                                            }),
                                            React.createElement('button', {
                                                type: "button",
                                                onClick: () => {
                                                    const newPreparation = formData.preparation.filter((_, i) => i !== index);
                                                    updateField('preparation', newPreparation);
                                                },
                                                className: "text-red-500 hover:text-red-700 p-1"
                                            }, "üóëÔ∏è")
                                        )
                                    )
                                ),
                                
                                React.createElement('button', {
                                    type: "button",
                                    onClick: () => {
                                        const newPreparation = [...formData.preparation, { text: '', statut: 'a_reserver' }];
                                        updateField('preparation', newPreparation);
                                    },
                                    className: "w-full p-2 border border-dashed border-orange-300 rounded-lg text-orange-600 hover:bg-orange-100 transition-colors flex items-center justify-center gap-2"
                                },
                                    React.createElement('span', null, "‚ûï"),
                                    "Ajouter un √©l√©ment"
                                ),
                                
                                React.createElement('p', { className: "text-xs text-orange-600 mt-2" },
                                    "üí° Listez les mat√©riaux, √©quipements et r√©servations n√©cessaires. Suivez leur statut de pr√©paration."
                                )
                            )
                        )
                    ),

                    // S√©lection des ressources
                    React.createElement('div', null,
                        React.createElement('h3', { className: "text-lg font-semibold mb-4" }, "Assignation des ressources"),
                        React.createElement(ResourceSelector, {
                            selectedPersonnel: formData.personnel,
                            selectedEquipements: formData.equipements,
                            selectedSousTraitants: formData.sousTraitants,
                            onPersonnelChange: (personnel) => updateField('personnel', personnel),
                            onEquipementsChange: (equipements) => updateField('equipements', equipements),
                            onSousTraitantsChange: (sousTraitants) => updateField('sousTraitants', sousTraitants),
                            personnel,
                            equipements,
                            sousTraitants,
                            dateDebut: formData.dateDebut,
                            dateFin: formData.dateFin,
                            jobs: jobs.filter(j => j.id !== job?.id),
                            currentJobId: job?.id
                        }),

                        // Gestion des horaires individuels pour travaux 24h/24h
                        formData.typeHoraire === '24h' && formData.personnel.length > 0 && 
                        React.createElement('div', { className: "mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200" },
                            React.createElement('h4', { className: "font-medium text-amber-800 mb-3 flex items-center gap-2" },
                                React.createElement('span', null, "‚è∞"),
                                "Horaires individuels (Travaux 24h/24h)"
                            ),
                            React.createElement('p', { className: "text-sm text-amber-700 mb-3" },
                                "Sp√©cifiez l'horaire de chaque travailleur pour ce projet 24h/24h :"
                            ),
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
                                ...formData.personnel.map(personnelId => {
                                    const person = personnel.find(p => p.id === personnelId);
                                    if (!person) return null;
                                    
                                    return React.createElement('div', { 
                                        key: personnelId,
                                        className: "flex items-center justify-between p-3 bg-white rounded border"
                                    },
                                        React.createElement('span', { className: "font-medium text-sm" }, person.nom),
                                        React.createElement('select', {
                                            value: formData.horairesIndividuels[personnelId] || 'jour',
                                            onChange: (e) => updateField('horairesIndividuels', {
                                                ...formData.horairesIndividuels,
                                                [personnelId]: e.target.value
                                            }),
                                            className: "px-3 py-1 text-sm border rounded focus:ring-2 focus:ring-amber-500"
                                        },
                                            React.createElement('option', { value: "jour" }, "Jour ‚òÄÔ∏è"),
                                            React.createElement('option', { value: "nuit" }, "Nuit üåô")
                                        )
                                    );
                                }).filter(Boolean)
                            )
                        )
                    ),

                    // Documents et Photos
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                        // Documents
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Documents du projet"),
                            React.createElement(DropZone, {
                                onFilesAdded: (files) => handleFilesAdded(files, 'documents'),
                                acceptedTypes: ['.pdf', '.doc', '.docx', '.xls', '.xlsx'],
                                className: formData.documents.length > 0 ? 'has-files' : ''
                            },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement(Icon, { name: 'paperclip', size: 32, className: 'mx-auto text-gray-400 mb-2' }),
                                    React.createElement('p', { className: 'text-sm text-gray-600' }, "Glissez vos documents ici"),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, "PDF, Word, Excel")
                                )
                            ),
                            formData.documents.length > 0 && React.createElement('div', { className: "mt-2 space-y-2" },
                                formData.documents.map(file =>
                                    React.createElement(FilePreview, {
                                        key: file.id,
                                        file: file,
                                        onRemove: (f) => removeFile(f, 'documents')
                                    })
                                )
                            )
                        ),

                        // Photos
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Photos du projet"),
                            React.createElement(DropZone, {
                                onFilesAdded: (files) => handleFilesAdded(files, 'photos'),
                                acceptedTypes: ['image/*'],
                                className: formData.photos.length > 0 ? 'has-files' : ''
                            },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement(Icon, { name: 'camera', size: 32, className: 'mx-auto text-gray-400 mb-2' }),
                                    React.createElement('p', { className: 'text-sm text-gray-600' }, "Glissez vos photos ici"),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, "JPG, PNG, GIF")
                                )
                            ),
                            formData.photos.length > 0 && React.createElement('div', { className: "mt-2" },
                                React.createElement(PhotoCarousel, {
                                    photos: formData.photos,
                                    className: "h-32"
                                })
                            )
                        )
                    ),

                    // Boutons d'action
                    React.createElement('div', { className: "flex justify-between pt-6 border-t" },
                        React.createElement('div', { className: "flex gap-2" },
                            job && peutModifier && React.createElement('button', {
                                type: "button",
                                onClick: () => {
                                    if (window.confirm('√ätes-vous s√ªr de vouloir supprimer ce job ?')) {
                                        onDelete(job.id);
                                        addNotification('Job supprim√© avec succ√®s', 'success');
                                        onClose();
                                    }
                                },
                                className: "flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                            },
                                React.createElement(Icon, { name: 'trash', size: 16 }),
                                "Supprimer"
                            ),
                            !peutModifier && React.createElement('div', { className: "flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-lg border" },
                                React.createElement(Icon, { name: 'eye', size: 16 }),
                                "Mode consultation seulement"
                            )
                        ),
                        React.createElement('div', { className: "flex gap-3" },
                            React.createElement('button', {
                                type: "button",
                                onClick: printFullEvent,
                                className: "flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 border border-gray-300",
                                title: "Imprimer l'√©v√©nement complet"
                            },
                                React.createElement('span', null, "üñ®Ô∏è"),
                                React.createElement('span', { className: "hidden sm:inline" }, "Imprimer")
                            ),
                            React.createElement('button', {
                                type: "button",
                                onClick: onClose,
                                className: "px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                            }, "Annuler"),
                            peutModifier ? React.createElement('button', {
                                type: "submit",
                                disabled: job && modificationMode === 'individuel' && !ressourceIndividuelle,
                                className: `flex items-center gap-2 px-6 py-2 rounded-lg ${
                                    job && modificationMode === 'individuel' && !ressourceIndividuelle 
                                        ? 'bg-gray-400 text-gray-700 cursor-not-allowed' 
                                        : 'bg-blue-500 text-white hover:bg-blue-600'
                                }`
                            },
                                React.createElement(Icon, { name: 'save', size: 16 }),
                                job ? (modificationMode === 'individuel' && ressourceIndividuelle ? 
                                    `Cr√©er planning pour ${
                                        typeRessourceIndividuelle === 'personnel' 
                                            ? personnel.find(p => p.id === ressourceIndividuelle)?.nom?.split(' ')[0]
                                            : equipements.find(e => e.id === ressourceIndividuelle)?.nom?.split(' ')[0]
                                    }` : 
                                    modificationMode === 'individuel' ? "S√©lectionner une ressource" : "Modifier") : "Cr√©er"
                            ) : React.createElement('button', {
                                type: "button",
                                disabled: true,
                                className: "flex items-center gap-2 px-6 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed"
                            },
                                React.createElement(Icon, { name: 'eye', size: 16 }),
                                "Consultation seulement"
                            )
                        )
                    )
                ) : // Onglet Gantt
                React.createElement('div', {
                    className: `p-6 ${ganttFullscreen ? 'fixed inset-0 z-50 bg-white' : ''}`,
                    onDoubleClick: () => setGanttFullscreen(!ganttFullscreen)
                },
                    // En-t√™te Gantt avec contr√¥les
                    React.createElement('div', { className: "flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6" },
                        React.createElement('div', null,
                            React.createElement('h3', { className: `font-semibold ${ganttFullscreen ? 'text-2xl' : 'text-lg'}` }, "üìä Diagramme de Gantt"),
                            ganttData.tasks.length > 0 && React.createElement('p', { className: "text-sm text-gray-600 mt-1" },
                                `${ganttData.tasks.length} t√¢che${ganttData.tasks.length > 1 ? 's' : ''} ‚Ä¢ ${formData.dureePreviewHours}h total`
                            )
                        ),
                        React.createElement('div', { className: "flex flex-wrap items-center gap-3" },
                            React.createElement('select', {
                                value: ganttData.mode,
                                onChange: (e) => setGanttData(prev => ({ ...prev, mode: e.target.value })),
                                className: "px-3 py-1 border rounded text-sm"
                            },
                                React.createElement('option', { value: 'global' }, "Assignation globale"),
                                React.createElement('option', { value: 'individuel' }, "Assignation individuelle")
                            ),
                            React.createElement('button', {
                                onClick: printGantt,
                                className: "flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm",
                                title: "Imprimer le Gantt"
                            },
                                React.createElement('span', null, "üñ®Ô∏è"),
                                ganttFullscreen && "Imprimer"
                            ),
                            ganttFullscreen && React.createElement('button', {
                                onClick: () => setGanttFullscreen(false),
                                className: "px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm"
                            }, "Quitter plein √©cran"),
                            !ganttFullscreen && React.createElement('span', { className: "text-xs text-gray-400" }, "Double-clic pour plein √©cran")
                        )
                    ),
                    
                    // Contenu Gantt
                    ganttData.tasks.length === 0 ? 
                        React.createElement('div', { className: "text-center py-12 text-gray-500" },
                            React.createElement('p', { className: "text-gray-500" }, "Ajoutez des √©tapes et une dur√©e dans le formulaire pour g√©n√©rer le Gantt")
                        ) :
                        React.createElement('div', { 
                            className: `overflow-auto ${ganttFullscreen ? 'max-h-[calc(100vh-200px)]' : 'max-h-96'}` 
                        },
                            // V6.5 ULTRA: Timeline visuel interactif (surpasse MS Project)
                            React.createElement('div', { 
                                id: "ultra-timeline-container",
                                className: "relative bg-white border rounded-lg p-4 mb-4",
                                style: { minHeight: '400px' }
                            },
                                React.createElement('div', { className: "flex justify-between items-center mb-4" },
                                    React.createElement('h3', { className: "text-lg font-bold text-gray-800" }, "üìä Timeline Interactif Ultra-Avanc√©"),
                                    React.createElement('div', { className: "flex gap-2 text-xs" },
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement('div', { className: "w-3 h-3 bg-red-500 rounded" }),
                                            React.createElement('span', null, "Chemin critique")
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement('div', { className: "w-3 h-3 bg-blue-500 rounded" }),
                                            React.createElement('span', null, "T√¢ches normales")
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement('div', { className: "w-3 h-3 bg-green-500 rounded" }),
                                            React.createElement('span', null, "Termin√©es")
                                        )
                                    )
                                ),
                                
                                // Timeline principal avec barres draggables
                                React.createElement('div', { 
                                    className: "relative",
                                    style: { 
                                        background: 'linear-gradient(90deg, #f8f9fa 0%, #ffffff 50%, #f8f9fa 100%)',
                                        minHeight: '300px',
                                        position: 'relative'
                                    }
                                },
                                    // Grille de temps en arri√®re-plan
                                    React.createElement('svg', {
                                        className: "absolute inset-0 w-full h-full pointer-events-none",
                                        style: { zIndex: 1 }
                                    },
                                        // Lignes verticales pour les jours
                                        ...Array.from({ length: 30 }, (_, i) => 
                                            React.createElement('line', {
                                                key: `vline-${i}`,
                                                x1: `${(i + 1) * (100 / 30)}%`,
                                                y1: '0%',
                                                x2: `${(i + 1) * (100 / 30)}%`,
                                                y2: '100%',
                                                stroke: i % 7 === 0 ? '#e2e8f0' : '#f1f5f9',
                                                strokeWidth: i % 7 === 0 ? '2' : '1'
                                            })
                                        ),
                                        // Lignes horizontales
                                        ...Array.from({ length: ganttData.tasks.length + 1 }, (_, i) => 
                                            React.createElement('line', {
                                                key: `hline-${i}`,
                                                x1: '0%',
                                                y1: `${(i) * (100 / (ganttData.tasks.length + 1))}%`,
                                                x2: '100%',
                                                y2: `${(i) * (100 / (ganttData.tasks.length + 1))}%`,
                                                stroke: '#f1f5f9',
                                                strokeWidth: '1'
                                            })
                                        )
                                    ),
                                    
                                    // Barres de t√¢ches avec information riche
                                    ...ganttData.tasks.map((task, index) => {
                                        const startDate = new Date(task.startDate);
                                        const endDate = new Date(task.endDate);
                                        const projectStart = new Date(formData.dateDebut);
                                        const projectEnd = new Date(formData.dateFin);
                                        
                                        const totalDuration = projectEnd - projectStart;
                                        const taskStart = startDate - projectStart;
                                        const taskDuration = endDate - startDate;
                                        
                                        const leftPercent = (taskStart / totalDuration) * 100;
                                        const widthPercent = (taskDuration / totalDuration) * 100;
                                        const topPercent = (index / ganttData.tasks.length) * 80 + 10;
                                        
                                        const isCritical = ganttData.tasks && calculateCriticalPath(ganttData.tasks).includes(task.id);
                                        const isCompleted = task.completed;
                                        
                                        return React.createElement('div', { 
                                            key: task.id,
                                            className: "absolute transition-all duration-300 hover:z-20 cursor-move group",
                                            style: {
                                                left: `${Math.max(0, leftPercent)}%`,
                                                width: `${Math.max(2, widthPercent)}%`,
                                                top: `${topPercent}%`,
                                                height: '6%',
                                                zIndex: 10
                                            },
                                            title: `${task.name}\nD√©but: ${startDate.toLocaleDateString()}\nFin: ${endDate.toLocaleDateString()}\nDur√©e: ${task.duration}h`
                                        },
                                            // Barre principale de la t√¢che
                                            React.createElement('div', {
                                                className: `h-full rounded-lg shadow-md border-2 flex items-center px-2 text-white text-xs font-medium group-hover:shadow-xl transition-all ${
                                                    isCompleted ? 'bg-green-500 border-green-400' :
                                                    isCritical ? 'bg-red-500 border-red-400' :
                                                    'bg-blue-500 border-blue-400'
                                                }`,
                                                style: {
                                                    background: isCompleted ? 
                                                        'linear-gradient(135deg, #10b981, #059669)' :
                                                        isCritical ? 
                                                        'linear-gradient(135deg, #ef4444, #dc2626)' :
                                                        'linear-gradient(135deg, #3b82f6, #1d4ed8)'
                                                }
                                            },
                                                React.createElement('span', { 
                                                    className: "truncate",
                                                    style: { 
                                                        fontSize: widthPercent < 10 ? '10px' : '12px',
                                                        textShadow: '0 1px 2px rgba(0,0,0,0.5)'
                                                    }
                                                }, task.name),
                                                
                                                // Indicateurs de progression
                                                isCompleted && React.createElement('span', { className: "ml-1 text-xs" }, "‚úì"),
                                                isCritical && !isCompleted && React.createElement('span', { className: "ml-1 text-xs animate-pulse" }, "‚ö°")
                                            ),
                                            
                                            // Info-bulle d√©taill√©e au survol
                                            React.createElement('div', {
                                                className: "absolute bottom-full left-0 mb-2 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-30 whitespace-nowrap",
                                                style: { minWidth: '200px' }
                                            },
                                                React.createElement('div', { className: "font-bold border-b border-gray-600 pb-1 mb-2" }, task.name),
                                                React.createElement('div', null, `üìÖ D√©but: ${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString()}`),
                                                React.createElement('div', null, `üìÖ Fin: ${endDate.toLocaleDateString()} ${endDate.toLocaleTimeString()}`),
                                                React.createElement('div', null, `‚è±Ô∏è Dur√©e: ${task.duration}h`),
                                                React.createElement('div', null, `üî• Priorit√©: ${task.priority || 'normale'}`),
                                                task.dependencies && task.dependencies.length > 0 && 
                                                    React.createElement('div', null, `üîó D√©pendances: ${task.dependencies.length}`),
                                                isCritical && React.createElement('div', { className: "text-red-400 font-bold mt-1" }, "‚ö†Ô∏è CHEMIN CRITIQUE"),
                                                isCompleted && React.createElement('div', { className: "text-green-400 font-bold mt-1" }, "‚úÖ TERMIN√â")
                                            )
                                        );
                                    }),
                                    
                                    // Fl√®ches de d√©pendance
                                    React.createElement('svg', {
                                        className: "absolute inset-0 w-full h-full pointer-events-none",
                                        style: { zIndex: 15 }
                                    },
                                        ...ganttData.tasks.flatMap((task, taskIndex) => {
                                            if (!task.dependencies || task.dependencies.length === 0) return [];
                                            
                                            return task.dependencies.map(depIndex => {
                                                const depTask = ganttData.tasks.find(t => t.originalIndex === depIndex);
                                                if (!depTask) return null;
                                                
                                                const depTaskIndex = ganttData.tasks.indexOf(depTask);
                                                const projectStart = new Date(formData.dateDebut);
                                                const projectEnd = new Date(formData.dateFin);
                                                const totalDuration = projectEnd - projectStart;
                                                
                                                // Position de la t√¢che pr√©d√©cesseur
                                                const depEndDate = new Date(depTask.endDate);
                                                const depX = ((depEndDate - projectStart) / totalDuration) * 100;
                                                const depY = (depTaskIndex / ganttData.tasks.length) * 80 + 13;
                                                
                                                // Position de la t√¢che actuelle
                                                const taskStartDate = new Date(task.startDate);
                                                const taskX = ((taskStartDate - projectStart) / totalDuration) * 100;
                                                const taskY = (taskIndex / ganttData.tasks.length) * 80 + 13;
                                                
                                                const criticalTasks = ganttData.tasks ? calculateCriticalPath(ganttData.tasks) : [];
                                                const isCriticalPath = criticalTasks.includes(task.id) && criticalTasks.includes(depTask.id);
                                                
                                                return React.createElement('g', { key: `arrow-${depTask.id}-${task.id}` },
                                                    // Ligne de connexion
                                                    React.createElement('path', {
                                                        d: `M ${depX}% ${depY}% Q ${(depX + taskX) / 2}% ${(depY + taskY) / 2 - 5}% ${taskX}% ${taskY}%`,
                                                        stroke: isCriticalPath ? '#ef4444' : '#6b7280',
                                                        strokeWidth: isCriticalPath ? '3' : '2',
                                                        fill: 'none',
                                                        markerEnd: 'url(#arrowhead)',
                                                        className: 'drop-shadow-sm'
                                                    }),
                                                    
                                                    // Type de d√©pendance
                                                    React.createElement('text', {
                                                        x: `${(depX + taskX) / 2}%`,
                                                        y: `${(depY + taskY) / 2 - 7}%`,
                                                        fontSize: '10',
                                                        fill: isCriticalPath ? '#ef4444' : '#6b7280',
                                                        textAnchor: 'middle',
                                                        className: 'font-bold'
                                                    }, task.dependencyType || 'FS')
                                                );
                                            }).filter(Boolean);
                                        }),
                                        
                                        // D√©finition des marqueurs de fl√®ches
                                        React.createElement('defs', null,
                                            React.createElement('marker', {
                                                id: 'arrowhead',
                                                markerWidth: 10,
                                                markerHeight: 7,
                                                refX: 9,
                                                refY: 3.5,
                                                orient: 'auto'
                                            },
                                                React.createElement('polygon', {
                                                    points: '0 0, 10 3.5, 0 7',
                                                    fill: '#6b7280'
                                                })
                                            )
                                        )
                                    ),
                                    
                                    // Labels des t√¢ches sur la gauche
                                    React.createElement('div', {
                                        className: "absolute left-0 top-0 w-48 h-full bg-gray-50 border-r-2 border-gray-200 overflow-y-auto",
                                        style: { zIndex: 20 }
                                    },
                                        React.createElement('div', { className: "sticky top-0 bg-gray-100 p-2 border-b font-bold text-center" }, "T√¢ches"),
                                        ...ganttData.tasks.map((task, index) => 
                                            React.createElement('div', {
                                                key: `label-${task.id}`,
                                                className: `p-2 border-b text-sm hover:bg-blue-50 cursor-pointer ${
                                                    ganttData.tasks && calculateCriticalPath(ganttData.tasks).includes(task.id) ? 'bg-red-50 border-red-200' : ''
                                                }`,
                                                style: {
                                                    height: `${80 / ganttData.tasks.length}%`,
                                                    minHeight: '40px'
                                                },
                                                title: task.name
                                            },
                                                React.createElement('div', { className: "font-medium truncate" }, `${index + 1}. ${task.name}`),
                                                React.createElement('div', { className: "text-xs text-gray-600 mt-1" },
                                                    `${task.duration}h ‚Ä¢ ${task.priority || 'normale'}`
                                                ),
                                                task.dependencies && task.dependencies.length > 0 &&
                                                    React.createElement('div', { className: "text-xs text-blue-600 mt-1" },
                                                        `Apr√®s: ${task.dependencies.map(d => d + 1).join(', ')}`
                                                    )
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Tableau Gantt classique (optionnel/legacy)
                            React.createElement('table', { className: "w-full border-collapse text-sm" },
                                React.createElement('thead', null,
                                    React.createElement('tr', { className: "bg-gray-50" },
                                        React.createElement('th', { className: "border p-2 text-left w-1/4" }, "T√¢che"),
                                        React.createElement('th', { className: "border p-2 text-center w-24" }, "D√©but"),
                                        React.createElement('th', { className: "border p-2 text-center w-24" }, "Fin"),
                                        React.createElement('th', { className: "border p-2 text-center w-16" }, "Dur√©e"),
                                        React.createElement('th', { className: "border p-2 text-left" }, "Ressources"),
                                        React.createElement('th', { className: "border p-2 text-center w-32" }, "Statut")
                                    )
                                ),
                                React.createElement('tbody', null,
                                    ganttData.tasks.map((task, index) => {
                                        const taskAssignments = ganttData.assignments.filter(a => a.taskId === task.id);
                                        const startDate = new Date(task.startDate);
                                        const endDate = new Date(task.endDate);
                                        
                                        return React.createElement('tr', {
                                            key: task.id,
                                            className: `hover:bg-gray-50 ${task.completed ? 'bg-green-50' : ''}`,
                                            draggable: true,
                                            onDragStart: (e) => e.dataTransfer.setData('text/json', JSON.stringify({
                                                type: 'gantt-task',
                                                taskIndex: index
                                            })),
                                            onDragOver: (e) => e.preventDefault(),
                                            onDrop: (e) => {
                                                e.preventDefault();
                                                const dragData = JSON.parse(e.dataTransfer.getData('text/json'));
                                                if (dragData.type === 'gantt-task' && dragData.taskIndex !== index) {
                                                    const newTasks = [...ganttData.tasks];
                                                    const [draggedTask] = newTasks.splice(dragData.taskIndex, 1);
                                                    newTasks.splice(index, 0, draggedTask);
                                                    setGanttData(prev => ({
                                                        ...prev,
                                                        tasks: redistributeTaskDates(newTasks, formData)
                                                    }));
                                                }
                                            }
                                        },
                                            React.createElement('td', { className: "border p-2" },
                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            const updatedTasks = ganttData.tasks.map(t => 
                                                                t.id === task.id ? { ...t, completed: !t.completed } : t
                                                            );
                                                            setGanttData(prev => ({ ...prev, tasks: updatedTasks }));
                                                        },
                                                        className: `w-4 h-4 border-2 rounded ${task.completed ? 'bg-green-500 border-green-500' : 'border-gray-300'}`
                                                    }),
                                                    React.createElement('span', { 
                                                        className: task.completed ? 'line-through text-gray-500' : '' 
                                                    }, task.name)
                                                )
                                            ),
                                            React.createElement('td', { className: "border p-2 text-center text-xs" },
                                                startDate.toLocaleDateString('fr-FR', { month: 'short', day: 'numeric' }),
                                                React.createElement('br'),
                                                startDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})
                                            ),
                                            React.createElement('td', { className: "border p-2 text-center text-xs" },
                                                endDate.toLocaleDateString('fr-FR', { month: 'short', day: 'numeric' }),
                                                React.createElement('br'),
                                                endDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})
                                            ),
                                            React.createElement('td', { className: "border p-2 text-center" },
                                                `${task.duration.toFixed(1)}h`
                                            ),
                                            React.createElement('td', { className: "border p-2" },
                                                React.createElement('div', { className: "flex flex-wrap gap-1" },
                                                    taskAssignments.map(assignment => 
                                                        React.createElement('span', {
                                                            key: assignment.resourceId,
                                                            className: "inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs"
                                                        },
                                                            assignment.resourceType === 'personnel' ? 'üë§' : 'üîß',
                                                            assignment.resourceName
                                                        )
                                                    )
                                                )
                                            ),
                                            React.createElement('td', { className: "border p-2 text-center" },
                                                React.createElement('span', {
                                                    className: `px-2 py-1 rounded-full text-xs ${
                                                        task.completed ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                                    }`
                                                }, task.completed ? 'Termin√©' : 'En cours')
                                            )
                                        );
                                    })
                                )
                            )
                        )
                )
            );
        };

        // ============== MODAL GESTION RESSOURCES ==============
        
        const ResourceManagementModal = ({ 
            isOpen, 
            onClose, 
            personnel, 
            setPersonnel, 
            equipements, 
            setEquipements,
            typesEquipements,
            addTypeEquipement,
            addNotification,
            demandesConges,
            setDemandesConges,
            showCongesModal,
            setShowCongesModal,
            selectedPersonnelConges,
            setSelectedPersonnelConges,
            handleSaveConges,
            handleDeleteConges
        }) => {
            const [activeTab, setActiveTab] = useState('personnel');
            const [showPersonnelModal, setShowPersonnelModal] = useState(false);
            const [showEquipementModal, setShowEquipementModal] = useState(false);
            const [editingPersonnel, setEditingPersonnel] = useState(null);
            const [editingEquipement, setEditingEquipement] = useState(null);

            const handleSavePersonnel = (personData) => {
                if (editingPersonnel) {
                    setPersonnel(personnel.map(p => p.id === editingPersonnel.id ? personData : p));
                    addNotification('Personnel modifi√© avec succ√®s', 'success');
                } else {
                    setPersonnel([...personnel, personData]);
                    addNotification('Personnel ajout√© avec succ√®s', 'success');
                }
                setEditingPersonnel(null);
            };

            const handleDeletePersonnel = (id) => {
                if (window.confirm('√ätes-vous s√ªr de vouloir supprimer ce personnel ?')) {
                    setPersonnel(personnel.filter(p => p.id !== id));
                    addNotification('Personnel supprim√© avec succ√®s', 'success');
                }
            };

            const handleSaveEquipement = (equipData) => {
                if (editingEquipement) {
                    setEquipements(equipements.map(e => e.id === editingEquipement.id ? equipData : e));
                    addNotification('√âquipement modifi√© avec succ√®s', 'success');
                } else {
                    setEquipements([...equipements, equipData]);
                    addNotification('√âquipement ajout√© avec succ√®s', 'success');
                }
                setEditingEquipement(null);
            };

            const handleDeleteEquipement = (id) => {
                if (window.confirm('√ätes-vous s√ªr de vouloir supprimer cet √©quipement ?')) {
                    setEquipements(equipements.filter(e => e.id !== id));
                    addNotification('√âquipement supprim√© avec succ√®s', 'success');
                }
            };

            return React.createElement(Modal, {
                isOpen,
                onClose,
                title: 'Gestion des Ressources',
                size: 'xl'
            },
                React.createElement('div', { className: "p-6" },
                    // Tabs
                    React.createElement('div', { className: "flex border-b mb-6" },
                        React.createElement('button', {
                            onClick: () => setActiveTab('personnel'),
                            className: `px-4 py-2 font-medium ${activeTab === 'personnel' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'}`
                        }, "Personnel"),
                        React.createElement('button', {
                            onClick: () => setActiveTab('equipements'),
                            className: `px-4 py-2 font-medium ${activeTab === 'equipements' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'}`
                        }, "√âquipements")
                    ),

                    // Personnel Tab
                    activeTab === 'personnel' && React.createElement('div', null,
                        React.createElement('div', { className: "flex justify-between items-center mb-4" },
                            React.createElement('h3', { className: "text-lg font-semibold" }, `Personnel (${personnel.length})`),
                            React.createElement('button', {
                                onClick: () => {
                                    setEditingPersonnel(null);
                                    setShowPersonnelModal(true);
                                },
                                className: "flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                            },
                                React.createElement(Icon, { name: 'userPlus', size: 16 }),
                                "Ajouter"
                            )
                        ),
                        React.createElement('div', { className: "space-y-2 max-h-96 overflow-y-auto" },
                            ...personnel.map(person => 
                                React.createElement('div', {
                                    key: person.id,
                                    className: "flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50"
                                },
                                    React.createElement('div', { className: "flex-1" },
                                        React.createElement('div', { className: "font-medium" }, person.nom),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, `${person.poste} - ${person.succursale}`),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, `${person.email} ‚Ä¢ ${person.telephone}`)
                                    ),
                                    React.createElement('div', { className: "flex items-center gap-2" },
                                        React.createElement('div', {
                                            className: `px-2 py-1 rounded text-xs ${person.disponible ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`
                                        }, person.disponible ? 'Disponible' : 'Occup√©'),
                                        React.createElement('button', {
                                            onClick: () => {
                                                setEditingPersonnel(person);
                                                setShowPersonnelModal(true);
                                            },
                                            className: "p-1 hover:bg-blue-100 rounded"
                                        }, React.createElement(Icon, { name: 'edit', size: 16 })),
                                        React.createElement('button', {
                                            onClick: () => handleDeletePersonnel(person.id),
                                            className: "p-1 hover:bg-red-100 rounded text-red-600"
                                        }, React.createElement(Icon, { name: 'trash', size: 16 }))
                                    )
                                )
                            )
                        )
                    ),

                    // √âquipements Tab
                    activeTab === 'equipements' && React.createElement('div', null,
                        React.createElement('div', { className: "flex justify-between items-center mb-4" },
                            React.createElement('h3', { className: "text-lg font-semibold" }, `√âquipements (${equipements.length})`),
                            React.createElement('button', {
                                onClick: () => {
                                    setEditingEquipement(null);
                                    setShowEquipementModal(true);
                                },
                                className: "flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                            },
                                React.createElement(Icon, { name: 'plus', size: 16 }),
                                "Ajouter"
                            )
                        ),
                        React.createElement('div', { className: "space-y-2 max-h-96 overflow-y-auto" },
                            ...equipements.map(equipement => 
                                React.createElement('div', {
                                    key: equipement.id,
                                    className: "flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50"
                                },
                                    React.createElement('div', { className: "flex-1" },
                                        React.createElement('div', { className: "font-medium" }, equipement.nom),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, `${equipement.type} - ${equipement.succursale}`),
                                        React.createElement('div', { className: "text-xs text-gray-500" }, `S√©rie: ${equipement.numeroSerie} ‚Ä¢ Maintenance: ${equipement.derniereMaintenance}`)
                                    ),
                                    React.createElement('div', { className: "flex items-center gap-2" },
                                        React.createElement('div', {
                                            className: `px-2 py-1 rounded text-xs ${equipement.disponible ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`
                                        }, equipement.disponible ? 'Disponible' : 'En utilisation'),
                                        React.createElement('button', {
                                            onClick: () => {
                                                setEditingEquipement(equipement);
                                                setShowEquipementModal(true);
                                            },
                                            className: "p-1 hover:bg-blue-100 rounded"
                                        }, React.createElement(Icon, { name: 'edit', size: 16 })),
                                        React.createElement('button', {
                                            onClick: () => handleDeleteEquipement(equipement.id),
                                            className: "p-1 hover:bg-red-100 rounded text-red-600"
                                        }, React.createElement(Icon, { name: 'trash', size: 16 }))
                                    )
                                )
                            )
                        )
                    )
                ),

                // Modals int√©gr√©es
                React.createElement(PersonnelModal, {
                    isOpen: showPersonnelModal,
                    onClose: () => setShowPersonnelModal(false),
                    onSave: handleSavePersonnel,
                    personnel: editingPersonnel
                }),

                React.createElement(EquipementModal, {
                    isOpen: showEquipementModal,
                    onClose: () => setShowEquipementModal(false),
                    onSave: handleSaveEquipement,
                    equipement: editingEquipement,
                    typesEquipements,
                    addTypeEquipement
                }),

                React.createElement(CongesModal, {
                    isOpen: showCongesModal,
                    onClose: () => setShowCongesModal(false),
                    onSave: handleSaveConges,
                    personnel: selectedPersonnelConges,
                    allPersonnel: personnel
                })
            );
        };

        // ============== COMPOSANT GOOGLE DRIVE ==============

        const GoogleDriveButton = ({ googleDrive, forceSync, notifications }) => {
            const [showDetails, setShowDetails] = useState(false);

            const formatLastSync = (date) => {
                if (!date) return 'Jamais';
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return '√Ä l\'instant';
                if (diffMins < 60) return `Il y a ${diffMins} min`;
                if (diffMins < 1440) return `Il y a ${Math.floor(diffMins / 60)}h`;
                return date.toLocaleDateString();
            };

            const handleSync = async () => {
                try {
                    await forceSync();
                    if (notifications?.addNotification) {
                        notifications.addNotification('‚úÖ Synchronisation Google Drive r√©ussie', 'success');
                    }
                } catch (error) {
                    if (notifications?.addNotification) {
                        notifications.addNotification('‚ùå Erreur de synchronisation', 'error');
                    }
                }
            };

            const getStatusIcon = () => {
                if (googleDrive.isSyncing) return 'üîÑ';
                if (googleDrive.error) return '‚ö†Ô∏è';
                if (googleDrive.isAuthenticated) return '‚òÅÔ∏è';
                return 'üì°';
            };

            const getStatusText = () => {
                if (googleDrive.isSyncing) return 'Synchronisation...';
                if (googleDrive.error) return googleDrive.error;
                if (googleDrive.isAuthenticated) return 'Connect√©';
                return 'Non connect√©';
            };

            const getStatusColor = () => {
                if (googleDrive.isSyncing) return 'text-blue-600';
                if (googleDrive.error) return 'text-red-600';
                if (googleDrive.isAuthenticated) return 'text-green-600';
                return 'text-gray-600';
            };

            return React.createElement('div', { className: 'relative' },
                React.createElement('button', {
                    onClick: () => setShowDetails(!showDetails),
                    className: `flex items-center gap-2 px-3 py-2 rounded-lg border transition-all ${
                        googleDrive.isAuthenticated 
                            ? 'bg-green-50 border-green-200 hover:bg-green-100' 
                            : 'bg-gray-50 border-gray-200 hover:bg-gray-100'
                    }`,
                    title: `Google Drive - ${getStatusText()}`
                },
                    React.createElement('span', { className: 'text-lg' }, getStatusIcon()),
                    React.createElement('div', { className: 'flex flex-col items-start' },
                        React.createElement('span', { className: 'text-sm font-medium' }, 'Google Drive'),
                        React.createElement('span', { className: `text-xs ${getStatusColor()}` }, getStatusText())
                    )
                ),

                // Menu d√©roulant d√©taill√©
                showDetails && React.createElement('div', {
                    className: 'absolute top-full right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-xl z-50'
                },
                    React.createElement('div', { className: 'p-4' },
                        // En-t√™te
                        React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                            React.createElement('h3', { className: 'font-semibold text-gray-800' }, '‚òÅÔ∏è Google Drive'),
                            React.createElement('button', {
                                onClick: () => setShowDetails(false),
                                className: 'text-gray-400 hover:text-gray-600'
                            }, '‚úï')
                        ),

                        // √âtat de connexion
                        React.createElement('div', { className: 'mb-4 p-3 bg-gray-50 rounded-lg' },
                            React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                                React.createElement('span', { className: 'text-sm text-gray-600' }, '√âtat:'),
                                React.createElement('span', { className: `text-sm font-medium ${getStatusColor()}` }, 
                                    getStatusText()
                                )
                            ),
                            googleDrive.lastSync && React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('span', { className: 'text-sm text-gray-600' }, 'Derni√®re sync:'),
                                React.createElement('span', { className: 'text-sm' }, formatLastSync(googleDrive.lastSync))
                            )
                        ),

                        // Actions
                        React.createElement('div', { className: 'space-y-2' },
                            !googleDrive.isAuthenticated 
                                ? React.createElement('button', {
                                    onClick: googleDrive.signIn,
                                    disabled: !googleDrive.isInitialized,
                                    className: 'w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed'
                                }, 'üîê Se connecter √† Google Drive')
                                : React.createElement('div', { className: 'space-y-2' },
                                    React.createElement('button', {
                                        onClick: handleSync,
                                        disabled: googleDrive.isSyncing,
                                        className: 'w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed'
                                    }, googleDrive.isSyncing ? '‚è≥ Synchronisation...' : 'üîÑ Synchroniser maintenant'),
                                    
                                    React.createElement('button', {
                                        onClick: googleDrive.signOut,
                                        className: 'w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700'
                                    }, 'üö™ Se d√©connecter')
                                )
                        ),

                        // Informations
                        React.createElement('div', { className: 'mt-4 pt-3 border-t border-gray-200 text-xs text-gray-500' },
                            React.createElement('p', { className: 'mb-1' }, '‚Ä¢ Sauvegarde automatique apr√®s 2s d\'inactivit√©'),
                            React.createElement('p', { className: 'mb-1' }, '‚Ä¢ Synchronisation entre tous vos appareils'),
                            React.createElement('p', null, '‚Ä¢ LocalStorage utilis√© comme backup')
                        )
                    )
                )
            );
        };

        // ============== COMPOSANT PRINCIPAL ==============
        
        const PlanificateurFinal = () => {
            const {
                jobs, setJobs,
                personnel, setPersonnel,
                equipements, setEquipements,
                sousTraitants, setSousTraitants, addSousTraitant,
                typesEquipements, addTypeEquipement,
                demandesConges, setDemandesConges,
                modeTheme, setModeTheme,
                googleDrive, // Service Google Drive
                forceSync    // Fonction de synchronisation manuelle
            } = useAppDataWithSync(); // Utiliser le hook avec synchronisation

            const { isMobile, isTablet } = useScreenSize();
            const { notifications, addNotification } = useNotifications();
            
            const [showJobModal, setShowJobModal] = useState(false);
            const [showResourceModal, setShowResourceModal] = useState(false);
            const [selectedJob, setSelectedJob] = useState(null);
            const [selectedCell, setSelectedCell] = useState(null);
            const [startDate, setStartDate] = useState(new Date(2025, 8, 1));
            const [numberOfDays, setNumberOfDays] = useState(isMobile ? 14 : 30);
            
            // √âtats PWA
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showInstallButton, setShowInstallButton] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterBureau, setFilterBureau] = useState('tous');
            const [filterType, setFilterType] = useState('personnel'); // 'personnel', 'equipements' ou 'global'
            const [showDateNavigator, setShowDateNavigator] = useState(false);
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [showMobileMenu, setShowMobileMenu] = useState(false); // √âtat menu hamburger
            
            // √âtats d'authentification utilisateur
            const [utilisateurConnecte, setUtilisateurConnecte] = useState(null);
            const [showUserLogin, setShowUserLogin] = useState(true);
            const [loginForm, setLoginForm] = useState({ nom: '', motDePasse: '' });
            const [modeVueIndividuel, setModeVueIndividuel] = useState(false);
            const [travailleurSelectionne, setTravailleurSelectionne] = useState('');
            const [showCongesModal, setShowCongesModal] = useState(false);
            const [selectedPersonnelConges, setSelectedPersonnelConges] = useState(null);
            
            // Authentification admin
            const handleAdminLogin = () => {
                if (adminPassword === 'MdlAdm321!$') {
                    setIsAdminAuthenticated(true);
                    setShowAdminLogin(false);
                    setAdminPassword('');
                    addNotification('Connexion admin r√©ussie', 'success');
                } else {
                    addNotification('Mot de passe incorrect', 'error');
                    setAdminPassword('');
                }
            };
            
            const requireAdminAuth = () => {
                if (isAdminAuthenticated) {
                    setShowResourceModal(true);
                } else {
                    setShowAdminLogin(true);
                }
            };
            
            // Authentification utilisateur
            const handleUserLogin = (utilisateurIdentifie, motDePasse) => {
                console.log('üì• R√©ception des donn√©es d\'authentification:', {
                    utilisateur: utilisateurIdentifie?.nom,
                    motDePasse: motDePasse,
                    longueurMotDePasse: motDePasse?.length,
                    typeMotDePasse: typeof motDePasse
                });
                console.log('üîê Authentification avec mot de passe pour:', utilisateurIdentifie?.nom);
                
                if (!utilisateurIdentifie) {
                    console.log('‚ùå Aucun utilisateur fourni');
                    addNotification('Erreur d\'authentification', 'error');
                    return;
                }
                
                if (!motDePasse) {
                    console.log('‚ùå Aucun mot de passe fourni');
                    addNotification('Mot de passe requis', 'error');
                    return;
                }
                
                // V√©rification du mot de passe avec logs d√©taill√©s
                console.log('üîç SIMPLE - Mot de passe BD:', utilisateurIdentifie.motDePasse);
                console.log('üîç SIMPLE - Mot de passe saisi:', motDePasse);
                console.log('üîç SIMPLE - √âgaux?', utilisateurIdentifie.motDePasse === motDePasse);
                
                console.log('üîç D√âBOGAGE CRITIQUE - D√©tails de v√©rification:', {
                    utilisateur: utilisateurIdentifie.nom,
                    motDePasseBD: `"${utilisateurIdentifie.motDePasse}"`,
                    motDePasseSaisi: `"${motDePasse}"`,
                    longueurBD: utilisateurIdentifie.motDePasse?.length,
                    longueurSaisi: motDePasse?.length,
                    egal: utilisateurIdentifie.motDePasse === motDePasse,
                    caractereParCaractereBD: utilisateurIdentifie.motDePasse?.split(''),
                    caractereParCaractereSaisi: motDePasse?.split('')
                });
                
                if (utilisateurIdentifie.motDePasse === motDePasse) {
                    console.log('‚úÖ Mot de passe correct pour:', utilisateurIdentifie.nom);
                    setUtilisateurConnecte(utilisateurIdentifie);
                    setShowUserLogin(false);
                    setLoginForm({ nom: '', motDePasse: '' });
                    addNotification(`Connexion r√©ussie - ${utilisateurIdentifie.nom}`, 'success');
                } else {
                    console.log('‚ùå Mot de passe incorrect pour:', utilisateurIdentifie.nom);
                    console.log('‚ùå Comparaison d√©taill√©e:', {
                        attendu: `"${utilisateurIdentifie.motDePasse}"`,
                        recu: `"${motDePasse}"`,
                        typeAttendu: typeof utilisateurIdentifie.motDePasse,
                        typeRecu: typeof motDePasse
                    });
                    addNotification('Mot de passe incorrect', 'error');
                    // Garder le formulaire pour permettre une nouvelle tentative
                    setLoginForm(prev => ({ ...prev, motDePasse: '' }));
                }
            };
            
            const handleUserLogout = () => {
                setUtilisateurConnecte(null);
                setShowUserLogin(true);
                addNotification('D√©connexion r√©ussie', 'success');
            };
            
            // Fonction pour v√©rifier les permissions
            const peutModifier = () => {
                if (!utilisateurConnecte) return false;
                if (!utilisateurConnecte.permissions) return false;
                return utilisateurConnecte.permissions.peutModifier === true;
            };
            
            const estCoordonnateur = () => {
                if (!utilisateurConnecte) return false;
                if (!utilisateurConnecte.permissions) return false;
                return utilisateurConnecte.permissions.estCoordonnateur === true;
            };
            
            // Filtrer le personnel visible selon le r√¥le
            const getPersonnelVisible = () => {
                if (estCoordonnateur()) {
                    // Coordonnateurs voient tout le monde
                    return personnel;
                } else {
                    // Autres voient seulement le personnel de chantier (visibleChantier: true)
                    return personnel.filter(p => p.visibleChantier);
                }
            };

            // G√©n√©rer les jours
            const generateContinuousDays = useCallback(() => {
                const days = [];
                const current = new Date(startDate);
                
                for (let i = 0; i < numberOfDays; i++) {
                    days.push({
                        date: new Date(current),
                        dayNumber: current.getDate(),
                        dayName: current.toLocaleDateString('fr-FR', { weekday: 'short' }).toUpperCase(),
                        monthName: current.toLocaleDateString('fr-FR', { month: 'short' }),
                        isWeekend: current.getDay() === 0 || current.getDay() === 6,
                        isToday: current.toDateString() === new Date().toDateString(),
                        dateString: current.toISOString().split('T')[0]
                    });
                    current.setDate(current.getDate() + 1);
                }
                
                return days;
            }, [startDate, numberOfDays]);

            const continuousDays = generateContinuousDays();

            // Filtrer le personnel ou √©quipements
            const filteredResources = useMemo(() => {
                // En mode vue individuel, respecter le filtre s√©lectionn√© (Personnel/√âquipement/Global)
                if (modeVueIndividuel && travailleurSelectionne) {
                    if (filterType === 'personnel') {
                        // Mode individuel + filtre Personnel = Voir uniquement la personne s√©lectionn√©e
                        let filteredPersonnel = personnel.filter(person => {
                            const matchesSearch = person.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                                 person.poste.toLowerCase().includes(searchTerm.toLowerCase());
                            const matchesBureau = filterBureau === 'tous' || person.succursale === filterBureau;
                            const notCoordonnateur = !person.isCoordonnateur;
                            const visibleCalendrier = person.visibleChantier === true;
                            return matchesSearch && matchesBureau && notCoordonnateur && visibleCalendrier && person.id === travailleurSelectionne;
                        });
                        return filteredPersonnel.map(p => ({...p, type: 'personnel'}));
                    } else if (filterType === 'equipements') {
                        // Mode individuel + filtre √âquipement = Voir uniquement l'√©quipement s√©lectionn√©
                        const filteredEquipements = equipements.filter(equipement => {
                            const matchesSearch = equipement.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                                 equipement.type.toLowerCase().includes(searchTerm.toLowerCase());
                            const matchesBureau = filterBureau === 'tous' || equipement.succursale === filterBureau;
                            return matchesSearch && matchesBureau && equipement.id === travailleurSelectionne;
                        });
                        return filteredEquipements.map(e => ({...e, type: 'equipement'}));
                    } else {
                        // Mode individuel + filtre Global = Voir la ressource s√©lectionn√©e + tout le reste
                        let filteredPersonnel = personnel.filter(person => {
                            const matchesSearch = person.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                                 person.poste.toLowerCase().includes(searchTerm.toLowerCase());
                            const matchesBureau = filterBureau === 'tous' || person.succursale === filterBureau;
                            const notCoordonnateur = !person.isCoordonnateur;
                            const visibleCalendrier = person.visibleChantier === true;
                            return matchesSearch && matchesBureau && notCoordonnateur && visibleCalendrier && person.id === travailleurSelectionne;
                        });
                        
                        filteredPersonnel = filteredPersonnel.map(p => ({...p, type: 'personnel'}));
                        
                        const filteredEquipements = equipements.filter(equipement => {
                            const matchesSearch = equipement.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                                 equipement.type.toLowerCase().includes(searchTerm.toLowerCase());
                            const matchesBureau = filterBureau === 'tous' || equipement.succursale === filterBureau;
                            return matchesSearch && matchesBureau;
                        }).map(e => ({...e, type: 'equipement'}));
                        
                        return [...filteredPersonnel, ...filteredEquipements];
                    }
                } else if (filterType === 'personnel') {
                    let filteredPersonnel = personnel.filter(person => {
                        const matchesSearch = person.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                             person.poste.toLowerCase().includes(searchTerm.toLowerCase());
                        const matchesBureau = filterBureau === 'tous' || person.succursale === filterBureau;
                        const notCoordonnateur = !person.isCoordonnateur;
                        const visibleCalendrier = person.visibleChantier === true;
                        return matchesSearch && matchesBureau && notCoordonnateur && visibleCalendrier;
                    });
                    
                    return filteredPersonnel.map(p => ({...p, type: 'personnel'}));
                } else if (filterType === 'equipements') {
                    return equipements.filter(equipement => {
                        const matchesSearch = equipement.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                             equipement.type.toLowerCase().includes(searchTerm.toLowerCase());
                        const matchesBureau = filterBureau === 'tous' || equipement.succursale === filterBureau;
                        return matchesSearch && matchesBureau;
                    }).map(e => ({...e, type: 'equipement'}));
                } else { // global
                    let filteredPersonnel = personnel.filter(person => {
                        const matchesSearch = person.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                             person.poste.toLowerCase().includes(searchTerm.toLowerCase());
                        const matchesBureau = filterBureau === 'tous' || person.succursale === filterBureau;
                        const notCoordonnateur = !person.isCoordonnateur;
                        const visibleCalendrier = person.visibleChantier === true;
                        return matchesSearch && matchesBureau && notCoordonnateur && visibleCalendrier;
                    });
                    
                    filteredPersonnel = filteredPersonnel.map(p => ({...p, type: 'personnel'}));
                    
                    const filteredEquipements = equipements.filter(equipement => {
                        const matchesSearch = equipement.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                             equipement.type.toLowerCase().includes(searchTerm.toLowerCase());
                        const matchesBureau = filterBureau === 'tous' || equipement.succursale === filterBureau;
                        return matchesSearch && matchesBureau;
                    }).map(e => ({...e, type: 'equipement'}));
                    
                    return [...filteredPersonnel, ...filteredEquipements];
                }
            }, [filterType, personnel, equipements, searchTerm, filterBureau, modeVueIndividuel, travailleurSelectionne]);

            // Obtenir job pour cellule
            const getJobForCell = (resourceId, day, resourceType = null) => {
                return jobs.find(job => {
                    // V√©rifier si cette ressource a un planning individuel
                    const planningIndividuel = job.planningsIndividuels?.[resourceId];
                    let dateDebut, dateFin;
                    
                    if (planningIndividuel) {
                        dateDebut = planningIndividuel.dateDebut;
                        dateFin = planningIndividuel.dateFin;
                    } else {
                        dateDebut = job.dateDebut;
                        dateFin = job.dateFin;
                    }
                    
                    let dateMatch = day.dateString >= dateDebut && day.dateString <= dateFin;
                    
                    // Si l'√©v√©nement n'inclut pas les fins de semaine, exclure samedi et dimanche
                    if (dateMatch && !job.includeWeekendsInDuration && day.isWeekend) {
                        dateMatch = false;
                    }
                    
                    if (filterType === 'personnel') {
                        return job.personnel?.includes(resourceId) && dateMatch;
                    } else if (filterType === 'equipements') {
                        return job.equipements?.includes(resourceId) && dateMatch;
                    } else { // global
                        // Utiliser le type de ressource pour d√©terminer dans quelle liste chercher
                        if (resourceType === 'personnel') {
                            return job.personnel?.includes(resourceId) && dateMatch;
                        } else if (resourceType === 'equipement') {
                            return job.equipements?.includes(resourceId) && dateMatch;
                        }
                        // Fallback : chercher dans les deux listes
                        return (job.personnel?.includes(resourceId) || job.equipements?.includes(resourceId)) && dateMatch;
                    }
                });
            };

            // V6.5 ULTRA: Obtenir TOUS les jobs/t√¢ches pour une cellule (multi-t√¢ches par jour)
            const getAllJobsForCell = (resourceId, day, resourceType = null, ganttDataParam = null) => {
                const currentGanttData = ganttDataParam || { tasks: [], assignments: [] };
                const dayJobs = [];
                
                // 1. Jobs classiques (√©v√©nements) - TOUS ceux qui matchent
                const classicJobs = jobs.filter(job => {
                    const planningIndividuel = job.planningsIndividuels?.[resourceId];
                    let dateDebut, dateFin;
                    
                    if (planningIndividuel) {
                        dateDebut = planningIndividuel.dateDebut;
                        dateFin = planningIndividuel.dateFin;
                    } else {
                        dateDebut = job.dateDebut;
                        dateFin = job.dateFin;
                    }
                    
                    let dateMatch = day.dateString >= dateDebut && day.dateString <= dateFin;
                    
                    if (dateMatch && !job.includeWeekendsInDuration && day.isWeekend) {
                        dateMatch = false;
                    }
                    
                    if (filterType === 'personnel') {
                        return job.personnel?.includes(resourceId) && dateMatch;
                    } else if (filterType === 'equipements') {
                        return job.equipements?.includes(resourceId) && dateMatch;
                    } else {
                        if (resourceType === 'personnel') {
                            return job.personnel?.includes(resourceId) && dateMatch;
                        } else if (resourceType === 'equipements') {
                            return job.equipements?.includes(resourceId) && dateMatch;
                        } else {
                            return (job.personnel?.includes(resourceId) || job.equipements?.includes(resourceId)) && dateMatch;
                        }
                    }
                });

                // 2. T√¢ches Gantt du jour (si assign√©es √† cette ressource via les √©quipes)
                const ganttTasksToday = (currentGanttData.tasks && currentGanttData.tasks.length > 0) ? currentGanttData.tasks.filter(task => {
                    const taskDate = new Date(task.startDate).toISOString().split('T')[0];
                    const dayStr = day.date || day.dateString;
                    
                    if (taskDate !== dayStr) return false;
                    
                    // V√©rifier si cette ressource est assign√©e via une √©quipe
                    const assignments = currentGanttData.assignments || [];
                    const isAssignedToTask = assignments.some(assignment => 
                        assignment.taskId === task.id && assignment.resourceId === resourceId
                    );
                    
                    return isAssignedToTask;
                }) : [];

                // Convertir les jobs classiques au format unifi√© avec cr√©neaux horaires
                classicJobs.forEach((job, index) => {
                    dayJobs.push({
                        id: `event-${job.id}`,
                        type: 'event',
                        name: job.nom,
                        numeroJob: job.numeroJob,
                        heureDebut: job.heureDebut || '08:00',
                        heureFin: job.heureFin || '17:00',
                        duration: calculateJobDuration(job.heureDebut || '08:00', job.heureFin || '17:00'),
                        priority: job.priorite || 'normale',
                        bureau: job.bureau,
                        client: job.client,
                        color: getPriorityAndBureauColor(job),
                        originalJob: job,
                        sortOrder: index
                    });
                });

                // Convertir les t√¢ches Gantt au format unifi√©
                ganttTasksToday.forEach((task, index) => {
                    const startTime = new Date(task.startDate);
                    const endTime = new Date(task.endDate);
                    
                    dayJobs.push({
                        id: `gantt-${task.id}`,
                        type: 'gantt-task',
                        name: task.name,
                        heureDebut: startTime.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}),
                        heureFin: endTime.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}),
                        duration: task.duration,
                        priority: task.priority || 'normal',
                        color: task.completed ? 'bg-green-100 border-green-300 text-green-800' : 
                               (currentGanttData.tasks && calculateCriticalPath(currentGanttData.tasks).includes(task.id)) ? 'bg-red-100 border-red-300 text-red-800' : 
                               'bg-blue-100 border-blue-300 text-blue-800',
                        originalTask: task,
                        sortOrder: 1000 + index // Gantt tasks apr√®s les √©v√©nements
                    });
                });

                // Trier par heure de d√©but, puis par ordre de priorit√©
                return dayJobs.sort((a, b) => {
                    const timeA = a.heureDebut.split(':').map(n => parseInt(n));
                    const timeB = b.heureDebut.split(':').map(n => parseInt(n));
                    const minutesA = timeA[0] * 60 + timeA[1];
                    const minutesB = timeB[0] * 60 + timeB[1];
                    
                    // Trier par heure d'abord
                    if (minutesA !== minutesB) {
                        return minutesA - minutesB;
                    }
                    
                    // En cas d'√©galit√©, par ordre de cr√©ation
                    return a.sortOrder - b.sortOrder;
                });
            };

            // Fonction utilitaire pour calculer la dur√©e d'un job en heures
            const calculateJobDuration = (heureDebut, heureFin) => {
                const [startH, startM] = heureDebut.split(':').map(n => parseInt(n));
                const [endH, endM] = heureFin.split(':').map(n => parseInt(n));
                const startMinutes = startH * 60 + startM;
                const endMinutes = endH * 60 + endM;
                return Math.max(0.25, (endMinutes - startMinutes) / 60);
            };

            // Obtenir les √©quipements assign√©s √† un job
            const getJobEquipments = (job) => {
                if (!job.equipements) return [];
                return equipements.filter(eq => job.equipements.includes(eq.id));
            };

            // Obtenir les cong√©s approuv√©s pour un personnel √† une date donn√©e
            const getCongesForPersonnel = (personnelId, date) => {
                return demandesConges.filter(conge => 
                    conge.personnelId === personnelId &&
                    conge.statut === 'approuve' &&
                    new Date(conge.dateDebut) <= new Date(date) &&
                    new Date(conge.dateFin) >= new Date(date)
                );
            };

            // === GESTION DES CONG√âS ===
            const handleSaveConges = (congesData) => {
                const existingIndex = demandesConges.findIndex(d => d.id === congesData.id);
                if (existingIndex !== -1) {
                    setDemandesConges(demandesConges.map(d => d.id === congesData.id ? congesData : d));
                    addNotification('Demande de cong√© modifi√©e avec succ√®s', 'success');
                } else {
                    setDemandesConges([...demandesConges, congesData]);
                    addNotification('Demande de cong√© cr√©√©e avec succ√®s', 'success');
                }
            };

            const handleDeleteConges = (id) => {
                if (window.confirm('√ätes-vous s√ªr de vouloir supprimer cette demande ?')) {
                    setDemandesConges(demandesConges.filter(d => d.id !== id));
                    addNotification('Demande supprim√©e avec succ√®s', 'success');
                }
            };

            // Gestionnaires d'√©v√©nements
            const handleCellClick = (resourceId, day, resourceType = null, event = null) => {
                // Si Ctrl+click sur personnel, ouvrir modal cong√©s
                if (event?.ctrlKey && resourceType === 'personnel') {
                    const personnelToSelect = personnel.find(p => p.id === resourceId);
                    setSelectedPersonnelConges(personnelToSelect);
                    setShowCongesModal(true);
                    return;
                }

                const existingJob = getJobForCell(resourceId, day, resourceType);
                
                if (existingJob) {
                    setSelectedJob(existingJob);
                } else {
                    // V√©rifier les permissions pour cr√©er un nouveau job
                    if (!peutModifier()) {
                        addNotification('Vous n\'avez pas les permissions pour cr√©er de nouveaux √©v√©nements', 'error');
                        return;
                    }
                    setSelectedJob(null);
                    if (filterType === 'personnel') {
                        setSelectedCell({ personnelId: resourceId, date: day.dateString });
                    } else {
                        setSelectedCell({ date: day.dateString });
                    }
                }
                setShowJobModal(true);
            };

            // Fonction pour g√©n√©rer les dates r√©currentes
            const genererDatesRecurrentes = (dateDebut, recurrence) => {
                const dates = [new Date(dateDebut)];
                const startDate = new Date(dateDebut);
                
                for (let i = 1; i < (recurrence.finRecurrence === 'occurrences' ? recurrence.nombreOccurrences : 50); i++) {
                    const nextDate = new Date(startDate);
                    
                    switch (recurrence.type) {
                        case 'hebdomadaire':
                            nextDate.setDate(startDate.getDate() + (i * 7 * recurrence.intervalle));
                            break;
                        case 'mensuel':
                            nextDate.setMonth(startDate.getMonth() + (i * recurrence.intervalle));
                            break;
                        case 'annuel':
                            nextDate.setFullYear(startDate.getFullYear() + (i * recurrence.intervalle));
                            break;
                    }
                    
                    // V√©rifier si on d√©passe la date de fin
                    if (recurrence.finRecurrence === 'date' && recurrence.dateFinRecurrence) {
                        const dateFin = new Date(recurrence.dateFinRecurrence);
                        if (nextDate > dateFin) break;
                    }
                    
                    dates.push(nextDate);
                }
                
                return dates;
            };

            const handleSaveJob = (jobData) => {
                if (selectedJob) {
                    setJobs(jobs.map(j => j.id === selectedJob.id ? jobData : j));
                } else {
                    // V√©rifier si c'est un √©v√©nement r√©current
                    if (jobData.recurrence && jobData.recurrence.active) {
                        const datesRecurrentes = genererDatesRecurrentes(jobData.dateDebut, jobData.recurrence);
                        const nouveauxJobs = [];
                        
                        datesRecurrentes.forEach((date, index) => {
                            const dateFin = jobData.dateFin ? new Date(jobData.dateFin) : date;
                            if (jobData.dateFin) {
                                const diff = new Date(jobData.dateFin) - new Date(jobData.dateDebut);
                                dateFin.setTime(date.getTime() + diff);
                            }
                            
                            const nouveauJob = {
                                ...jobData,
                                id: Date.now() + index + Math.random(),
                                dateDebut: date.toISOString().split('T')[0],
                                dateFin: dateFin.toISOString().split('T')[0],
                                nom: `${jobData.nom}${index > 0 ? ` (${index + 1})` : ''}`,
                                recurrence: index === 0 ? jobData.recurrence : { ...jobData.recurrence, active: false } // Seul le premier garde la config de r√©currence
                            };
                            
                            nouveauxJobs.push(nouveauJob);
                        });
                        
                        setJobs([...jobs, ...nouveauxJobs]);
                    } else {
                        setJobs([...jobs, jobData]);
                    }
                }
                setSelectedJob(null);
                setSelectedCell(null);
            };

            const handleDeleteJob = (jobId) => {
                setJobs(jobs.filter(j => j.id !== jobId));
            };

            const getPriorityAndBureauColor = (job) => {
                // Utiliser le bureau assign√© √† l'√©v√©nement ou fallback sur le bureau du personnel
                const bureauAssigne = job.bureau || (
                    job.personnel?.length > 0 
                        ? personnel.find(p => job.personnel.includes(p.id))?.succursale 
                        : ''
                );
                const bureauClass = getBureauColor(bureauAssigne);
                
                // Ajouter classes pour diff√©rents types d'horaires
                let horaireClass = '';
                if (job.typeHoraire === 'nuit') {
                    horaireClass = 'night-work';
                } else if (job.typeHoraire === '24h') {
                    horaireClass = 'work-24h';
                }
                
                const weekendClass = job.includeWeekendsInDuration ? 'includes-weekends' : '';
                
                return `${bureauClass} border-2 ${horaireClass} ${weekendClass}`.trim();
            };

            // Navigation
            const navigateWeeks = (direction) => {
                const newDate = new Date(startDate);
                newDate.setDate(newDate.getDate() + (direction * 7));
                setStartDate(newDate);
            };

            const navigateMonths = (direction) => {
                const newDate = new Date(startDate);
                newDate.setMonth(newDate.getMonth() + direction);
                setStartDate(newDate);
            };

            const goToToday = () => {
                setStartDate(new Date());
            };

            // Export des donn√©es
            const exportData = () => {
                const data = {
                    jobs,
                    personnel,
                    equipements,
                    sousTraitants,
                    typesEquipements,
                    exportDate: new Date().toISOString(),
                    version: '4.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `planificateur-final-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                addNotification('Donn√©es export√©es avec succ√®s', 'success');
            };

            // Fonctions PWA
            useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setShowInstallButton(true);
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                };
            }, []);

            const handleInstallPWA = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        addNotification('Application install√©e avec succ√®s !', 'success');
                        setShowInstallButton(false);
                    }
                    setDeferredPrompt(null);
                } else {
                    addNotification('Installation non disponible pour ce navigateur', 'info');
                }
            };

            return React.createElement('div', { 
                className: `min-h-screen bg-gray-50 transition-colors duration-300 ${modeTheme === 'nuit' ? 'theme-nuit' : ''}` 
            },
                // Notifications
                React.createElement(NotificationContainer, { notifications }),
                
                // Modal de login utilisateur
                React.createElement(UserLoginModal, {
                    isOpen: showUserLogin,
                    personnel: personnel,
                    loginForm: loginForm,
                    setLoginForm: setLoginForm,
                    onLogin: (utilisateurIdentifie, motDePasse) => handleUserLogin(utilisateurIdentifie, motDePasse),
                    onClose: () => {} // Pas de fermeture possible sans connexion
                }),

                // HEADER RESPONSIVE AVEC MENU HAMBURGER
                React.createElement('div', { className: "bg-gradient-to-r from-gray-900 to-black shadow-lg border-b border-gray-800" },
                    React.createElement('div', { className: "px-4 py-3" },
                        // BARRE PRINCIPALE COMPACTE
                        React.createElement('div', { className: "flex items-center justify-between" },
                            // Logo + Titre (toujours visible)
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('img', { 
                                    src: "C-Secur360-logo.png.png", 
                                    alt: "C-Secur360",
                                    className: isMobile ? "w-10 h-10" : "w-12 h-12 lg:w-16 lg:h-16 object-contain"
                                }),
                                React.createElement('div', null,
                                    React.createElement('h1', { 
                                        className: isMobile 
                                            ? "text-sm font-bold text-white" 
                                            : "text-lg lg:text-2xl font-bold text-white drop-shadow-lg" 
                                    }, isMobile ? "C-Secur360" : "Planificateur C-Secur360"),
                                    !isMobile && React.createElement('div', { className: "text-xs text-gray-300" }, 
                                        `${jobs.length} jobs ‚Ä¢ ${personnel.length} techniciens ‚Ä¢ ${equipements.length} √©quipements`
                                    )
                                )
                            ),
                            
                            // ACTIONS RAPIDES MOBILES
                            React.createElement('div', { className: "flex items-center gap-2" },
                                // Utilisateur connect√© - version compacte
                                utilisateurConnecte && React.createElement('div', { 
                                    className: isMobile 
                                        ? "flex items-center gap-2" 
                                        : "hidden lg:flex items-center gap-3" 
                                },
                                    React.createElement('div', { className: isMobile ? "text-right" : "text-right" },
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement('span', { 
                                                className: `w-2 h-2 rounded-full ${peutModifier() ? 'bg-green-500' : 'bg-orange-500'}` 
                                            }),
                                            React.createElement('span', { 
                                                className: isMobile 
                                                    ? "text-xs font-medium text-white" 
                                                    : "font-medium text-white" 
                                            }, isMobile ? utilisateurConnecte.nom.split(' ')[0] : utilisateurConnecte.nom)
                                        ),
                                        !isMobile && React.createElement('div', { className: "text-xs text-gray-200" },
                                            utilisateurConnecte.poste,
                                            estCoordonnateur() && React.createElement('span', { className: "ml-2 px-2 py-1 bg-blue-600 text-blue-100 rounded-full" }, "Coord.")
                                        )
                                    )
                                ),
                                
                                // Google Drive - version compacte pour mobile
                                utilisateurConnecte && React.createElement('button', {
                                    onClick: () => {
                                        if (googleDrive.isAuthenticated) {
                                            if (forceSync) forceSync();
                                        } else {
                                            googleDrive.signIn();
                                        }
                                    },
                                    className: `p-2 rounded-lg transition-all ${
                                        googleDrive.isAuthenticated 
                                            ? 'bg-green-100 text-green-600 hover:bg-green-200' 
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }`,
                                    title: googleDrive.isAuthenticated ? 'Synchroniser Google Drive' : 'Se connecter √† Google Drive'
                                },
                                    React.createElement('span', { className: 'text-lg' }, 
                                        googleDrive.isSyncing ? 'üîÑ' : googleDrive.isAuthenticated ? '‚òÅÔ∏è' : 'üì°'
                                    )
                                ),
                                
                                // MENU HAMBURGER 
                                React.createElement('button', {
                                    onClick: () => setShowMobileMenu(!showMobileMenu),
                                    className: "p-2 rounded-lg hover:bg-gray-800 transition-colors",
                                    title: "Menu"
                                },
                                    React.createElement('div', { className: "flex flex-col gap-1" },
                                        React.createElement('div', { className: `w-5 h-0.5 bg-white transition-transform ${showMobileMenu ? 'rotate-45 translate-y-1.5' : ''}` }),
                                        React.createElement('div', { className: `w-5 h-0.5 bg-white transition-opacity ${showMobileMenu ? 'opacity-0' : ''}` }),
                                        React.createElement('div', { className: `w-5 h-0.5 bg-white transition-transform ${showMobileMenu ? '-rotate-45 -translate-y-1.5' : ''}` })
                                    )
                                )
                            )
                        ),
                        
                        // MENU D√âROULANT MOBILE/TABLETTE
                        showMobileMenu && React.createElement('div', {
                            className: "mt-4 bg-gray-800 rounded-lg border border-gray-700 overflow-hidden"
                        },
                            // Section Informations
                            React.createElement('div', { className: "p-4 border-b border-gray-700" },
                                React.createElement('h3', { className: "text-sm font-semibold text-gray-300 mb-2" }, "üìä Informations"),
                                React.createElement('div', { className: "grid grid-cols-2 gap-3 text-xs" },
                                    React.createElement('div', { className: "bg-gray-700 p-2 rounded" },
                                        React.createElement('div', { className: "text-blue-400 font-medium" }, jobs.length),
                                        React.createElement('div', { className: "text-gray-300" }, jobs.length <= 1 ? 'Job' : 'Jobs')
                                    ),
                                    React.createElement('div', { className: "bg-gray-700 p-2 rounded" },
                                        React.createElement('div', { className: "text-green-400 font-medium" }, personnel.length),
                                        React.createElement('div', { className: "text-gray-300" }, 'Techniciens')
                                    ),
                                    React.createElement('div', { className: "bg-gray-700 p-2 rounded" },
                                        React.createElement('div', { className: "text-purple-400 font-medium" }, equipements.length),
                                        React.createElement('div', { className: "text-gray-300" }, '√âquipements')
                                    ),
                                    React.createElement('div', { className: "bg-gray-700 p-2 rounded" },
                                        React.createElement('div', { className: `font-medium ${
                                            isMobile ? 'text-blue-400' : isTablet ? 'text-green-400' : 'text-purple-400'
                                        }` }, isMobile ? 'Mobile' : isTablet ? 'Tablette' : 'Desktop'),
                                        React.createElement('div', { className: "text-gray-300" }, 'Mode')
                                    )
                                )
                            ),
                            
                            // Section Utilisateur (si connect√©)
                            utilisateurConnecte && React.createElement('div', { className: "p-4 border-b border-gray-700" },
                                React.createElement('h3', { className: "text-sm font-semibold text-gray-300 mb-2" }, "üë§ Compte"),
                                React.createElement('div', { className: "bg-gray-700 p-3 rounded-lg" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-2" },
                                        React.createElement('span', { className: "font-medium text-white" }, utilisateurConnecte.nom),
                                        React.createElement('span', { 
                                            className: `w-2 h-2 rounded-full ${peutModifier() ? 'bg-green-500' : 'bg-orange-500'}` 
                                        })
                                    ),
                                    React.createElement('div', { className: "text-xs text-gray-300 mb-1" }, utilisateurConnecte.poste),
                                    React.createElement('div', { className: "flex items-center justify-between" },
                                        React.createElement('span', { className: "text-xs text-gray-400" }, 
                                            peutModifier() ? "Peut modifier" : "Consultation"
                                        ),
                                        estCoordonnateur() && React.createElement('span', { 
                                            className: "px-2 py-1 bg-blue-600 text-blue-100 rounded text-xs" 
                                        }, "Coord.")
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: handleUserLogout,
                                    className: "w-full mt-2 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm"
                                }, "üö™ Se d√©connecter")
                            ),
                            
                            // Section Google Drive
                            utilisateurConnecte && React.createElement('div', { className: "p-4 border-b border-gray-700" },
                                React.createElement('h3', { className: "text-sm font-semibold text-gray-300 mb-2" }, "‚òÅÔ∏è Google Drive"),
                                React.createElement('div', { className: "bg-gray-700 p-3 rounded-lg" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-2" },
                                        React.createElement('span', { className: "text-sm" }, 
                                            googleDrive.isAuthenticated ? "Connect√©" : "Non connect√©"
                                        ),
                                        React.createElement('span', { 
                                            className: `text-lg ${
                                                googleDrive.isSyncing ? '' : 
                                                googleDrive.isAuthenticated ? 'text-green-400' : 
                                                'text-gray-400'
                                            }` 
                                        }, googleDrive.isSyncing ? 'üîÑ' : googleDrive.isAuthenticated ? '‚òÅÔ∏è' : 'üì°')
                                    ),
                                    googleDrive.lastSync && React.createElement('div', { className: "text-xs text-gray-400 mb-2" },
                                        `Derni√®re sync: ${googleDrive.lastSync.toLocaleDateString()}`
                                    ),
                                    React.createElement('div', { className: "flex gap-2" },
                                        !googleDrive.isAuthenticated 
                                            ? React.createElement('button', {
                                                onClick: googleDrive.signIn,
                                                className: "flex-1 p-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs"
                                            }, "Se connecter")
                                            : React.createElement('div', { className: "flex gap-2 w-full" },
                                                React.createElement('button', {
                                                    onClick: forceSync,
                                                    disabled: googleDrive.isSyncing,
                                                    className: "flex-1 p-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 text-xs"
                                                }, googleDrive.isSyncing ? "Sync..." : "Sync"),
                                                React.createElement('button', {
                                                    onClick: googleDrive.signOut,
                                                    className: "px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 text-xs"
                                                }, "D√©co")
                                            )
                                    )
                                )
                            ),
                            
                            // Section Actions
                            React.createElement('div', { className: "p-4" },
                                React.createElement('h3', { className: "text-sm font-semibold text-gray-300 mb-3" }, "‚ö° Actions"),
                                React.createElement('div', { className: "grid grid-cols-2 gap-3" },
                                    // Bouton Nouveau (seulement si peut modifier)
                                    peutModifier() && React.createElement('button', {
                                        onClick: () => {
                                            setSelectedJob(null);
                                            setSelectedCell(null);
                                            setShowJobModal(true);
                                            setShowMobileMenu(false); // Fermer le menu
                                        },
                                        className: "flex items-center justify-center gap-2 p-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                    },
                                        React.createElement(Icon, { name: 'plus', size: 16 }),
                                        React.createElement('span', { className: "text-sm font-medium" }, "Nouveau Job")
                                    ),
                                    
                                    // Bouton Ressources
                                    React.createElement('button', {
                                        onClick: () => {
                                            requireAdminAuth();
                                            setShowMobileMenu(false);
                                        },
                                        className: "flex items-center justify-center gap-2 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                    },
                                        React.createElement(Icon, { name: 'settings', size: 16 }),
                                        React.createElement('span', { className: "text-sm font-medium" }, "Ressources")
                                    ),
                                    
                                    // Toggle Mode Jour/Nuit
                                    React.createElement('button', {
                                        onClick: () => {
                                            setModeTheme(modeTheme === 'jour' ? 'nuit' : 'jour');
                                            setShowMobileMenu(false);
                                        },
                                        className: `flex items-center justify-center gap-2 p-3 rounded-lg transition-colors ${
                                            modeTheme === 'nuit' 
                                                ? 'bg-yellow-600 text-white hover:bg-yellow-700' 
                                                : 'bg-gray-700 text-white hover:bg-gray-800'
                                        }`
                                    },
                                        React.createElement('span', { className: "text-lg" }, modeTheme === 'nuit' ? '‚òÄÔ∏è' : 'üåô'),
                                        React.createElement('span', { className: "text-sm font-medium" }, 
                                            modeTheme === 'nuit' ? 'Mode Jour' : 'Mode Nuit'
                                        )
                                    ),
                                    
                                    // Bouton Cong√©s
                                    React.createElement('button', {
                                        onClick: () => {
                                            setSelectedPersonnelConges(null);
                                            setShowCongesModal(true);
                                            setShowMobileMenu(false);
                                        },
                                        className: "flex items-center justify-center gap-2 p-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                                    },
                                        React.createElement('span', { className: "text-lg" }, 'üèñÔ∏è'),
                                        React.createElement('span', { className: "text-sm font-medium" }, "Cong√©s")
                                    ),
                                    
                                    // PWA Install
                                    React.createElement('button', {
                                        onClick: () => {
                                            handleInstallPWA();
                                            setShowMobileMenu(false);
                                        },
                                        className: `flex items-center justify-center gap-2 p-3 rounded-lg transition-colors ${
                                            showInstallButton ? 
                                            'bg-purple-600 text-white hover:bg-purple-700 animate-pulse' :
                                            'bg-gray-600 text-white hover:bg-gray-700'
                                        }`
                                    },
                                        React.createElement('span', { className: "text-lg" }, 'üì±'),
                                        React.createElement('span', { className: "text-sm font-medium" }, 
                                            showInstallButton ? 'Installer App' : 'PWA'
                                        )
                                    ),
                                    
                                    // Export Data
                                    React.createElement('button', {
                                        onClick: () => {
                                            exportData();
                                            setShowMobileMenu(false);
                                        },
                                        className: "flex items-center justify-center gap-2 p-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                                    },
                                        React.createElement(Icon, { name: 'download', size: 16 }),
                                        React.createElement('span', { className: "text-sm font-medium" }, "Export")
                                )
                            )
                        ),
                        
                        // ACTIONS DESKTOP - Visible uniquement sur desktop
                        !isMobile && !showMobileMenu && React.createElement('div', { className: "hidden lg:flex lg:items-center lg:gap-2 mt-4" },
                            // Bouton Nouveau (seulement si peut modifier)
                            peutModifier() && React.createElement('button', {
                                onClick: () => {
                                    setSelectedJob(null);
                                    setSelectedCell(null);
                                    setShowJobModal(true);
                                },
                                className: "flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            },
                                React.createElement(Icon, { name: 'plus', size: 16 }),
                                React.createElement('span', null, "Nouveau")
                            ),
                            
                            // Bouton installation PWA
                            React.createElement('button', {
                                onClick: handleInstallPWA,
                                className: `flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${
                                    showInstallButton ? 
                                    'bg-purple-500 text-white hover:bg-purple-600 animate-pulse' :
                                    'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                }`,
                                title: showInstallButton ? 'Installer l\'application' : 'PWA disponible'
                            },
                                React.createElement('span', null, 'üì±'),
                                React.createElement('span', null, showInstallButton ? 'Installer' : 'PWA')
                            ),
                            
                            React.createElement('button', {
                                onClick: requireAdminAuth,
                                className: "flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                            },
                                React.createElement(Icon, { name: 'settings', size: 16 }),
                                React.createElement('span', null, "Ressources")
                            ),
                            
                            React.createElement('button', {
                                onClick: () => setModeTheme(modeTheme === 'jour' ? 'nuit' : 'jour'),
                                className: `flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${
                                    modeTheme === 'nuit' 
                                        ? 'bg-yellow-500 text-white hover:bg-yellow-600' 
                                        : 'bg-gray-800 text-white hover:bg-gray-900'
                                }`
                            },
                                React.createElement('span', null, modeTheme === 'nuit' ? '‚òÄÔ∏è' : 'üåô'),
                                React.createElement('span', null, modeTheme === 'nuit' ? 'Jour' : 'Nuit')
                            ),
                            
                            React.createElement('button', {
                                onClick: () => {
                                    setSelectedPersonnelConges(null);
                                    setShowCongesModal(true);
                                },
                                className: "flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors"
                            },
                                React.createElement('span', null, 'üèñÔ∏è'),
                                React.createElement('span', null, "Cong√©s")
                            ),
                            
                            React.createElement('button', {
                                onClick: exportData,
                                className: "flex items-center gap-2 px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                            },
                                React.createElement(Icon, { name: 'download', size: 16 }),
                                React.createElement('span', null, "Export")
                            )
                        )
                    ),

                    // Navigation et recherche
                        React.createElement('div', { className: "flex flex-col lg:flex-row gap-4 mt-4" },
                            // Recherche et filtres
                            React.createElement('div', { className: "flex flex-1 gap-2" },
                                React.createElement('div', { className: "relative flex-1 max-w-md" },
                                    React.createElement(Icon, { 
                                        name: 'search', 
                                        size: 18, 
                                        className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" 
                                    }),
                                    React.createElement('input', {
                                        type: "text",
                                        placeholder: "Rechercher...",
                                        value: searchTerm,
                                        onChange: (e) => setSearchTerm(e.target.value),
                                        className: "w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                    })
                                ),
                                React.createElement('select', {
                                    value: filterType,
                                    onChange: (e) => {
                                        setFilterType(e.target.value);
                                        // D√©sactiver le mode vue individuel si on passe aux √©quipements
                                        if (e.target.value === 'equipements') {
                                            setModeVueIndividuel(false);
                                            setTravailleurSelectionne('');
                                        }
                                    },
                                    className: "px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                },
                                    React.createElement('option', { value: "personnel" }, "Personnel"),
                                    React.createElement('option', { value: "equipements" }, "√âquipements"),
                                    React.createElement('option', { value: "global" }, "Vue globale")
                                ),
                                React.createElement('select', {
                                    value: filterBureau,
                                    onChange: (e) => setFilterBureau(e.target.value),
                                    className: "px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                },
                                    ...getBureauOptions().map(bureau => 
                                        React.createElement('option', { key: bureau.value, value: bureau.value }, bureau.label)
                                    )
                                ),

                                // Mode vue individuel (seulement pour personnel et global)
                                (filterType === 'personnel' || filterType === 'global') && React.createElement('div', { className: "flex items-center gap-2" },
                                    React.createElement('label', { className: "flex items-center gap-2 text-sm" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: modeVueIndividuel,
                                            onChange: (e) => {
                                                setModeVueIndividuel(e.target.checked);
                                                if (!e.target.checked) {
                                                    setTravailleurSelectionne('');
                                                }
                                            },
                                            className: "rounded"
                                        }),
                                        React.createElement('span', null, "Vue individuel")
                                    ),
                                    modeVueIndividuel && React.createElement('select', {
                                        value: travailleurSelectionne,
                                        onChange: (e) => setTravailleurSelectionne(e.target.value),
                                        className: "px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 min-w-[200px]"
                                    },
                                        React.createElement('option', { value: "" }, "S√©lectionner un travailleur"),
                                        ...personnel.filter(p => !p.isCoordonnateur).map(person => 
                                            React.createElement('option', { key: person.id, value: person.id }, 
                                                `${person.nom} - ${person.poste}`
                                            )
                                        )
                                    )
                                )
                            ),

                            // Navigation temporelle
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('button', {
                                    onClick: () => navigateMonths(-1),
                                    className: "p-2 hover:bg-gray-100 rounded-lg",
                                    title: "Mois pr√©c√©dent"
                                }, React.createElement(Icon, { name: 'chevronLeft', size: 20 })),
                                React.createElement('button', {
                                    onClick: () => navigateWeeks(-1),
                                    className: "px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"
                                }, "‚Üê"),
                                React.createElement('button', {
                                    onClick: goToToday,
                                    className: "px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 rounded text-blue-600"
                                }, "Aujourd'hui"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('button', {
                                        onClick: () => setShowDateNavigator(!showDateNavigator),
                                        className: "px-3 py-1 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded cursor-pointer",
                                        title: "Cliquer pour aller √† une date pr√©cise"
                                    }, startDate.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })),
                                    showDateNavigator && React.createElement('div', { 
                                        className: "absolute top-full mt-2 z-50" 
                                    },
                                        React.createElement(DateNavigator, {
                                            currentDate: startDate,
                                            onDateChange: setStartDate,
                                            onClose: () => setShowDateNavigator(false)
                                        })
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: () => navigateWeeks(1),
                                    className: "px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"
                                }, "‚Üí"),
                                React.createElement('button', {
                                    onClick: () => navigateMonths(1),
                                    className: "p-2 hover:bg-gray-100 rounded-lg",
                                    title: "Mois suivant"
                                }, React.createElement(Icon, { name: 'chevronRight', size: 20 })),
                                React.createElement('select', {
                                    value: numberOfDays,
                                    onChange: (e) => setNumberOfDays(parseInt(e.target.value)),
                                    className: "px-2 py-1 text-sm border rounded-lg"
                                },
                                    React.createElement('option', { value: 14 }, "2S"),
                                    React.createElement('option', { value: 21 }, "3S"),
                                    React.createElement('option', { value: 30 }, "1M"),
                                    React.createElement('option', { value: 60 }, "2M"),
                                    React.createElement('option', { value: 90 }, "3M")
                                )
                            )
                        )
                    )
                ),

                // Calendrier principal
                React.createElement('div', { className: "p-4" },
                    React.createElement('div', { className: "bg-white rounded-lg shadow-sm overflow-hidden" },
                        React.createElement('div', { className: "overflow-x-auto" },
                            React.createElement('table', { className: "w-full min-w-max" },
                                React.createElement('thead', { className: "bg-gray-50 sticky top-0" },
                                    // En-t√™te avec mois
                                    React.createElement('tr', null,
                                        React.createElement('th', { 
                                            className: `px-3 py-2 text-left font-semibold text-gray-700 sticky left-0 bg-gray-50 z-20 border-r ${isMobile ? 'min-w-[120px]' : 'min-w-[160px]'}` 
                                        }, filterType === 'global' ? "Ressource" :
                                           filterType === 'personnel' ? (isMobile ? "Tech." : "Technicien") : (isMobile ? "√âquip." : "√âquipement")),
                                        !isMobile && React.createElement('th', { 
                                            className: "px-2 py-2 text-left font-semibold text-gray-700 sticky left-[160px] bg-gray-50 z-20 border-r w-20" 
                                        }, filterType === 'global' ? "Type" :
                                           filterType === 'personnel' ? "Poste" : "Type"),
                                        ...continuousDays.map((day, index) => {
                                            const showMonth = index === 0 || day.date.getDate() === 1;
                                            return React.createElement('th', {
                                                key: index,
                                                className: `px-1 py-2 text-center font-semibold text-gray-700 ${isMobile ? 'w-10' : 'w-16'} border-r ${day.isWeekend ? 'bg-gray-100' : ''}`
                                            }, showMonth && React.createElement('div', { 
                                                className: "text-xs text-gray-500 font-normal" 
                                            }, isMobile ? day.monthName.substr(0, 3) : day.monthName));
                                        })
                                    ),
                                    
                                    // En-t√™te avec jours
                                    React.createElement('tr', null,
                                        React.createElement('th', { className: `px-3 py-2 sticky left-0 bg-gray-50 z-20 border-r ${isMobile ? 'w-[120px]' : 'w-[160px]'}` }),
                                        !isMobile && React.createElement('th', { className: "px-2 py-2 sticky left-[160px] bg-gray-50 z-20 border-r" }),
                                        ...continuousDays.map((day, index) => 
                                            React.createElement('th', {
                                                key: index,
                                                className: `px-1 py-2 text-center text-xs border-r ${day.isWeekend ? 'bg-gray-100' : 'bg-gray-50'} ${day.isToday ? 'bg-blue-100 text-blue-600 font-bold' : 'text-gray-600'}`
                                            },
                                                React.createElement('div', { className: "font-medium" }, 
                                                    isMobile ? day.dayName.substr(0, 1) : day.dayName
                                                ),
                                                React.createElement('div', { 
                                                    className: `${isMobile ? 'text-xs' : 'text-sm'} ${day.isToday ? 'font-bold' : ''}` 
                                                }, day.dayNumber)
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('tbody', null,
                                    ...filteredResources.map((resource) => 
                                        React.createElement('tr', {
                                            key: resource.id,
                                            className: "border-b hover:bg-gray-50"
                                        },
                                            React.createElement('td', { 
                                                className: `px-3 py-3 font-medium sticky left-0 bg-white z-10 border-r ${isMobile ? 'w-[120px]' : 'w-[160px]'}` 
                                            },
                                                React.createElement('div', { className: `${isMobile ? 'text-xs' : 'text-sm'} font-semibold flex items-center gap-1` }, 
                                                    filterType === 'global' && React.createElement(Icon, { 
                                                        name: resource.type === 'personnel' ? 'user' : 'wrench', 
                                                        size: 12,
                                                        className: resource.type === 'personnel' ? 'text-blue-600' : 'text-orange-600'
                                                    }),
                                                    isMobile ? resource.nom.split(' ')[0] : resource.nom
                                                ),
                                                React.createElement('div', { className: "text-xs text-gray-500" }, 
                                                    resource.succursale
                                                )
                                            ),
                                            !isMobile && React.createElement('td', { 
                                                className: "px-2 py-3 text-xs sticky left-[160px] bg-white z-10 border-r" 
                                            }, filterType === 'global' ? 
                                                (resource.type === 'personnel' ? resource.poste : resource.type) :
                                                (filterType === 'personnel' ? resource.poste : resource.type)
                                            ),
                                            ...continuousDays.map((day, dayIndex) => {
                                                const job = getJobForCell(resource.id, day, resource.type);
                                                const jobEquipments = job ? getJobEquipments(job) : [];
                                                const congesApprouves = resource.type === 'personnel' ? getCongesForPersonnel(resource.id, day.date) : [];
                                                
                                                // V6.5 ULTRA: TEMPORAIREMENT D√âSACTIV√â - Revenir au syst√®me simple
                                                const allDayJobs = [];
                                                
                                                return React.createElement('td', {
                                                    key: dayIndex,
                                                    className: `px-0 py-0 border-r cursor-pointer hover:bg-blue-50 transition-colors relative ${allDayJobs.length > 1 ? 'h-16' : isMobile ? 'h-12' : 'h-10'} ${day.isWeekend ? 'bg-gray-50' : 'bg-white'}`,
                                                    onClick: (e) => handleCellClick(resource.id, day, resource.type, e),
                                                    title: allDayJobs.length > 1 ? `${allDayJobs.length} t√¢ches ce jour` : undefined
                                                },
                                                    // RETOUR AU SYST√àME CLASSIQUE STABLE (V6.3)
                                                    congesApprouves.length > 0 && !job ? React.createElement('div', {
                                                        className: `w-full h-full flex items-center justify-center text-xs rounded border-2 ${congesApprouves[0].type === 'vacances' ? 'conges-approuve' : 'demande-conges'}`,
                                                        title: `CONG√â: ${congesApprouves[0].type.toUpperCase()}\nDu ${congesApprouves[0].dateDebut} au ${congesApprouves[0].dateFin}\nMotif: ${congesApprouves[0].motif}`
                                                    },
                                                        React.createElement('div', { className: "text-center truncate px-1" },
                                                            React.createElement('div', { className: `font-medium ${isMobile ? 'text-[9px]' : 'text-[10px]'}` }, 
                                                                congesApprouves[0].type === 'vacances' ? 'üèñÔ∏è' : congesApprouves[0].type === 'maladie' ? 'üè•' : 'üìÖ'
                                                            ),
                                                            React.createElement('div', { className: `truncate ${isMobile ? 'text-[8px]' : 'text-[9px]'}` }, 
                                                                congesApprouves[0].type.toUpperCase()
                                                            )
                                                        )
                                                    ) : job ? React.createElement('div', {
                                                        className: `w-full h-full flex items-center justify-center text-xs rounded border-2 ${getPriorityAndBureauColor(job)}`,
                                                        title: `${job.numeroJob} - ${job.nom}\nBureau: ${job.bureau || 'Non assign√©'}\nClient: ${job.client || 'N/A'}\n${
                                                            job.planningsIndividuels?.[resource.id] 
                                                                ? `Planning personnalis√©: ${job.planningsIndividuels[resource.id].dateDebut} au ${job.planningsIndividuels[resource.id].dateFin}` 
                                                                : `Du ${job.dateDebut} au ${job.dateFin || job.dateDebut}`
                                                        }\nType: ${
                                                            job.typeHoraire === 'nuit' ? 'Travaux de nuit üåô' : 
                                                            job.typeHoraire === '24h' ? 'Travaux 24h/24h ‚è∞' : 
                                                            'Travaux de jour ‚òÄÔ∏è'
                                                        }${
                                                            job.typeHoraire === '24h' && job.horairesIndividuels?.[resource.id] 
                                                                ? `\nHoraire personnel: ${job.horairesIndividuels[resource.id] === 'nuit' ? 'Nuit üåô' : 'Jour ‚òÄÔ∏è'}`
                                                                : ''
                                                        }${
                                                            job.includeWeekendsInDuration ? '\nInclut les fins de semaine' : ''
                                                        }\n√âquipements: ${jobEquipments.map(eq => eq.nom).join(', ') || 'Aucun'}`
                                                    },
                                                        React.createElement('div', { className: "text-center truncate px-1" },
                                                            React.createElement('div', { className: `font-medium ${isMobile ? 'text-[10px]' : 'text-[12px]'}` }, `#${job.numeroJob}`),
                                                            React.createElement('div', { className: `truncate ${isMobile ? 'text-[9px]' : 'text-[11px]'}` }, 
                                                                isMobile && job.nom.length > 8 ? job.nom.substring(0, 8) + '...' : job.nom
                                                            )
                                                        ),
                                                        // Indicateur d'√©quipements
                                                        jobEquipments.length > 0 && React.createElement('div', {
                                                            className: "equipment-indicator",
                                                            title: `${jobEquipments.length} √©quipement(s) assign√©(s)`
                                                        }),
                                                        // Indicateur de r√©currence
                                                        job.recurrence?.active && React.createElement('div', {
                                                            className: "recurrence-indicator",
                                                            title: `√âv√©nement r√©current (${job.recurrence.type})`
                                                        }, "üîÑ"),
                                                        // Indicateur de planning personnalis√©
                                                        job.planningsIndividuels?.[resource.id] && React.createElement('div', {
                                                            className: "absolute top-0 right-0 w-2 h-2 bg-yellow-400 rounded-full",
                                                            title: "Planning personnalis√©"
                                                        }),
                                                        // Indicateur d'horaire individuel pour travaux 24h/24h
                                                        job.typeHoraire === '24h' && job.horairesIndividuels?.[resource.id] && 
                                                        React.createElement('div', {
                                                            className: `absolute bottom-0 right-0 w-2 h-2 rounded-full ${
                                                                job.horairesIndividuels[resource.id] === 'nuit' ? 'bg-blue-600' : 'bg-orange-400'
                                                            }`,
                                                            title: `Horaire: ${job.horairesIndividuels[resource.id] === 'nuit' ? 'Nuit' : 'Jour'}`
                                                        }),
                                                        // Indicateur de cong√©s (m√™me avec un job)
                                                        congesApprouves.length > 0 && React.createElement('div', {
                                                            className: "conges-indicator",
                                                            title: `CONG√â: ${congesApprouves[0].type.toUpperCase()}\nDu ${congesApprouves[0].dateDebut} au ${congesApprouves[0].dateFin}`
                                                        })
                                                    ) : React.createElement('div', {
                                                        className: "w-full h-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity"
                                                    }, React.createElement(Icon, { name: 'plus', size: isMobile ? 8 : 10, className: "text-gray-400" }))
                                                );
                                            })
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),

                // Modals
                React.createElement(JobModal, {
                    isOpen: showJobModal,
                    onClose: () => {
                        setShowJobModal(false);
                        setSelectedJob(null);
                        setSelectedCell(null);
                    },
                    job: selectedJob,
                    onSave: handleSaveJob,
                    onDelete: handleDeleteJob,
                    personnel: getPersonnelVisible(), // Utiliser le personnel filtr√© selon les permissions
                    equipements,
                    sousTraitants,
                    addSousTraitant,
                    jobs,
                    selectedCell,
                    addNotification,
                    peutModifier: peutModifier(),
                    estCoordonnateur: estCoordonnateur()
                }),

                React.createElement(ResourceManagementModal, {
                    isOpen: showResourceModal,
                    onClose: () => setShowResourceModal(false),
                    personnel,
                    setPersonnel,
                    equipements,
                    setEquipements,
                    typesEquipements,
                    addTypeEquipement,
                    addNotification,
                    demandesConges,
                    setDemandesConges,
                    showCongesModal,
                    setShowCongesModal,
                    selectedPersonnelConges,
                    setSelectedPersonnelConges,
                    handleSaveConges,
                    handleDeleteConges
                }),

                // Modal de connexion admin
                React.createElement(Modal, {
                    isOpen: showAdminLogin,
                    onClose: () => {
                        setShowAdminLogin(false);
                        setAdminPassword('');
                    },
                    title: "Authentification Administrateur",
                    size: 'sm'
                },
                    React.createElement('div', { className: "p-6 space-y-4" },
                        React.createElement('div', { className: "text-sm text-gray-600 mb-4" },
                            "Acc√®s administrateur requis pour modifier les ressources."
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium mb-2" }, "Mot de passe administrateur"),
                            React.createElement('input', {
                                type: "password",
                                value: adminPassword,
                                onChange: (e) => setAdminPassword(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleAdminLogin(),
                                className: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500",
                                placeholder: "Entrez le mot de passe",
                                autoFocus: true
                            })
                        ),
                        React.createElement('div', { className: "flex justify-end gap-3 pt-4" },
                            React.createElement('button', {
                                onClick: () => {
                                    setShowAdminLogin(false);
                                    setAdminPassword('');
                                },
                                className: "px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                            }, "Annuler"),
                            React.createElement('button', {
                                onClick: handleAdminLogin,
                                className: "px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                            }, "Se connecter")
                        )
                    )
                )
            );
        };

        // üîç DIAGNOSTIC FINAL - Test du rendu
        console.log('%cüéØ √âTAPE FINALE - Test du rendu', 'background: #FF9800; color: white; padding: 5px;');
        
        try {
            const rootElement = document.getElementById('root');
            if (!rootElement) {
                throw new Error('‚ùå √âl√©ment root non trouv√© dans le DOM');
            }
            console.log('‚úÖ √âl√©ment root trouv√©:', rootElement);
            
            if (typeof PlanificateurFinal === 'undefined') {
                throw new Error('‚ùå Composant PlanificateurFinal non d√©fini');
            }
            console.log('‚úÖ Composant PlanificateurFinal d√©fini');
            
            // Rendu de l'application
            console.log('üöÄ D√©marrage du rendu React...');
            const root = ReactDOM.createRoot(rootElement);
            root.render(React.createElement(PlanificateurFinal));
            console.log('%cüéâ SUCC√àS ! V6.7 charg√© avec succ√®s - Version Compl√®te', 'background: #4CAF50; color: white; padding: 10px; font-size: 16px;');
            
        } catch (error) {
            console.error('%cüí• ERREUR LORS DU RENDU:', 'background: #f44336; color: white; padding: 5px;', error);
            console.error('Stack trace:', error.stack);
            
            document.body.innerHTML = `
                <div style="padding: 20px; background: #fee; border: 2px solid #f00; margin: 20px; border-radius: 10px; font-family: Arial;">
                    <h1 style="color: #d00;">üö® ERREUR DE RENDU V6.4</h1>
                    <p><strong>Probl√®me d√©tect√©:</strong> ${error.message}</p>
                    <pre style="background: #f8f8f8; padding: 10px; border-radius: 5px; overflow: auto; font-size: 12px;">${error.stack}</pre>
                    <button onclick="location.reload()" style="padding: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">üîÑ Recharger la page</button>
                </div>
            `;
            throw error;
        }
    </script>
</body>
</html><!-- Trigger deploy ven. 12 sept. 2025 12:56:56 -->
