<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Direct - Diagnostic Imm√©diat</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .log { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; }
        .error { background: #ffe6e6; border-color: #ffcccc; color: #cc0000; }
        .success { background: #e6ffe6; border-color: #ccffcc; color: #006600; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background: #e6f3ff; border-color: #cce6ff; color: #0066cc; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Test Direct - Diagnostic C-Secur360</h1>
    <div id="logs"></div>

    <script>
        const logs = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logs.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Capture toutes les erreurs
        window.onerror = function(msg, url, line, col, error) {
            addLog(`‚ùå ERREUR JAVASCRIPT: ${msg}<br>Fichier: ${url}<br>Ligne: ${line}:${col}<br>Stack: <pre>${error?.stack || 'Non disponible'}</pre>`, 'error');
            return false;
        };

        window.addEventListener('unhandledrejection', function(event) {
            addLog(`‚ùå PROMESSE REJET√âE: ${event.reason}<br>Stack: <pre>${event.reason?.stack || 'Non disponible'}</pre>`, 'error');
        });

        addLog('üöÄ D√©but du diagnostic direct', 'info');

        // Test 1: Environnement de base
        try {
            addLog(`‚úÖ Navigateur: ${navigator.userAgent}`, 'success');
            addLog(`‚úÖ URL actuelle: ${window.location.href}`, 'success');
        } catch (e) {
            addLog(`‚ùå Erreur environnement: ${e.message}`, 'error');
        }

        // Test 2: Acc√®s aux fichiers locaux
        fetch('./c-secur360-planner-main/index.html')
            .then(response => {
                if (response.ok) {
                    addLog('‚úÖ Fichier principal accessible via fetch', 'success');
                    return response.text();
                } else {
                    addLog(`‚ùå Fichier principal inaccessible: HTTP ${response.status}`, 'error');
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(content => {
                if (content.includes('PlanificateurFinal')) {
                    addLog('‚úÖ Contenu principal trouv√© dans le fichier', 'success');
                } else {
                    addLog('‚ùå Contenu principal manquant', 'error');
                }
                
                // Test des scripts externes dans le contenu
                if (content.includes('https://unpkg.com/react@18')) {
                    addLog('‚úÖ Script React trouv√© dans le fichier', 'success');
                } else {
                    addLog('‚ùå Script React manquant', 'error');
                }
            })
            .catch(error => {
                addLog(`‚ùå Erreur lecture fichier: ${error.message}`, 'error');
                addLog('‚ö†Ô∏è Cela peut indiquer un probl√®me de politique CORS ou de chemin de fichier', 'warning');
            });

        // Test 3: Scripts externes
        const scriptTests = [
            'https://unpkg.com/react@18/umd/react.development.js',
            'https://unpkg.com/react-dom@18/umd/react-dom.development.js',
            'https://cdn.tailwindcss.com',
            'https://apis.google.com/js/api.js'
        ];

        scriptTests.forEach((url, index) => {
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        addLog(`‚úÖ Script externe accessible: ${url}`, 'success');
                    } else {
                        addLog(`‚ùå Script externe inaccessible: ${url} (HTTP ${response.status})`, 'error');
                    }
                })
                .catch(error => {
                    addLog(`‚ùå Erreur script externe ${url}: ${error.message}`, 'error');
                });
        });

        // Test 4: Chargement direct dans iframe
        setTimeout(() => {
            addLog('üñºÔ∏è Test de chargement dans iframe...', 'info');
            const iframe = document.createElement('iframe');
            iframe.src = './c-secur360-planner-main/index.html';
            iframe.style.cssText = 'width: 100%; height: 400px; border: 2px solid #007bff; border-radius: 8px; margin: 10px 0;';
            
            iframe.onload = () => {
                addLog('‚úÖ Iframe charg√©e avec succ√®s', 'success');
            };
            
            iframe.onerror = (e) => {
                addLog(`‚ùå Erreur chargement iframe: ${e.message || 'Erreur inconnue'}`, 'error');
            };
            
            const container = document.createElement('div');
            container.innerHTML = '<h3>üì± Aper√ßu de l\'application:</h3>';
            container.appendChild(iframe);
            logs.appendChild(container);
        }, 2000);

        // Test 5: R√©sum√© final
        setTimeout(() => {
            addLog('üìä Diagnostic termin√©. Si l\'iframe ci-dessus est vide ou montre une erreur, il y a un probl√®me de chargement.', 'info');
            addLog('üí° Solutions possibles:<br>1. Ouvrir les DevTools (F12) pour voir les erreurs console<br>2. V√©rifier que tous les scripts se chargent<br>3. Tester dans un autre navigateur<br>4. D√©sactiver les bloqueurs de publicit√©', 'warning');
        }, 5000);
    </script>
</body>
</html>