<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur de Projet - C-Secur360 V6.6 - Gantt Intuitif</title>
    <link rel="icon" type="image/png" href="C-Secur360-logo.png.png">
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Planificateur C-Secur360 V6.6">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="C-Secur360-logo.png.png">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Equipment badges in calendar */
        .equipment-indicator {
            position: absolute;
            bottom: 2px;
        }

        /* V6.6: Style pour √©tapes r√©organisables */
        .etape-draggable {
            cursor: move;
            transition: all 0.2s ease;
        }

        .etape-draggable:hover {
            background-color: #f3f4f6;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .etape-numero {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            font-weight: bold;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .etape-parallele {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }

        /* Animation pour les changements d'ordre */
        .etape-moving {
            background-color: #dbeafe;
            transform: scale(1.02);
            z-index: 10;
        }

        /* V6.6: Indicateurs visuels pour personnel manquant */
        .personnel-alerte {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .personnel-requis {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Style pour s√©lecteur d'√©tape parall√®le */
        .parallel-selector {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 8px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="text/babel">
        console.log('%cüöÄ D√âMARRAGE V6.6 - Gantt Intuitif avec num√©rotation automatique', 'background: #4CAF50; color: white; padding: 5px; border-radius: 3px;');
        
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // V6.6: Fonction utilitaire pour r√©organiser les √©tapes automatiquement
        const reorderEtapes = (etapes) => {
            return etapes.map((etape, index) => ({
                ...etape,
                numero: index + 1,  // Num√©rotation automatique
                id: etape.id || `etape-${index + 1}`
            }));
        };

        // V6.6: Fonction pour calculer l'ordre s√©quentiel automatique
        const calculateSequentialOrder = (etapes) => {
            const ordered = [];
            const processed = new Set();
            
            // Premi√®re passe: ajouter les √©tapes non-parall√®les dans l'ordre
            etapes.forEach((etape, index) => {
                if (!etape.isParallel) {
                    ordered.push({...etape, ordre: ordered.length + 1});
                    processed.add(index);
                }
            });
            
            // Deuxi√®me passe: ins√©rer les √©tapes parall√®les
            etapes.forEach((etape, index) => {
                if (etape.isParallel && !processed.has(index)) {
                    const parallelTo = etape.parallelToStep - 1; // Convertir de num√©ro √† index
                    const targetOrder = parallelTo >= 0 && parallelTo < ordered.length ? ordered[parallelTo].ordre : 1;
                    ordered.push({...etape, ordre: targetOrder, isParallel: true});
                }
            });
            
            return ordered;
        };

        // V6.6: Fonction pour v√©rifier l'assignation de personnel
        const checkPersonnelAssignment = (etape, personnel) => {
            const personnelAssigne = (etape.personnel || []).length;
            const personnelRequis = etape.personnelRequis || 0;
            
            return {
                estComplet: personnelRequis === 0 || personnelAssigne >= personnelRequis,
                manquants: Math.max(0, personnelRequis - personnelAssigne),
                ratio: personnelRequis > 0 ? `${personnelAssigne}/${personnelRequis}` : 'N/A'
            };
        };

        const PlanificateurApp = () => {
            // √âtats principaux
            const [jobs, setJobs] = useState([]);
            const [personnel, setPersonnel] = useState([]);
            const [equipements, setEquipements] = useState([]);
            const [sousTraitants, setSousTraitants] = useState([]);
            const [typesEquipements, setTypesEquipements] = useState([]);
            const [currentWeek, setCurrentWeek] = useState(new Date());
            const [showEventModal, setShowEventModal] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [notifications, setNotifications] = useState([]);
            const [activeTab, setActiveTab] = useState('general');
            const [ganttData, setGanttData] = useState({ tasks: [], mode: 'timeline' });
            
            // V6.6: Nouveaux √©tats pour la gestion intuitive des √©tapes
            const [etapeEnEdition, setEtapeEnEdition] = useState(null);
            const [showParallelSelector, setShowParallelSelector] = useState(null);
            const [etapesDragOrder, setEtapesDragOrder] = useState([]);

            // Donn√©es du formulaire avec structure V6.6 am√©lior√©e
            const [formData, setFormData] = useState({
                numeroJob: '',
                nom: '',
                client: '',
                adresse: '',
                dateDebut: '',
                dateFin: '',
                heureDebut: '08:00',
                heureFin: '17:00',
                personnel: [],
                equipements: [],
                sousTraitants: [],
                priorite: 'normale',
                statut: 'planifie',
                couleur: '#3b82f6',
                notes: '',
                documents: [],
                photos: [],
                dureePreviewHours: '',
                includeWeekendsInDuration: false,
                // V6.6: Structure d'√©tapes am√©lior√©e avec num√©rotation automatique
                etapes: [], // [{id, numero, text, completed, duration, isParallel, parallelToStep, personnel, personnelRequis, priority, baseline}]
                preparation: [],
                typeHoraire: 'jour',
                horairesIndividuels: {},
                recurrence: { active: false, type: 'weekly', count: 1 },
                bureau: '',
                responsable: '',
                cout: 0,
                budget: 0,
                progression: 0,
                personnelRequis: 0, // V6.5: Nombre total requis pour l'√©v√©nement
                modeAttenteAssignation: false // V6.5: Mode attente d'assignation
            });

            console.log('üìä Initialisation V6.6 - √âtat formData.etapes:', formData.etapes);

            // Fonction pour d√©placer une √©tape vers le haut
            const moveEtapeUp = useCallback((index) => {
                if (index > 0) {
                    const newEtapes = [...formData.etapes];
                    [newEtapes[index - 1], newEtapes[index]] = [newEtapes[index], newEtapes[index - 1]];
                    const reordered = reorderEtapes(newEtapes);
                    updateField('etapes', reordered);
                    console.log('‚¨ÜÔ∏è √âtape d√©plac√©e vers le haut:', index, '->', index - 1);
                }
            }, [formData.etapes]);

            // Fonction pour d√©placer une √©tape vers le bas
            const moveEtapeDown = useCallback((index) => {
                if (index < formData.etapes.length - 1) {
                    const newEtapes = [...formData.etapes];
                    [newEtapes[index], newEtapes[index + 1]] = [newEtapes[index + 1], newEtapes[index]];
                    const reordered = reorderEtapes(newEtapes);
                    updateField('etapes', reordered);
                    console.log('‚¨áÔ∏è √âtape d√©plac√©e vers le bas:', index, '->', index + 1);
                }
            }, [formData.etapes]);

            // V6.6: Fonction pour activer/d√©sactiver le mode parall√®le
            const toggleParallel = useCallback((index) => {
                const newEtapes = [...formData.etapes];
                const etape = newEtapes[index];
                
                if (etape.isParallel) {
                    // D√©sactiver le parall√©lisme
                    etape.isParallel = false;
                    delete etape.parallelToStep;
                    setShowParallelSelector(null);
                } else {
                    // Activer le parall√©lisme - montrer le s√©lecteur
                    setShowParallelSelector(index);
                }
                
                updateField('etapes', newEtapes);
            }, [formData.etapes]);

            // V6.6: Fonction pour d√©finir l'√©tape parall√®le
            const setParallelToStep = useCallback((etapeIndex, parallelToStepNumber) => {
                const newEtapes = [...formData.etapes];
                newEtapes[etapeIndex].isParallel = true;
                newEtapes[etapeIndex].parallelToStep = parallelToStepNumber;
                updateField('etapes', newEtapes);
                setShowParallelSelector(null);
                console.log(`üîÑ √âtape ${etapeIndex + 1} en parall√®le avec √©tape ${parallelToStepNumber}`);
            }, [formData.etapes]);

            // V6.6: G√©n√©ration automatique du Gantt bas√© sur l'ordre s√©quentiel
            const generateAutoGantt = useCallback(() => {
                if (!formData.etapes.length || !formData.dateDebut || !formData.dureePreviewHours) return [];

                const startDate = new Date(`${formData.dateDebut}T${formData.heureDebut || '08:00'}`);
                const tasks = [];
                let currentTime = new Date(startDate);

                // V6.6: Traitement s√©quentiel avec support du parall√©lisme
                const processedSteps = calculateSequentialOrder(formData.etapes);
                
                processedSteps.forEach((etape, index) => {
                    const taskDuration = etape.duration || 0.25;
                    const taskDurationMs = taskDuration * 60 * 60 * 1000;
                    
                    let taskStartTime;
                    
                    if (etape.isParallel && etape.parallelToStep) {
                        // Trouver l'√©tape de r√©f√©rence
                        const referenceStep = tasks.find(t => t.numero === etape.parallelToStep);
                        taskStartTime = referenceStep ? new Date(referenceStep.startDate) : new Date(currentTime);
                    } else {
                        // √âtape s√©quentielle
                        taskStartTime = new Date(currentTime);
                        currentTime = new Date(taskStartTime.getTime() + taskDurationMs);
                    }
                    
                    const taskEndTime = new Date(taskStartTime.getTime() + taskDurationMs);
                    
                    // V√©rification du personnel
                    const personnelCheck = checkPersonnelAssignment(etape, personnel);
                    
                    tasks.push({
                        id: etape.id || `etape-${index + 1}`,
                        numero: etape.numero || index + 1,
                        name: etape.text || `√âtape ${index + 1}`,
                        startDate: taskStartTime,
                        endDate: taskEndTime,
                        duration: taskDuration,
                        completed: etape.completed || false,
                        priority: etape.priority || 'normal',
                        isParallel: etape.isParallel || false,
                        parallelToStep: etape.parallelToStep,
                        personnel: etape.personnel || [],
                        personnelRequis: etape.personnelRequis || 0,
                        personnelCheck: personnelCheck,
                        needsPersonnel: !personnelCheck.estComplet
                    });
                });

                console.log('üéØ Gantt auto-g√©n√©r√© V6.6:', tasks);
                return tasks;
            }, [formData.etapes, formData.dateDebut, formData.heureDebut, formData.dureePreviewHours, personnel]);

            // Fonction de mise √† jour des champs
            const updateField = useCallback((field, value) => {
                setFormData(prev => {
                    const updated = { ...prev, [field]: value };
                    
                    // V6.6: Renum√©rotation automatique des √©tapes
                    if (field === 'etapes') {
                        updated.etapes = reorderEtapes(value);
                    }
                    
                    return updated;
                });
            }, []);

            // Synchronisation automatique du Gantt
            useEffect(() => {
                if (activeTab === 'gantt' && formData.etapes.length > 0) {
                    const newTasks = generateAutoGantt();
                    setGanttData(prev => ({ ...prev, tasks: newTasks }));
                }
            }, [formData.etapes, activeTab, generateAutoGantt]);

            // Cr√©ation d'une nouvelle √©tape
            const ajouterEtape = useCallback(() => {
                const nouvelleEtape = {
                    id: `etape-${Date.now()}`,
                    numero: formData.etapes.length + 1,
                    text: '',
                    completed: false,
                    duration: 0.25,
                    isParallel: false,
                    personnel: [],
                    personnelRequis: 1,
                    priority: 'normal',
                    baseline: { startDate: '', endDate: '', duration: 0.25 }
                };
                
                const newEtapes = [...formData.etapes, nouvelleEtape];
                updateField('etapes', newEtapes);
                console.log('‚ûï Nouvelle √©tape cr√©√©e:', nouvelleEtape);
            }, [formData.etapes, updateField]);

            // Suppression d'une √©tape
            const supprimerEtape = useCallback((index) => {
                const newEtapes = formData.etapes.filter((_, i) => i !== index);
                const reordered = reorderEtapes(newEtapes);
                updateField('etapes', reordered);
                console.log('üóëÔ∏è √âtape supprim√©e:', index);
            }, [formData.etapes, updateField]);

            return React.createElement('div', { 
                className: 'min-h-screen bg-gray-50' 
            },
                React.createElement('div', { className: 'bg-gradient-to-r from-gray-900 to-black shadow-lg border-b border-gray-800' },
                    React.createElement('div', { className: 'px-4 py-4' },
                        React.createElement('div', { className: 'flex items-center gap-3' },
                            React.createElement('img', { 
                                src: 'C-Secur360-logo.png.png',
                                alt: 'C-Secur360',
                                className: 'w-16 h-16 object-contain'
                            }),
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-2xl font-bold text-white' }, 
                                    'Planificateur C-Secur360 V6.6'
                                ),
                                React.createElement('p', { className: 'text-sm text-gray-300' }, 
                                    'Gantt Intuitif - Num√©rotation Automatique'
                                )
                            )
                        )
                    )
                ),

                React.createElement('div', { className: 'max-w-7xl mx-auto p-4' },
                    // Bouton principal pour cr√©er un √©v√©nement
                    React.createElement('div', { className: 'mb-6' },
                        React.createElement('button', {
                            onClick: () => setShowEventModal(true),
                            className: 'bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transition-all'
                        }, 
                        '‚ûï Cr√©er un √âv√©nement V6.6'
                        )
                    ),

                    // Modal de cr√©ation/√©dition d'√©v√©nement
                    showEventModal && React.createElement('div', { 
                        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50' 
                    },
                        React.createElement('div', { 
                            className: 'bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4' 
                        },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' },
                                        isEditing ? 'Modifier l\'√âv√©nement' : 'Cr√©er un Nouvel √âv√©nement V6.6'
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setShowEventModal(false),
                                        className: 'text-gray-500 hover:text-gray-700 text-2xl'
                                    }, '‚úï')
                                ),

                                // Onglets
                                React.createElement('div', { className: 'flex border-b border-gray-200 mb-6' },
                                    ['general', 'etapes', 'gantt'].map(tab => 
                                        React.createElement('button', {
                                            key: tab,
                                            onClick: () => setActiveTab(tab),
                                            className: `px-4 py-2 font-medium text-sm border-b-2 transition-colors ${
                                                activeTab === tab 
                                                    ? 'border-blue-500 text-blue-600' 
                                                    : 'border-transparent text-gray-500 hover:text-gray-700'
                                            }`,
                                            disabled: tab === 'gantt' && (!formData.etapes.length || !formData.dureePreviewHours)
                                        },
                                            tab === 'general' ? 'üìã G√©n√©ral' :
                                            tab === 'etapes' ? 'üìù √âtapes' :
                                            'üìä Gantt'
                                        )
                                    )
                                ),

                                // Contenu des onglets
                                activeTab === 'general' && React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Num√©ro de Job'),
                                            React.createElement('input', {
                                                type: 'text',
                                                value: formData.numeroJob,
                                                onChange: (e) => updateField('numeroJob', e.target.value),
                                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                                placeholder: 'Ex: JOB-2024-001'
                                            })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Nom de l\'√âv√©nement'),
                                            React.createElement('input', {
                                                type: 'text',
                                                value: formData.nom,
                                                onChange: (e) => updateField('nom', e.target.value),
                                                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                                placeholder: 'Description de l\'√©v√©nement'
                                            })
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Date de D√©but'),
                                        React.createElement('input', {
                                            type: 'date',
                                            value: formData.dateDebut,
                                            onChange: (e) => updateField('dateDebut', e.target.value),
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent'
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Dur√©e Totale Pr√©vue (heures)'),
                                        React.createElement('input', {
                                            type: 'number',
                                            step: '0.25',
                                            min: '0',
                                            value: formData.dureePreviewHours,
                                            onChange: (e) => updateField('dureePreviewHours', e.target.value),
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                            placeholder: 'Ex: 8'
                                        })
                                    )
                                ),

                                // V6.6: Onglet √âtapes Am√©lior√©
                                activeTab === 'etapes' && React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'flex justify-between items-center' },
                                        React.createElement('h3', { className: 'text-lg font-semibold text-gray-800' },
                                            '√âtapes du Projet (Num√©rotation Automatique)'
                                        ),
                                        React.createElement('button', {
                                            onClick: ajouterEtape,
                                            className: 'bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium'
                                        }, '‚ûï Ajouter √âtape')
                                    ),

                                    React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg border border-blue-200' },
                                        React.createElement('h4', { className: 'font-semibold text-blue-800 mb-2' }, 'üí° Comment √ßa marche :'),
                                        React.createElement('ul', { className: 'text-sm text-blue-700 space-y-1' },
                                            React.createElement('li', null, '‚Ä¢ Les √©tapes sont automatiquement num√©rot√©es 1, 2, 3...'),
                                            React.createElement('li', null, '‚Ä¢ Utilisez ‚¨ÜÔ∏è‚¨áÔ∏è pour r√©organiser l\'ordre d\'ex√©cution'),
                                            React.createElement('li', null, '‚Ä¢ Les √©tapes se placent bout √† bout automatiquement'),
                                            React.createElement('li', null, '‚Ä¢ Cochez "Parall√®le" pour ex√©cuter en m√™me temps qu\'une autre √©tape'),
                                            React.createElement('li', null, '‚Ä¢ Personnel requis = assignation obligatoire sinon ‚Üí En Attente')
                                        )
                                    ),

                                    // Liste des √©tapes
                                    React.createElement('div', { className: 'space-y-3' },
                                        formData.etapes.map((etape, index) => 
                                            React.createElement('div', {
                                                key: etape.id || index,
                                                className: 'etape-draggable border border-gray-200 rounded-lg p-4 bg-white shadow-sm'
                                            },
                                                React.createElement('div', { className: 'flex items-start gap-3' },
                                                    // Num√©ro d'√©tape
                                                    React.createElement('div', { 
                                                        className: `etape-numero ${etape.isParallel ? 'etape-parallele' : ''}`,
                                                        title: etape.isParallel ? `Parall√®le √† l'√©tape ${etape.parallelToStep}` : `√âtape s√©quentielle ${index + 1}`
                                                    }, etape.numero || index + 1),

                                                    // Contenu principal
                                                    React.createElement('div', { className: 'flex-1 space-y-3' },
                                                        React.createElement('div', { className: 'flex items-center gap-2' },
                                                            React.createElement('input', {
                                                                type: 'text',
                                                                value: etape.text || '',
                                                                onChange: (e) => {
                                                                    const newEtapes = [...formData.etapes];
                                                                    newEtapes[index].text = e.target.value;
                                                                    updateField('etapes', newEtapes);
                                                                },
                                                                placeholder: `Description de l'√©tape ${index + 1}`,
                                                                className: 'flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500'
                                                            }),
                                                            React.createElement('input', {
                                                                type: 'number',
                                                                step: '0.25',
                                                                min: '0.25',
                                                                value: etape.duration || '',
                                                                onChange: (e) => {
                                                                    const newEtapes = [...formData.etapes];
                                                                    newEtapes[index].duration = parseFloat(e.target.value) || 0.25;
                                                                    updateField('etapes', newEtapes);
                                                                },
                                                                placeholder: 'Heures',
                                                                className: 'w-20 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 text-center'
                                                            }),
                                                            React.createElement('span', { className: 'text-sm text-gray-500' }, 'h')
                                                        ),

                                                        // V6.6: Assignation de personnel avec indicateurs
                                                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-3' },
                                                            React.createElement('div', { className: 'flex items-center gap-2' },
                                                                React.createElement('label', { className: 'text-sm text-gray-600 min-w-[120px]' }, 'Personnel requis:'),
                                                                React.createElement('input', {
                                                                    type: 'number',
                                                                    min: '0',
                                                                    max: '20',
                                                                    value: etape.personnelRequis || 0,
                                                                    onChange: (e) => {
                                                                        const newEtapes = [...formData.etapes];
                                                                        newEtapes[index].personnelRequis = parseInt(e.target.value) || 0;
                                                                        updateField('etapes', newEtapes);
                                                                    },
                                                                    className: 'w-16 p-1 border rounded text-center'
                                                                }),
                                                                (() => {
                                                                    const personnelCheck = checkPersonnelAssignment(etape, personnel);
                                                                    return React.createElement('span', {
                                                                        className: `text-xs px-2 py-1 rounded-full ${
                                                                            personnelCheck.estComplet ? 'bg-green-100 text-green-700' :
                                                                            personnelCheck.manquants > 0 ? 'bg-red-100 text-red-700 personnel-alerte' :
                                                                            'bg-gray-100 text-gray-600'
                                                                        }`
                                                                    }, 
                                                                    personnelCheck.ratio === 'N/A' ? 'Optionnel' :
                                                                    personnelCheck.estComplet ? '‚úÖ Complet' :
                                                                    `‚ö†Ô∏è ${personnelCheck.ratio}`
                                                                    );
                                                                })()
                                                            ),

                                                            React.createElement('div', { className: 'flex items-center gap-2' },
                                                                React.createElement('label', { className: 'flex items-center gap-2 cursor-pointer' },
                                                                    React.createElement('input', {
                                                                        type: 'checkbox',
                                                                        checked: etape.isParallel || false,
                                                                        onChange: () => toggleParallel(index),
                                                                        className: 'rounded'
                                                                    }),
                                                                    React.createElement('span', { className: 'text-sm text-gray-700' }, 'Parall√®le')
                                                                ),
                                                                etape.isParallel && React.createElement('span', { 
                                                                    className: 'text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full' 
                                                                }, `‚Üí √âtape ${etape.parallelToStep}`)
                                                            )
                                                        ),

                                                        // V6.6: S√©lecteur d'√©tape parall√®le
                                                        showParallelSelector === index && React.createElement('div', { className: 'parallel-selector' },
                                                            React.createElement('h5', { className: 'font-semibold text-amber-800 mb-2' }, 
                                                                'üîÑ En parall√®le de quelle √©tape ?'
                                                            ),
                                                            React.createElement('div', { className: 'flex flex-wrap gap-2' },
                                                                formData.etapes.map((_, etapeIndex) => {
                                                                    if (etapeIndex === index) return null; // Pas soi-m√™me
                                                                    return React.createElement('button', {
                                                                        key: etapeIndex,
                                                                        onClick: () => setParallelToStep(index, etapeIndex + 1),
                                                                        className: 'px-3 py-1 bg-amber-200 hover:bg-amber-300 text-amber-800 rounded-full text-sm font-medium'
                                                                    }, `√âtape ${etapeIndex + 1}`);
                                                                })
                                                            ),
                                                            React.createElement('button', {
                                                                onClick: () => setShowParallelSelector(null),
                                                                className: 'mt-2 text-xs text-gray-500 hover:text-gray-700'
                                                            }, 'Annuler')
                                                        )
                                                    ),

                                                    // Contr√¥les de r√©organisation
                                                    React.createElement('div', { className: 'flex flex-col gap-1' },
                                                        React.createElement('button', {
                                                            onClick: () => moveEtapeUp(index),
                                                            disabled: index === 0,
                                                            className: 'p-1 text-blue-600 hover:bg-blue-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed'
                                                        }, '‚¨ÜÔ∏è'),
                                                        React.createElement('button', {
                                                            onClick: () => moveEtapeDown(index),
                                                            disabled: index === formData.etapes.length - 1,
                                                            className: 'p-1 text-blue-600 hover:bg-blue-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed'
                                                        }, '‚¨áÔ∏è'),
                                                        React.createElement('button', {
                                                            onClick: () => supprimerEtape(index),
                                                            className: 'p-1 text-red-600 hover:bg-red-100 rounded'
                                                        }, 'üóëÔ∏è')
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ),

                                // V6.6: Onglet Gantt am√©lior√©
                                activeTab === 'gantt' && React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'bg-green-50 p-4 rounded-lg border border-green-200' },
                                        React.createElement('h4', { className: 'font-semibold text-green-800 mb-2' }, 'üéØ Gantt V6.6 - Automatique'),
                                        React.createElement('p', { className: 'text-sm text-green-700' },
                                            'Le diagramme se g√©n√®re automatiquement selon l\'ordre des √©tapes. Les √©tapes parall√®les s\'affichent c√¥te √† c√¥te.'
                                        )
                                    ),

                                    ganttData.tasks.length > 0 && React.createElement('div', { className: 'bg-white border rounded-lg overflow-hidden' },
                                        React.createElement('div', { className: 'p-4 bg-gray-50 border-b' },
                                            React.createElement('h4', { className: 'font-semibold text-gray-800' }, 
                                                `Planning Automatique - ${ganttData.tasks.length} √©tapes`
                                            )
                                        ),
                                        React.createElement('div', { className: 'p-4 space-y-2' },
                                            ganttData.tasks.map((task, index) => {
                                                const needsPersonnel = task.needsPersonnel;
                                                return React.createElement('div', {
                                                    key: task.id,
                                                    className: `flex items-center gap-3 p-3 rounded border ${
                                                        needsPersonnel ? 'border-red-300 bg-red-50' : 'border-gray-200 bg-gray-50'
                                                    }`
                                                },
                                                    React.createElement('div', { 
                                                        className: `etape-numero ${task.isParallel ? 'etape-parallele' : ''}` 
                                                    }, task.numero),
                                                    React.createElement('div', { className: 'flex-1' },
                                                        React.createElement('div', { className: 'font-medium' }, task.name),
                                                        React.createElement('div', { className: 'text-xs text-gray-600' },
                                                            `‚è∞ ${task.startDate.toLocaleDateString()} ${task.startDate.toLocaleTimeString()} ‚Üí ${task.endDate.toLocaleTimeString()} (${task.duration}h)`
                                                        ),
                                                        task.isParallel && React.createElement('div', { className: 'text-xs text-amber-600' },
                                                            `üîÑ Parall√®le √† l'√©tape ${task.parallelToStep}`
                                                        ),
                                                        needsPersonnel && React.createElement('div', { className: 'text-xs font-medium' },
                                                            React.createElement('span', { className: 'personnel-requis' }, 
                                                                `‚ö†Ô∏è PERSONNEL MANQUANT: ${task.personnelCheck.ratio}`
                                                            )
                                                        )
                                                    )
                                                );
                                            })
                                        )
                                    )
                                ),

                                // Boutons d'action
                                React.createElement('div', { className: 'flex justify-end gap-3 pt-6 border-t border-gray-200' },
                                    React.createElement('button', {
                                        onClick: () => setShowEventModal(false),
                                        className: 'px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50'
                                    }, 'Annuler'),
                                    React.createElement('button', {
                                        onClick: () => {
                                            // TODO: Sauvegarder l'√©v√©nement
                                            console.log('üíæ Sauvegarde V6.6:', formData);
                                            setShowEventModal(false);
                                        },
                                        className: 'px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                                    }, isEditing ? 'Mettre √† jour' : 'Cr√©er l\'√âv√©nement')
                                )
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(PlanificateurApp));

        console.log('‚úÖ V6.6 Charg√© - Gantt Intuitif op√©rationnel');
    </script>
</body>
</html>