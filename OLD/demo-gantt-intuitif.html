<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Gantt Intuitif - C-Secur360</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .etape-numero {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            font-weight: bold;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .etape-parallele {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }

        .parallel-selector {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }

        .personnel-alerte {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="text/babel">
        const { useState, useCallback } = React;

        const DemoGanttIntuitif = () => {
            // √âtat des √©tapes avec num√©rotation automatique
            const [etapes, setEtapes] = useState([
                { id: 1, text: 'Pr√©paration du mat√©riel', duration: 2, personnelRequis: 2, personnel: [], isParallel: false },
                { id: 2, text: 'Installation √©quipement', duration: 4, personnelRequis: 3, personnel: [], isParallel: false },
                { id: 3, text: 'Tests et configuration', duration: 1, personnelRequis: 1, personnel: [], isParallel: false }
            ]);
            
            // Personnel disponible (simul√©)
            const [personnel] = useState([
                { id: 1, nom: 'Jean Dupont' },
                { id: 2, nom: 'Marie Martin' },
                { id: 3, nom: 'Paul Durand' },
                { id: 4, nom: 'Sophie Leclerc' }
            ]);

            const [showParallelSelector, setShowParallelSelector] = useState(null);
            const [dateDebut] = useState('2024-01-15');

            // Renumeroter automatiquement les √©tapes
            const reorderEtapes = useCallback((etapesArray) => {
                return etapesArray.map((etape, index) => ({
                    ...etape,
                    numero: index + 1
                }));
            }, []);

            // V√©rifier l'assignation de personnel
            const checkPersonnelAssignment = useCallback((etape) => {
                const personnelAssigne = etape.personnel.length;
                const personnelRequis = etape.personnelRequis || 0;
                
                return {
                    estComplet: personnelRequis === 0 || personnelAssigne >= personnelRequis,
                    manquants: Math.max(0, personnelRequis - personnelAssigne),
                    ratio: personnelRequis > 0 ? `${personnelAssigne}/${personnelRequis}` : 'N/A'
                };
            }, []);

            // D√©placer une √©tape vers le haut
            const moveEtapeUp = useCallback((index) => {
                if (index > 0) {
                    const newEtapes = [...etapes];
                    [newEtapes[index - 1], newEtapes[index]] = [newEtapes[index], newEtapes[index - 1]];
                    setEtapes(reorderEtapes(newEtapes));
                }
            }, [etapes, reorderEtapes]);

            // D√©placer une √©tape vers le bas
            const moveEtapeDown = useCallback((index) => {
                if (index < etapes.length - 1) {
                    const newEtapes = [...etapes];
                    [newEtapes[index], newEtapes[index + 1]] = [newEtapes[index + 1], newEtapes[index]];
                    setEtapes(reorderEtapes(newEtapes));
                }
            }, [etapes, reorderEtapes]);

            // Activer/d√©sactiver le mode parall√®le
            const toggleParallel = useCallback((index) => {
                const newEtapes = [...etapes];
                const etape = newEtapes[index];
                
                if (etape.isParallel) {
                    etape.isParallel = false;
                    delete etape.parallelToStep;
                    setShowParallelSelector(null);
                } else {
                    setShowParallelSelector(index);
                }
                
                setEtapes(newEtapes);
            }, [etapes]);

            // D√©finir l'√©tape parall√®le
            const setParallelToStep = useCallback((etapeIndex, parallelToStepNumber) => {
                const newEtapes = [...etapes];
                newEtapes[etapeIndex].isParallel = true;
                newEtapes[etapeIndex].parallelToStep = parallelToStepNumber;
                setEtapes(newEtapes);
                setShowParallelSelector(null);
            }, [etapes]);

            // G√©n√©rer le Gantt automatiquement
            const generateGanttPreview = useCallback(() => {
                const startDate = new Date(`${dateDebut}T08:00:00`);
                const tasks = [];
                let currentTime = new Date(startDate);

                etapes.forEach((etape, index) => {
                    const taskDuration = etape.duration || 1;
                    const taskDurationMs = taskDuration * 60 * 60 * 1000; // heures en millisecondes
                    
                    let taskStartTime;
                    
                    if (etape.isParallel && etape.parallelToStep) {
                        const referenceStep = tasks.find(t => t.numero === etape.parallelToStep);
                        taskStartTime = referenceStep ? new Date(referenceStep.startDate) : new Date(currentTime);
                    } else {
                        taskStartTime = new Date(currentTime);
                        if (!etape.isParallel) {
                            currentTime = new Date(taskStartTime.getTime() + taskDurationMs);
                        }
                    }
                    
                    const taskEndTime = new Date(taskStartTime.getTime() + taskDurationMs);
                    const personnelCheck = checkPersonnelAssignment(etape);
                    
                    tasks.push({
                        numero: etape.numero || index + 1,
                        name: etape.text,
                        startDate: taskStartTime,
                        endDate: taskEndTime,
                        duration: taskDuration,
                        isParallel: etape.isParallel,
                        parallelToStep: etape.parallelToStep,
                        personnelCheck: personnelCheck,
                        needsPersonnel: !personnelCheck.estComplet
                    });
                });

                return tasks;
            }, [etapes, dateDebut, checkPersonnelAssignment]);

            const ganttTasks = generateGanttPreview();

            // Ajouter une nouvelle √©tape
            const ajouterEtape = () => {
                const nouvelleEtape = {
                    id: Date.now(),
                    numero: etapes.length + 1, // Num√©ro imm√©diat
                    text: '',
                    duration: 1,
                    personnelRequis: 1,
                    personnel: [],
                    isParallel: false
                };
                setEtapes(prev => reorderEtapes([...prev, nouvelleEtape]));
            };

            return React.createElement('div', { className: 'min-h-screen bg-gray-50 p-6' },
                React.createElement('div', { className: 'max-w-6xl mx-auto' },
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 mb-6' },
                        React.createElement('h1', { className: 'text-2xl font-bold text-gray-800 mb-2' }, 
                            'üéØ Demo Gantt Intuitif V6.7'
                        ),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            'Syst√®me de gestion des √©tapes avec num√©rotation automatique, r√©organisation et mode parall√®le'
                        )
                    ),

                    React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                        // Section √âtapes
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                                React.createElement('h2', { className: 'text-xl font-semibold text-gray-800' },
                                    'üìù √âtapes du Projet'
                                ),
                                React.createElement('button', {
                                    onClick: ajouterEtape,
                                    className: 'bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium text-sm'
                                }, '‚ûï Ajouter')
                            ),

                            React.createElement('div', { className: 'bg-blue-50 p-3 rounded-lg border border-blue-200 mb-4 text-sm' },
                                React.createElement('p', { className: 'font-medium text-blue-800 mb-1' }, 'üí° Comment utiliser :'),
                                React.createElement('ul', { className: 'text-blue-700 space-y-1 text-xs' },
                                    React.createElement('li', null, '‚Ä¢ Num√©rotation automatique 1, 2, 3...'),
                                    React.createElement('li', null, '‚Ä¢ ‚¨ÜÔ∏è‚¨áÔ∏è pour r√©organiser l\'ordre'),
                                    React.createElement('li', null, '‚Ä¢ Cocher "Parall√®le" puis choisir l\'√©tape de r√©f√©rence'),
                                    React.createElement('li', null, '‚Ä¢ Personnel manquant = Alerte rouge')
                                )
                            ),

                            React.createElement('div', { className: 'space-y-3' },
                                etapes.map((etape, index) => 
                                    React.createElement('div', {
                                        key: etape.id,
                                        className: 'border border-gray-200 rounded-lg p-3 bg-gray-50'
                                    },
                                        React.createElement('div', { className: 'flex items-start gap-3' },
                                            // Num√©ro d'√©tape
                                            React.createElement('div', { 
                                                className: `etape-numero ${etape.isParallel ? 'etape-parallele' : ''}`,
                                                title: etape.isParallel ? `Parall√®le √† l'√©tape ${etape.parallelToStep}` : `√âtape s√©quentielle ${index + 1}`
                                            }, etape.numero || index + 1),

                                            // Contenu principal
                                            React.createElement('div', { className: 'flex-1 space-y-2' },
                                                React.createElement('input', {
                                                    type: 'text',
                                                    value: etape.text || '',
                                                    onChange: (e) => {
                                                        const newEtapes = [...etapes];
                                                        newEtapes[index].text = e.target.value;
                                                        setEtapes(newEtapes);
                                                    },
                                                    placeholder: `Description de l'√©tape ${index + 1}`,
                                                    className: 'w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 text-sm'
                                                }),

                                                React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs' },
                                                    React.createElement('div', { className: 'flex items-center gap-2' },
                                                        React.createElement('label', { className: 'text-gray-600' }, 'Dur√©e (h):'),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            step: '0.5',
                                                            min: '0.5',
                                                            value: etape.duration || '',
                                                            onChange: (e) => {
                                                                const newEtapes = [...etapes];
                                                                newEtapes[index].duration = parseFloat(e.target.value) || 1;
                                                                setEtapes(newEtapes);
                                                            },
                                                            className: 'w-16 p-1 border border-gray-300 rounded text-center'
                                                        })
                                                    ),

                                                    React.createElement('div', { className: 'flex items-center gap-2' },
                                                        React.createElement('label', { className: 'text-gray-600' }, 'Personnel:'),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            min: '0',
                                                            max: '10',
                                                            value: etape.personnelRequis || 0,
                                                            onChange: (e) => {
                                                                const newEtapes = [...etapes];
                                                                newEtapes[index].personnelRequis = parseInt(e.target.value) || 0;
                                                                setEtapes(newEtapes);
                                                            },
                                                            className: 'w-12 p-1 border border-gray-300 rounded text-center'
                                                        }),
                                                        (() => {
                                                            const check = checkPersonnelAssignment(etape);
                                                            return React.createElement('span', {
                                                                className: `text-xs px-2 py-1 rounded-full ${
                                                                    check.estComplet ? 'bg-green-100 text-green-700' :
                                                                    check.manquants > 0 ? 'bg-red-100 text-red-700 personnel-alerte' :
                                                                    'bg-gray-100 text-gray-600'
                                                                }`
                                                            }, 
                                                            check.ratio === 'N/A' ? '‚úì' : check.estComplet ? '‚úÖ' : `‚ö†Ô∏è ${check.ratio}`
                                                            );
                                                        })()
                                                    )
                                                ),

                                                React.createElement('div', { className: 'flex items-center gap-3 text-xs' },
                                                    React.createElement('label', { className: 'flex items-center gap-2' },
                                                        React.createElement('input', {
                                                            type: 'checkbox',
                                                            checked: etape.isParallel || false,
                                                            onChange: () => toggleParallel(index),
                                                            className: 'rounded'
                                                        }),
                                                        React.createElement('span', { className: 'text-gray-700' }, 'Parall√®le')
                                                    ),
                                                    etape.isParallel && React.createElement('span', { 
                                                        className: 'bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full' 
                                                    }, `‚Üí √âtape ${etape.parallelToStep}`)
                                                ),

                                                // S√©lecteur d'√©tape parall√®le
                                                showParallelSelector === index && React.createElement('div', { className: 'parallel-selector' },
                                                    React.createElement('p', { className: 'font-medium text-amber-800 mb-2 text-sm' }, 
                                                        'üîÑ En parall√®le de quelle √©tape ?'
                                                    ),
                                                    React.createElement('div', { className: 'flex flex-wrap gap-2 mb-2' },
                                                        etapes.map((_, etapeIndex) => {
                                                            if (etapeIndex === index) return null;
                                                            return React.createElement('button', {
                                                                key: etapeIndex,
                                                                onClick: () => setParallelToStep(index, etapeIndex + 1),
                                                                className: 'px-3 py-1 bg-amber-200 hover:bg-amber-300 text-amber-800 rounded-full text-xs font-medium'
                                                            }, `√âtape ${etapeIndex + 1}`);
                                                        })
                                                    ),
                                                    React.createElement('button', {
                                                        onClick: () => setShowParallelSelector(null),
                                                        className: 'text-xs text-gray-500 hover:text-gray-700'
                                                    }, 'Annuler')
                                                )
                                            ),

                                            // Contr√¥les de r√©organisation
                                            React.createElement('div', { className: 'flex flex-col gap-1' },
                                                React.createElement('button', {
                                                    onClick: () => moveEtapeUp(index),
                                                    disabled: index === 0,
                                                    className: 'w-8 h-8 text-blue-600 hover:bg-blue-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed text-sm',
                                                    title: 'Monter'
                                                }, '‚¨ÜÔ∏è'),
                                                React.createElement('button', {
                                                    onClick: () => moveEtapeDown(index),
                                                    disabled: index === etapes.length - 1,
                                                    className: 'w-8 h-8 text-blue-600 hover:bg-blue-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed text-sm',
                                                    title: 'Descendre'
                                                }, '‚¨áÔ∏è'),
                                                React.createElement('button', {
                                                    onClick: () => {
                                                        const newEtapes = etapes.filter((_, i) => i !== index);
                                                        setEtapes(reorderEtapes(newEtapes));
                                                    },
                                                    className: 'w-8 h-8 text-red-600 hover:bg-red-100 rounded text-sm',
                                                    title: 'Supprimer'
                                                }, 'üóëÔ∏è')
                                            )
                                        )
                                    )
                                )
                            )
                        ),

                        // Section Gantt Preview
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6' },
                            React.createElement('h2', { className: 'text-xl font-semibold text-gray-800 mb-4' },
                                'üìä Aper√ßu Gantt Automatique'
                            ),

                            React.createElement('div', { className: 'bg-green-50 p-3 rounded-lg border border-green-200 mb-4 text-sm' },
                                React.createElement('p', { className: 'font-medium text-green-800 mb-1' }, 'üéØ G√©n√©ration automatique'),
                                React.createElement('p', { className: 'text-green-700 text-xs' },
                                    'Le planning se met √† jour automatiquement selon l\'ordre des √©tapes. Les √©tapes parall√®les commencent en m√™me temps que leur r√©f√©rence.'
                                )
                            ),

                            React.createElement('div', { className: 'space-y-3' },
                                ganttTasks.map((task, index) => {
                                    return React.createElement('div', {
                                        key: index,
                                        className: `p-3 rounded border ${
                                            task.needsPersonnel ? 'border-red-300 bg-red-50' : 
                                            task.isParallel ? 'border-orange-300 bg-orange-50' :
                                            'border-gray-200 bg-gray-50'
                                        }`
                                    },
                                        React.createElement('div', { className: 'flex items-start gap-3' },
                                            React.createElement('div', { 
                                                className: `etape-numero ${task.isParallel ? 'etape-parallele' : ''}` 
                                            }, task.numero),
                                            React.createElement('div', { className: 'flex-1' },
                                                React.createElement('div', { className: 'font-medium text-gray-800' }, task.name),
                                                React.createElement('div', { className: 'text-xs text-gray-600 mt-1' },
                                                    `‚è∞ ${task.startDate.toLocaleDateString()} ${task.startDate.toLocaleTimeString()} ‚Üí ${task.endDate.toLocaleTimeString()} (${task.duration}h)`
                                                ),
                                                task.isParallel && React.createElement('div', { className: 'text-xs text-orange-600 mt-1' },
                                                    `üîÑ Parall√®le √† l'√©tape ${task.parallelToStep}`
                                                ),
                                                task.needsPersonnel && React.createElement('div', { className: 'text-xs font-medium mt-1' },
                                                    React.createElement('span', { className: 'bg-red-600 text-white px-2 py-1 rounded-full' }, 
                                                        `‚ö†Ô∏è PERSONNEL MANQUANT: ${task.personnelCheck.ratio}`
                                                    )
                                                )
                                            )
                                        )
                                    );
                                })
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(DemoGanttIntuitif));
    </script>
</body>
</html>